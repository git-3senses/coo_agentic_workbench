import{a as U}from"./chunk-E3IMKM74.js";import{d as k}from"./chunk-WR7XAGZW.js";import{Wb as $}from"./chunk-FLFKSUZI.js";import{Bb as y,Dc as R,Ib as P,Jb as A,Jc as O,Kb as m,Mb as a,Na as o,Nb as u,Ob as b,Y as S,ab as I,cc as L,eb as f,pb as c,qb as i,rb as n,sb as d,wc as N,xc as D,zb as x}from"./chunk-IVDQKAZB.js";import{a as T,b as w}from"./chunk-7RJXRMKA.js";function M(l,r){if(l&1&&(i(0,"div",24)(1,"div",25)(2,"div",26)(3,"div",27),d(4,"lucide-icon",28),n(),i(5,"div")(6,"div",29),a(7),n(),i(8,"div",30),a(9),n()()(),i(10,"div",31),a(11),n()(),i(12,"div",32),a(13),n()()),l&2){let e=r.$implicit;o(4),c("name",e.icon),o(3),u(e.title),o(2),u(e.id),o(2),u(e.metric),o(2),b(" ",e.desc," ")}}function j(l,r){if(l&1&&(i(0,"div",22),f(1,M,14,5,"div",23),n()),l&2){let e=y();o(),c("ngForOf",e.precedentPatterns)}}function G(l,r){l&1&&(i(0,"span",53),d(1,"div",54),a(2," Approved "),n())}function H(l,r){l&1&&(i(0,"span",55),d(1,"div",56),a(2," Rejected "),n())}function z(l,r){l&1&&(i(0,"span",57),d(1,"lucide-icon",58),a(2," Sealed "),n())}function J(l,r){l&1&&(i(0,"span",59),d(1,"lucide-icon",60),a(2," Granted "),n())}function K(l,r){if(l&1&&(i(0,"div",26)(1,"div",61),d(2,"div",62),n(),i(3,"span",63),a(4),n()()),l&2){let e=y().$implicit;o(2),A("width",e.score,"%"),m("bg-emerald-500",e.score>=90)("bg-amber-500",e.score>=70&&e.score<90),o(),m("text-emerald-700",e.score>=90)("text-amber-700",e.score>=70&&e.score<90),o(),b(" ",e.score,"% ")}}function V(l,r){l&1&&(i(0,"span",64),a(1,"Database Entry"),n())}function q(l,r){if(l&1&&(i(0,"tr",40)(1,"td",41),a(2),n(),i(3,"td",36)(4,"div",42),a(5),n(),i(6,"div",43),a(7),n()(),i(8,"td",36)(9,"div",44),d(10,"lucide-icon",45),a(11),n()(),i(12,"td",36),f(13,G,3,0,"span",46)(14,H,3,0,"span",47)(15,z,3,0,"span",48)(16,J,3,0,"span",49),n(),i(17,"td",36),f(18,K,5,11,"div",50)(19,V,2,0,"ng-template",null,0,L),n(),i(21,"td",37)(22,"button",51),d(23,"lucide-icon",52),n()()()),l&2){let e=r.$implicit,t=P(20);o(2),b(" ",e.id," "),o(3),b(" ",e.title),o(2),u(e.desc),o(3),c("name",e.icon),o(),b(" ",e.type," "),o(2),c("ngIf",e.status==="APPROVED"),o(),c("ngIf",e.status==="REJECTED"),o(),c("ngIf",e.status==="SEALED"),o(),c("ngIf",e.status==="GRANTED"),o(2),c("ngIf",e.score!==null)("ngIfElse",t)}}function B(l,r){if(l&1&&(i(0,"div",33)(1,"table",34)(2,"thead")(3,"tr",35)(4,"th",36),a(5,"Record ID"),n(),i(6,"th",36),a(7,"Title & Context"),n(),i(8,"th",36),a(9,"Evidence Type"),n(),i(10,"th",36),a(11,"Status"),n(),i(12,"th",36),a(13,"Relevance"),n(),i(14,"th",37),a(15,"Action"),n()()(),i(16,"tbody",38),f(17,q,24,11,"tr",39),n()()()),l&2){let e=y();o(17),c("ngForOf",e.filteredItems)}}var F=class l{activeCategory="ALL";http=S(O);route=S(k);evidenceItems=[];isLoading=!0;ngOnInit(){let r=String(this.route.snapshot.queryParamMap.get("tab")||"").toUpperCase();r==="PATTERNS"&&(this.activeCategory="PATTERNS"),r==="PRECEDENTS"&&(this.activeCategory="PRECEDENTS"),r==="AUDITS"&&(this.activeCategory="AUDITS"),r==="EXCEPTIONS"&&(this.activeCategory="EXCEPTIONS"),this.fetchData()}fetchData(){this.isLoading=!0,this.http.get("/api/evidence").subscribe({next:r=>{this.evidenceItems=r.map(e=>w(T({},e),{id:e.record_id,type:e.evidence_type,icon:e.icon_name,date:e.display_date||(e.event_date?new Date(e.event_date).toLocaleDateString():"N/A"),desc:e.description,score:e.relevance_score})),this.isLoading=!1},error:r=>{console.error("[EvidenceLibrary] Failed to fetch data from database",r),this.isLoading=!1}})}get filteredItems(){return this.activeCategory==="PATTERNS"?[]:this.activeCategory==="ALL"?this.evidenceItems:this.evidenceItems.filter(r=>r.type===this.activeCategory)}get precedentPatterns(){let r=this.evidenceItems.filter(s=>s.type==="PRECEDENTS"),e=r.length,t=r.filter(s=>s.status==="APPROVED").length,g=r.filter(s=>s.status==="REJECTED").length,C=r.map(s=>typeof s.score=="number"?s.score:null).filter(s=>s!==null),E=C.length?Math.round(C.reduce((s,p)=>s+p,0)/C.length):null,_=new Map,X=new Set(["the","and","for","with","via","from","into","over","under","to","of","in","a","an","on","by","product","agreement","platform","listed","multi","asset"]);for(let s of r){let p=String(s.title||"").toLowerCase().replace(/[^a-z0-9\\s-]/g," ").split(/\\s+/).map(v=>v.trim()).filter(v=>v.length>=3&&!X.has(v));for(let v of p)_.set(v,(_.get(v)||0)+1)}let h=[..._.entries()].sort((s,p)=>p[1]-s[1]).slice(0,6).map(([s,p])=>({k:s,v:p}));return[{id:"PAT-001",icon:"radar",title:"Precedent Outcome Mix",desc:e?`Approved ${t}/${e}, Rejected ${g}/${e}.`:"No precedents available yet.",metric:e?`${Math.round(t/e*100)}% approved`:"N/A"},{id:"PAT-002",icon:"bar-chart-2",title:"Average Relevance Score",desc:E===null?"No scored precedents yet.":`Average relevance across scored precedents: ${E}%.`,metric:E===null?"N/A":`${E}%`},{id:"PAT-003",icon:"search",title:"Common Themes (from titles)",desc:h.length?h.map(s=>`${s.k} (${s.v})`).join(", "):"Not enough data to infer themes.",metric:h.length?`${h[0].k}`:"N/A"}]}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=I({type:l,selectors:[["app-evidence-library"]],decls:36,vars:62,consts:[["noScore",""],[1,"h-full","flex","flex-col","bg-slate-50","relative","overflow-hidden"],[1,"flex-none","bg-white","border-b","border-slate-200","px-6","py-5","flex","items-center","justify-between","z-10"],[1,"flex","items-center","gap-2","text-sm","text-slate-500","mb-1"],["name","book-open",1,"w-4","h-4"],[1,"font-medium"],["name","chevron-right",1,"w-3","h-3"],[1,"text-slate-800","font-semibold"],[1,"text-2xl","font-bold","text-slate-900","tracking-tight"],[1,"text-sm","text-slate-500","mt-1","max-w-2xl"],[1,"flex","items-center","gap-3"],[1,"relative","group"],["name","filter",1,"w-4","h-4","text-slate-400","absolute","left-3","top-1/2","-translate-y-1/2"],["type","text","placeholder","Filter records by ID or underlying...",1,"pl-9","pr-4","py-2","w-72","bg-slate-100","hover:bg-slate-200/60","focus:bg-white","border","border-transparent","focus:border-blue-500","focus:ring-2","focus:ring-blue-100","placeholder:text-slate-400","text-sm","rounded-lg","transition-all","outline-none"],[1,"flex","items-center","gap-2","px-4","py-2","bg-slate-800","hover:bg-slate-900","text-white","text-sm","font-semibold","rounded-lg","shadow-sm","shadow-slate-900/10","transition-all"],["name","download",1,"w-4","h-4"],[1,"flex-1","overflow-y-auto","p-6","scrollbar-hide"],[1,"max-w-7xl","mx-auto","space-y-6"],[1,"flex","items-center","gap-2","bg-white","p-1","rounded-xl","border","border-slate-200","inline-flex","shadow-sm"],[1,"px-5","py-2","text-sm","font-semibold","rounded-lg","transition-all",3,"click"],["class","grid grid-cols-1 md:grid-cols-3 gap-4 animate-in fade-in slide-in-from-bottom-4 duration-300",4,"ngIf"],["class","bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden animate-in fade-in slide-in-from-bottom-4 duration-500",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","animate-in","fade-in","slide-in-from-bottom-4","duration-300"],["class","bg-white rounded-xl border border-slate-200 shadow-sm p-5 hover:shadow-md transition-shadow",4,"ngFor","ngForOf"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","p-5","hover:shadow-md","transition-shadow"],[1,"flex","items-start","justify-between","gap-3"],[1,"flex","items-center","gap-2"],[1,"p-2","rounded-lg","bg-slate-100","text-slate-700"],[1,"w-4","h-4",3,"name"],[1,"font-bold","text-slate-900","leading-tight"],[1,"text-xs","text-slate-500","font-mono","mt-0.5"],[1,"text-sm","font-bold","text-slate-900"],[1,"text-sm","text-slate-600","mt-3","leading-relaxed"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","overflow-hidden","animate-in","fade-in","slide-in-from-bottom-4","duration-500"],[1,"w-full","text-left","border-collapse"],[1,"bg-slate-50","border-b","border-slate-200","text-xs","uppercase","tracking-wider","text-slate-500","font-semibold"],[1,"px-6","py-4"],[1,"px-6","py-4","text-right"],[1,"divide-y","divide-slate-100"],["class","hover:bg-slate-50/80 transition-colors group cursor-pointer",4,"ngFor","ngForOf"],[1,"hover:bg-slate-50/80","transition-colors","group","cursor-pointer"],[1,"px-6","py-4","font-mono","font-bold","text-slate-700","text-sm"],[1,"font-bold","text-slate-900","mb-0.5","group-hover:text-blue-600","transition-colors"],[1,"text-xs","text-slate-500","truncate","max-w-md"],[1,"inline-flex","items-center","gap-1.5","px-2.5","py-1","rounded","bg-slate-100","text-slate-600","text-[11px]","font-bold","tracking-wider"],[1,"w-3.5","h-3.5",3,"name"],["class","inline-flex items-center gap-1 px-2.5 py-1 rounded bg-emerald-100 text-emerald-700 text-xs font-bold w-fit",4,"ngIf"],["class","inline-flex items-center gap-1 px-2.5 py-1 rounded bg-rose-100 text-rose-700 text-xs font-bold w-fit",4,"ngIf"],["class","inline-flex items-center gap-1 px-2.5 py-1 rounded bg-slate-100 text-slate-700 text-xs font-bold w-fit border border-slate-200",4,"ngIf"],["class","inline-flex items-center gap-1 px-2.5 py-1 rounded bg-amber-100 text-amber-700 text-xs font-bold w-fit",4,"ngIf"],["class","flex items-center gap-2",4,"ngIf","ngIfElse"],[1,"p-2","text-slate-400","hover:text-blue-600","hover:bg-blue-50","rounded-lg","transition-all","opacity-0","group-hover:opacity-100","group-hover:translate-x-0","-translate-x-2"],["name","arrow-right",1,"w-4","h-4"],[1,"inline-flex","items-center","gap-1","px-2.5","py-1","rounded","bg-emerald-100","text-emerald-700","text-xs","font-bold","w-fit"],[1,"w-1.5","h-1.5","rounded-full","bg-emerald-500"],[1,"inline-flex","items-center","gap-1","px-2.5","py-1","rounded","bg-rose-100","text-rose-700","text-xs","font-bold","w-fit"],[1,"w-1.5","h-1.5","rounded-full","bg-rose-500"],[1,"inline-flex","items-center","gap-1","px-2.5","py-1","rounded","bg-slate-100","text-slate-700","text-xs","font-bold","w-fit","border","border-slate-200"],["name","lock",1,"w-3","h-3"],[1,"inline-flex","items-center","gap-1","px-2.5","py-1","rounded","bg-amber-100","text-amber-700","text-xs","font-bold","w-fit"],["name","alert-triangle",1,"w-3","h-3"],[1,"w-16","h-1.5","bg-slate-100","rounded-full","overflow-hidden"],[1,"h-full","rounded-full"],[1,"text-xs","font-bold"],[1,"text-slate-400","text-xs","truncate"]],template:function(e,t){e&1&&(i(0,"div",1)(1,"header",2)(2,"div")(3,"div",3),d(4,"lucide-icon",4),i(5,"span",5),a(6,"Knowledge & Evidence"),n(),d(7,"lucide-icon",6),i(8,"span",7),a(9,"Evidence Library"),n()(),i(10,"h1",8),a(11,"Precedents & Patterns"),n(),i(12,"p",9),a(13," Historical records of product approvals, exceptions granted, and audit logs used by the intelligent workbench to construct precedent-based reasoning. "),n()(),i(14,"div",10)(15,"div",11),d(16,"lucide-icon",12)(17,"input",13),n(),i(18,"button",14),d(19,"lucide-icon",15),a(20," Export Log "),n()()(),i(21,"div",16)(22,"div",17)(23,"div",18)(24,"button",19),x("click",function(){return t.activeCategory="ALL"}),a(25," All Records "),n(),i(26,"button",19),x("click",function(){return t.activeCategory="PRECEDENTS"}),a(27," Historical Precedents "),n(),i(28,"button",19),x("click",function(){return t.activeCategory="PATTERNS"}),a(29," Patterns "),n(),i(30,"button",19),x("click",function(){return t.activeCategory="AUDITS"}),a(31," Sealed Audits "),n(),i(32,"button",19),x("click",function(){return t.activeCategory="EXCEPTIONS"}),a(33," Granted Exceptions "),n()(),f(34,j,2,1,"div",20)(35,B,18,1,"div",21),n()()()),e&2&&(o(24),m("bg-slate-900",t.activeCategory==="ALL")("text-white",t.activeCategory==="ALL")("shadow",t.activeCategory==="ALL")("text-slate-500",t.activeCategory!=="ALL")("hover:text-slate-800",t.activeCategory!=="ALL")("hover:bg-slate-100",t.activeCategory!=="ALL"),o(2),m("bg-slate-900",t.activeCategory==="PRECEDENTS")("text-white",t.activeCategory==="PRECEDENTS")("shadow",t.activeCategory==="PRECEDENTS")("text-slate-500",t.activeCategory!=="PRECEDENTS")("hover:text-slate-800",t.activeCategory!=="PRECEDENTS")("hover:bg-slate-100",t.activeCategory!=="PRECEDENTS"),o(2),m("bg-slate-900",t.activeCategory==="PATTERNS")("text-white",t.activeCategory==="PATTERNS")("shadow",t.activeCategory==="PATTERNS")("text-slate-500",t.activeCategory!=="PATTERNS")("hover:text-slate-800",t.activeCategory!=="PATTERNS")("hover:bg-slate-100",t.activeCategory!=="PATTERNS"),o(2),m("bg-slate-900",t.activeCategory==="AUDITS")("text-white",t.activeCategory==="AUDITS")("shadow",t.activeCategory==="AUDITS")("text-slate-500",t.activeCategory!=="AUDITS")("hover:text-slate-800",t.activeCategory!=="AUDITS")("hover:bg-slate-100",t.activeCategory!=="AUDITS"),o(2),m("bg-slate-900",t.activeCategory==="EXCEPTIONS")("text-white",t.activeCategory==="EXCEPTIONS")("shadow",t.activeCategory==="EXCEPTIONS")("text-slate-500",t.activeCategory!=="EXCEPTIONS")("hover:text-slate-800",t.activeCategory!=="EXCEPTIONS")("hover:bg-slate-100",t.activeCategory!=="EXCEPTIONS"),o(2),c("ngIf",t.activeCategory==="PATTERNS"),o(),c("ngIf",t.activeCategory!=="PATTERNS"))},dependencies:[R,N,D,U,$],encapsulation:2})};export{F as EvidenceLibraryComponent};
