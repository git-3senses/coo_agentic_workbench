import{Wb as M,Xb as Q}from"./chunk-FLFKSUZI.js";import{b as A,c as j,f as U,m as $}from"./chunk-SL2VEL43.js";import{Bb as s,Dc as D,Jc as N,Kb as S,Mb as r,Na as a,Nb as b,Ob as g,Rb as k,Sb as I,T as C,Tb as R,Y as E,Yb as w,ab as y,ca as m,da as p,eb as _,pb as d,qb as n,rb as i,sb as u,vc as T,wc as V,xc as O,yb as f,zb as x}from"./chunk-IVDQKAZB.js";var h=class o{http=E(N);apiUrl="/api/escalations";getActive(){return this.http.get(this.apiUrl)}getByNpa(t){return this.http.get(`${this.apiUrl}/npas/${t}`)}escalate(t,e){return this.http.post(`${this.apiUrl}/npas/${t}/escalate`,e)}resolve(t,e){return this.http.put(`${this.apiUrl}/${t}/resolve`,e)}markUnderReview(t,e){return this.http.put(`${this.apiUrl}/${t}/review`,{actor_name:e})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};var P=(o,t,e)=>({"bg-rose-50 text-rose-600 border border-rose-200":o,"bg-amber-50 text-amber-600 border border-amber-200":t,"bg-blue-50 text-blue-600 border border-blue-200":e}),W=(o,t,e)=>({"bg-rose-50 text-rose-700 border-rose-200":o,"bg-amber-50 text-amber-700 border-amber-200":t,"bg-green-50 text-green-700 border-green-200":e});function q(o,t){if(o&1&&(n(0,"span",17),r(1),i()),o&2){let e=s().$implicit;d("ngClass",e.key==="active"?"bg-rose-100 text-rose-600":"bg-slate-100 text-slate-500"),a(),b(e.count)}}function J(o,t){if(o&1){let e=f();n(0,"button",15),x("click",function(){let c=m(e).$implicit,v=s();return p(v.activeTab=c.key)}),r(1),_(2,q,2,2,"span",16),i()}if(o&2){let e=t.$implicit,l=s();S("border-slate-900",l.activeTab===e.key)("text-slate-900",l.activeTab===e.key)("border-transparent",l.activeTab!==e.key)("text-slate-500",l.activeTab!==e.key),a(),g(" ",e.label," "),a(),d("ngIf",e.count>0)}}function z(o,t){if(o&1){let e=f();n(0,"button",44),x("click",function(){m(e);let c=s(2).$implicit,v=s();return p(v.markUnderReview(c))}),u(1,"lucide-icon",45),r(2," Review "),i()}}function B(o,t){if(o&1){let e=f();n(0,"div",40),_(1,z,3,0,"button",41),n(2,"button",42),x("click",function(){m(e);let c=s().$implicit,v=s();return p(v.openResolveModal(c))}),u(3,"lucide-icon",43),r(4," Resolve "),i()()}if(o&2){let e=s().$implicit;a(),d("ngIf",e.status==="ACTIVE")}}function H(o,t){if(o&1&&(n(0,"div",46)(1,"h4",47),r(2,"Resolution"),i(),n(3,"p",48),r(4),i(),n(5,"p",49),r(6),i()()),o&2){let e=s().$implicit,l=s();a(4),b(e.resolution_notes),a(2),g("Resolved ",l.timeAgo(e.resolved_at))}}function G(o,t){if(o&1&&(n(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21)(4,"div",22),r(5),i(),n(6,"div")(7,"h3",23),r(8),i(),n(9,"div",24)(10,"span",25),r(11),i(),n(12,"span"),r(13),i(),n(14,"span",26),r(15,"|"),i(),n(16,"span"),r(17),i()()()(),n(18,"span",27),r(19),i()(),n(20,"div",28)(21,"h4",29),r(22,"Escalation Reason"),i(),n(23,"p",30),r(24),i()(),n(25,"div",31)(26,"div",32)(27,"span",33),u(28,"lucide-icon",34),r(29," Escalated by: "),n(30,"strong",35),r(31),i()(),n(32,"span",33),u(33,"lucide-icon",36),r(34," To: "),n(35,"strong",35),r(36),i()(),n(37,"span",33),u(38,"lucide-icon",37),r(39),i()(),_(40,B,5,1,"div",38),i(),_(41,H,7,2,"div",39),i()()),o&2){let e=t.$implicit,l=s();a(4),d("ngClass",w(14,P,e.escalation_level>=3,e.escalation_level===2,e.escalation_level<=1)),a(),g(" L",e.escalation_level," "),a(3),b(e.npa_title),a(3),b(e.project_id),a(2),b(e.npa_type),a(4),g("Stage: ",e.current_stage),a(),d("ngClass",w(18,W,e.status==="ACTIVE",e.status==="UNDER_REVIEW",e.status==="RESOLVED")),a(),g(" ",e.status.replace("_"," ")," "),a(5),b(l.parseReason(e.trigger_detail)),a(7),b(e.escalated_by),a(5),b(e.escalated_to),a(3),g(" ",l.timeAgo(e.escalated_at)," "),a(),d("ngIf",e.status!=="RESOLVED"),a(),d("ngIf",e.status==="RESOLVED"&&e.resolution_notes)}}function K(o,t){if(o&1&&(n(0,"div",50)(1,"div",51),u(2,"lucide-icon",52),i(),n(3,"h3",53),r(4),i(),n(5,"p",54),r(6,"All clear! No issues require attention right now."),i()()),o&2){let e=s();a(4),g("No ",e.activeTab," escalations")}}function X(o,t){if(o&1){let e=f();n(0,"div",55)(1,"div",56)(2,"div",57)(3,"h2",58),r(4,"Resolve Escalation"),i(),n(5,"button",59),x("click",function(){m(e);let c=s();return p(c.resolveModal=null)}),u(6,"lucide-icon",60),i()(),n(7,"div",61)(8,"div")(9,"label",62),r(10,"Decision"),i(),n(11,"div",63)(12,"button",64),x("click",function(){m(e);let c=s();return p(c.resolveDecision="PROCEED")}),r(13," Proceed with NPA "),i(),n(14,"button",64),x("click",function(){m(e);let c=s();return p(c.resolveDecision="REJECT")}),r(15," Reject NPA "),i()()(),n(16,"div")(17,"label",62),r(18,"Resolution Notes"),i(),n(19,"textarea",65),R("ngModelChange",function(c){m(e);let v=s();return I(v.resolveNotes,c)||(v.resolveNotes=c),p(c)}),i()()(),n(20,"div",66)(21,"button",67),x("click",function(){m(e);let c=s();return p(c.resolveModal=null)}),r(22,"Cancel"),i(),n(23,"button",68),x("click",function(){m(e);let c=s();return p(c.submitResolve())}),r(24," Resolve "),i()()()()}if(o&2){let e=s();a(12),d("ngClass",e.resolveDecision==="PROCEED"?"bg-green-600 text-white border-green-600":"bg-white text-slate-600 border-slate-200 hover:bg-slate-50"),a(2),d("ngClass",e.resolveDecision==="REJECT"?"bg-red-600 text-white border-red-600":"bg-white text-slate-600 border-slate-200 hover:bg-slate-50"),a(5),k("ngModel",e.resolveNotes),a(4),d("disabled",!e.resolveNotes||!e.resolveDecision)}}var F=class o{escalationService=E(h);escalations=[];activeTab="active";resolveModal=null;resolveDecision=null;resolveNotes="";get tabs(){return[{key:"active",label:"Active",count:this.escalations.filter(t=>t.status==="ACTIVE").length},{key:"under_review",label:"Under Review",count:this.escalations.filter(t=>t.status==="UNDER_REVIEW").length},{key:"resolved",label:"Resolved",count:0}]}get filteredEscalations(){let t={active:"ACTIVE",under_review:"UNDER_REVIEW",resolved:"RESOLVED"};return this.escalations.filter(e=>e.status===t[this.activeTab])}ngOnInit(){this.loadEscalations()}loadEscalations(){this.escalationService.getActive().subscribe({next:t=>this.escalations=t,error:t=>console.error("[ESCALATION] Load failed",t)})}parseReason(t){try{return JSON.parse(t).reason||t}catch{return t}}markUnderReview(t){this.escalationService.markUnderReview(t.id,"COO").subscribe({next:()=>this.loadEscalations(),error:e=>alert(e.error?.error||"Failed to mark under review")})}openResolveModal(t){this.resolveModal=t,this.resolveDecision=null,this.resolveNotes=""}submitResolve(){!this.resolveModal||!this.resolveNotes||!this.resolveDecision||this.escalationService.resolve(this.resolveModal.id,{actor_name:"COO",resolution:this.resolveNotes,decision:this.resolveDecision}).subscribe({next:()=>{this.resolveModal=null,this.loadEscalations()},error:t=>alert(t.error?.error||"Resolve failed")})}timeAgo(t){if(!t)return"";let e=Date.now()-new Date(t).getTime(),l=Math.floor(e/36e5);return l<1?"Just now":l<24?l+"h ago":Math.floor(l/24)+"d ago"}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["app-escalation-queue"]],decls:19,vars:5,consts:[[1,"h-full","flex","flex-col","bg-slate-50","font-sans","text-slate-900"],[1,"flex-none","bg-white","border-b","border-slate-200","px-8","py-5","flex","items-center","justify-between","shadow-sm"],[1,"text-2xl","font-bold","text-slate-900","tracking-tight","flex","items-center","gap-3"],["name","alert-triangle",1,"w-6","h-6","text-rose-600"],[1,"text-sm","text-slate-500","mt-1"],[1,"flex","items-center","gap-3"],[1,"bg-rose-50","text-rose-700","px-3","py-1","rounded-full","text-xs","font-bold","border","border-rose-100"],[1,"flex-none","bg-white","border-b","border-slate-200","px-8"],[1,"flex","gap-6"],["class","px-1 py-3 text-sm font-semibold border-b-2 hover:text-slate-900 transition-colors",3,"border-slate-900","text-slate-900","border-transparent","text-slate-500","click",4,"ngFor","ngForOf"],[1,"flex-1","overflow-auto","p-8"],[1,"max-w-5xl","mx-auto","space-y-4"],["class","bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow",4,"ngFor","ngForOf"],["class","text-center py-20 bg-white rounded-xl border border-dashed border-slate-300",4,"ngIf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",4,"ngIf"],[1,"px-1","py-3","text-sm","font-semibold","border-b-2","hover:text-slate-900","transition-colors",3,"click"],["class","ml-1.5 px-1.5 py-0.5 rounded-full text-[10px] font-bold",3,"ngClass",4,"ngIf"],[1,"ml-1.5","px-1.5","py-0.5","rounded-full","text-[10px]","font-bold",3,"ngClass"],[1,"bg-white","rounded-xl","shadow-sm","border","border-slate-200","overflow-hidden","hover:shadow-md","transition-shadow"],[1,"p-6"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex","items-start","gap-4"],[1,"flex-none","w-12","h-12","rounded-lg","flex","items-center","justify-center","text-lg","font-bold","shadow-sm",3,"ngClass"],[1,"text-lg","font-bold","text-slate-900","leading-tight"],[1,"flex","items-center","gap-3","mt-1.5","text-xs","text-slate-500"],[1,"bg-slate-100","px-2","py-0.5","rounded","font-mono"],[1,"text-slate-300"],[1,"px-2.5","py-1","rounded-full","text-[10px]","font-bold","uppercase","tracking-wide","border",3,"ngClass"],[1,"bg-slate-50","rounded-lg","p-3","mb-4","border","border-slate-100"],[1,"text-xs","font-bold","text-slate-500","uppercase","mb-1"],[1,"text-sm","text-slate-700"],[1,"flex","items-center","justify-between","text-xs","text-slate-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","gap-1.5"],["name","user",1,"w-3.5","h-3.5"],[1,"text-slate-700"],["name","arrow-up-right",1,"w-3.5","h-3.5"],["name","clock",1,"w-3.5","h-3.5"],["class","flex items-center gap-2",4,"ngIf"],["class","mt-4 bg-green-50 rounded-lg p-3 border border-green-100",4,"ngIf"],[1,"flex","items-center","gap-2"],["class","px-3 py-1.5 bg-amber-50 text-amber-700 border border-amber-200 rounded-lg text-xs font-semibold hover:bg-amber-100 transition-colors flex items-center gap-1.5",3,"click",4,"ngIf"],[1,"px-3","py-1.5","bg-green-600","text-white","rounded-lg","text-xs","font-semibold","hover:bg-green-700","transition-colors","flex","items-center","gap-1.5",3,"click"],["name","check-circle",1,"w-3","h-3"],[1,"px-3","py-1.5","bg-amber-50","text-amber-700","border","border-amber-200","rounded-lg","text-xs","font-semibold","hover:bg-amber-100","transition-colors","flex","items-center","gap-1.5",3,"click"],["name","eye",1,"w-3","h-3"],[1,"mt-4","bg-green-50","rounded-lg","p-3","border","border-green-100"],[1,"text-xs","font-bold","text-green-700","uppercase","mb-1"],[1,"text-sm","text-green-800"],[1,"text-[10px]","text-green-600","mt-1"],[1,"text-center","py-20","bg-white","rounded-xl","border","border-dashed","border-slate-300"],[1,"inline-flex","items-center","justify-center","w-16","h-16","rounded-full","bg-green-50","mb-4"],["name","check-circle",1,"w-8","h-8","text-green-400"],[1,"text-lg","font-medium","text-slate-900"],[1,"text-slate-500","mt-2"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/40","backdrop-blur-sm"],[1,"bg-white","rounded-2xl","shadow-2xl","w-full","max-w-lg","mx-4","overflow-hidden"],[1,"px-6","py-4","border-b","border-slate-200","flex","items-center","justify-between"],[1,"text-lg","font-bold","text-slate-900"],[1,"p-1.5","hover:bg-slate-100","rounded-lg","text-slate-400",3,"click"],["name","x",1,"w-5","h-5"],[1,"p-6","space-y-4"],[1,"block","text-xs","font-bold","text-slate-500","uppercase","mb-1.5"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-2.5","rounded-lg","border","text-sm","font-semibold","transition-colors",3,"click","ngClass"],["rows","3","placeholder","Enter resolution details...",1,"w-full","px-3","py-2","border","border-slate-200","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-200","focus:border-blue-400",3,"ngModelChange","ngModel"],[1,"px-6","py-4","border-t","border-slate-200","flex","justify-end","gap-3"],[1,"px-4","py-2","text-sm","font-semibold","text-slate-700","hover:bg-slate-50","rounded-lg","border","border-dbs-border",3,"click"],[1,"px-4","py-2","text-sm","font-semibold","text-white","bg-green-600","hover:bg-green-700","rounded-lg","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"]],template:function(e,l){e&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),u(4,"lucide-icon",3),r(5," Escalation Queue "),i(),n(6,"p",4),r(7,"Dispute resolution and escalated issues requiring COO attention."),i()(),n(8,"div",5)(9,"div",6),r(10),i()()(),n(11,"div",7)(12,"div",8),_(13,J,3,10,"button",9),i()(),n(14,"div",10)(15,"div",11),_(16,G,42,22,"div",12)(17,K,7,1,"div",13),i()(),_(18,X,25,4,"div",14),i()),e&2&&(a(10),g(" ",l.escalations.length," Active "),a(3),d("ngForOf",l.tabs),a(3),d("ngForOf",l.filteredEscalations),a(),d("ngIf",l.filteredEscalations.length===0),a(),d("ngIf",l.resolveModal))},dependencies:[D,T,V,O,Q,M,$,A,j,U],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};export{F as a};
