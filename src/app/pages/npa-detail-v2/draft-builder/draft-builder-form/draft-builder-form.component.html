<div class="flex-1 flex flex-col overflow-hidden">
  <!-- Section title bar -->
  <div class="flex-none px-8 py-4 border-b border-slate-100 flex items-center justify-between bg-white">
    <div>
      <div class="flex items-center gap-2">
        <span class="text-xs font-mono text-slate-400">{{ section.numbering }}</span>
        <h2 class="text-base font-semibold text-slate-900">{{ section.label }}</h2>
      </div>
      <div class="flex items-center gap-3 mt-1">
        <span class="text-[10px] font-medium px-2 py-0.5 rounded-full" [ngClass]="getOwnerColor(section.owner)">{{ getOwnerLabel(section.owner) }}</span>
        <span class="text-[11px] text-slate-400">{{ getSectionProgress().filled }} of {{ getSectionProgress().total }} completed</span>
      </div>
    </div>
    <div class="flex items-center gap-1">
      <button (click)="navigatePrev.emit()" [disabled]="sectionIndex === 0"
        class="p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 transition-colors disabled:opacity-20">
        <lucide-icon name="chevron-left" class="w-4 h-4"></lucide-icon>
      </button>
      <span class="text-[11px] text-slate-400 tabular-nums w-8 text-center">{{ sectionIndex + 1 }}/{{ totalSections }}</span>
      <button (click)="navigateNext.emit()" [disabled]="sectionIndex === totalSections - 1"
        class="p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 transition-colors disabled:opacity-20">
        <lucide-icon name="chevron-right" class="w-4 h-4"></lucide-icon>
      </button>
    </div>
  </div>

  <!-- Scrollable fields -->
  <div class="flex-1 overflow-y-auto scroll-region bg-slate-50/30">
    <div class="max-w-2xl mx-auto py-6 px-8 space-y-5">

      <!-- Top-level fields -->
      <app-draft-field-card *ngFor="let field of section.fields"
        [field]="field"
        [comments]="getFieldComments(field.key)"
        (valueChanged)="onValueChanged()"
        (commentAdded)="onCommentAdded($event)"
        (commentResolved)="onCommentResolved($event)">
      </app-draft-field-card>

      <!-- Sub-sections -->
      <div *ngFor="let sub of section.subSections" class="space-y-4">
        <!-- Sub-section heading -->
        <button (click)="toggleSubSection(sub.id)"
          class="w-full flex items-center gap-2 pt-4 pb-2 text-left group">
          <lucide-icon [name]="isSubSectionExpanded(sub.id) ? 'chevron-down' : 'chevron-right'"
            class="w-3.5 h-3.5 text-slate-400 flex-none transition-transform"></lucide-icon>
          <span class="text-xs font-semibold text-slate-700 uppercase tracking-wide">{{ sub.numbering }}. {{ sub.label }}</span>
          <span class="text-[10px] text-slate-400">{{ sub.fields.length }}</span>
          <div class="flex-1 border-b border-slate-200 ml-2"></div>
        </button>

        <!-- Sub-section fields -->
        <div *ngIf="isSubSectionExpanded(sub.id)" class="space-y-4 pl-5 border-l border-slate-200">
          <app-draft-field-card *ngFor="let field of sub.fields"
            [field]="field"
            [comments]="getFieldComments(field.key)"
            (valueChanged)="onValueChanged()"
            (commentAdded)="onCommentAdded($event)"
            (commentResolved)="onCommentResolved($event)">
          </app-draft-field-card>
        </div>
      </div>
    </div>
  </div>
</div>
