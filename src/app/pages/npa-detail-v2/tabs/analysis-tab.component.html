<!-- Analysis Tab — Classification, Risk Assessment, ML Prediction -->
<div class="max-w-6xl mx-auto space-y-6">

  <!-- ── Classification Card ──────────────────────────────── -->
  <div class="bg-white rounded-xl border border-slate-200 shadow-sm">
    <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="p-2 rounded-lg bg-indigo-50 text-indigo-600">
          <lucide-icon name="scan-search" class="w-5 h-5"></lucide-icon>
        </div>
        <div>
          <h2 class="text-base font-semibold text-slate-900">Classification</h2>
          <p class="text-xs text-slate-500">Product type &amp; approval track determination</p>
        </div>
      </div>
      <div class="text-right">
        <p class="text-xs text-slate-400 mb-1">Confidence</p>
        <p class="text-xl font-bold text-indigo-600">{{ classification.overallConfidence * 100 | number:'1.0-0' }}%</p>
      </div>
    </div>
    <div class="p-6">
      <!-- Type + Track badges -->
      <div class="flex items-center gap-3 mb-5">
        <span class="px-3 py-1 rounded-lg text-sm font-semibold bg-slate-100 text-slate-900 border border-slate-200">
          {{ classification.type }}
        </span>
        <lucide-icon name="arrow-right" class="w-4 h-4 text-slate-300"></lucide-icon>
        <span class="px-3 py-1 rounded-lg text-sm font-semibold bg-blue-100 text-blue-800 border border-blue-200">
          {{ classification.track }}
        </span>
      </div>

      <!-- Analysis Summary -->
      <div *ngIf="classification.analysisSummary?.length" class="mb-5">
        <ul class="space-y-1.5">
          <li *ngFor="let point of classification.analysisSummary" class="flex items-start gap-2 text-sm text-slate-600">
            <lucide-icon name="check-circle" class="w-4 h-4 text-blue-500 mt-0.5 flex-none"></lucide-icon>
            {{ point }}
          </li>
        </ul>
      </div>

      <!-- Scorecard -->
      <h3 class="text-sm font-semibold text-slate-700 mb-3">Scoring Breakdown</h3>
      <div class="space-y-3">
        <div *ngFor="let sc of classification.scores" class="card-lift p-3 rounded-lg border border-slate-100">
          <div class="flex items-center justify-between mb-1.5">
            <span class="text-sm font-medium text-slate-900">{{ sc.criterion }}</span>
            <span class="text-sm font-bold text-slate-700">{{ sc.score }}/{{ sc.maxScore }}</span>
          </div>
          <div class="h-1.5 bg-slate-100 rounded-full overflow-hidden mb-2">
            <div class="h-full bg-indigo-500 rounded-full transition-all" [style.width]="getScoreBarWidth(sc.score, sc.maxScore)"></div>
          </div>
          <p class="text-xs text-slate-500">{{ sc.reasoning }}</p>
        </div>
      </div>

      <!-- Mandatory Sign-Offs -->
      <div class="mt-5 pt-4 border-t border-slate-100">
        <h3 class="text-sm font-semibold text-slate-700 mb-2">Mandatory Sign-Offs Required</h3>
        <div class="flex flex-wrap gap-2">
          <span *ngFor="let so of classification.mandatorySignOffs"
            class="px-2.5 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200">
            {{ so }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- ── Risk Assessment Card ─────────────────────────────── -->
  <div class="bg-white rounded-xl border border-slate-200 shadow-sm">
    <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="p-2 rounded-lg bg-orange-50 text-orange-600">
          <lucide-icon name="shield-alert" class="w-5 h-5"></lucide-icon>
        </div>
        <div>
          <h2 class="text-base font-semibold text-slate-900">Risk Assessment</h2>
          <p class="text-xs text-slate-500">5-layer cascade + 7-domain analysis</p>
        </div>
      </div>
      <!-- Overall score ring -->
      <div class="flex items-center gap-4">
        <div class="text-right">
          <p class="text-xs text-slate-400 mb-1">Overall Score</p>
          <div class="flex items-center gap-2">
            <span class="text-2xl font-bold" [ngClass]="{
              'text-emerald-600': risk.overallScore < 40,
              'text-amber-600': risk.overallScore >= 40 && risk.overallScore < 70,
              'text-red-600': risk.overallScore >= 70
            }">{{ risk.overallScore }}</span>
            <span class="text-xs px-2 py-0.5 rounded-full font-bold border"
              [ngClass]="getRatingColor(risk.overallRating)">{{ risk.overallRating }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="p-6 space-y-6">

      <!-- 5-Layer Cascade -->
      <div>
        <h3 class="text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2">
          <lucide-icon name="layers" class="w-4 h-4 text-slate-400"></lucide-icon>
          5-Layer Risk Cascade
        </h3>
        <div class="space-y-2">
          <div *ngFor="let layer of risk.layers"
            class="rounded-lg border p-4 transition-all"
            [ngClass]="{
              'border-emerald-200 bg-emerald-50/30': layer.status === 'PASS',
              'border-amber-200 bg-amber-50/30': layer.status === 'WARNING',
              'border-red-200 bg-red-50/30': layer.status === 'FAIL'
            }">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <lucide-icon [name]="layer.status === 'PASS' ? 'check-circle' : layer.status === 'WARNING' ? 'alert-triangle' : 'x-circle'"
                  class="w-4 h-4"
                  [ngClass]="{
                    'text-emerald-500': layer.status === 'PASS',
                    'text-amber-500': layer.status === 'WARNING',
                    'text-red-500': layer.status === 'FAIL'
                  }"></lucide-icon>
                <span class="text-sm font-semibold text-slate-900">{{ layer.name }}</span>
              </div>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full border" [ngClass]="getStatusColor(layer.status)">{{ layer.status }}</span>
            </div>
            <p class="text-xs text-slate-600 mb-2 pl-6">{{ layer.details }}</p>
            <!-- Checks -->
            <div class="pl-6 space-y-1">
              <div *ngFor="let check of layer.checks" class="flex items-center gap-2 text-xs">
                <lucide-icon [name]="check.status === 'PASS' ? 'check' : check.status === 'WARNING' ? 'alert-circle' : 'x'"
                  class="w-3 h-3"
                  [ngClass]="{
                    'text-emerald-500': check.status === 'PASS',
                    'text-amber-500': check.status === 'WARNING',
                    'text-red-500': check.status === 'FAIL'
                  }"></lucide-icon>
                <span class="text-slate-700 font-medium">{{ check.name }}</span>
                <span class="text-slate-400">&mdash; {{ check.detail }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 7-Domain Assessment -->
      <div>
        <h3 class="text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2">
          <lucide-icon name="target" class="w-4 h-4 text-slate-400"></lucide-icon>
          7-Domain Risk Assessment
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div *ngFor="let d of risk.domainAssessments"
            class="card-lift p-4 rounded-lg border border-slate-100">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-semibold text-slate-900">{{ d.domain }}</span>
              <span class="text-[11px] font-bold px-2 py-0.5 rounded-full border" [ngClass]="getRatingColor(d.rating)">
                {{ d.score }} &middot; {{ d.rating }}
              </span>
            </div>
            <div class="h-1.5 bg-slate-100 rounded-full overflow-hidden mb-2">
              <div class="h-full rounded-full domain-bar"
                [style.width.%]="d.score"
                [ngClass]="{
                  'bg-emerald-500': d.score < 40,
                  'bg-amber-500': d.score >= 40 && d.score < 70,
                  'bg-red-500': d.score >= 70
                }"></div>
            </div>
            <div class="space-y-1">
              <p *ngFor="let f of d.keyFindings" class="text-xs text-slate-600 flex items-start gap-1.5">
                <lucide-icon name="alert-circle" class="w-3 h-3 text-slate-400 mt-0.5 flex-none"></lucide-icon>
                {{ f }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div *ngIf="risk.recommendations?.length" class="pt-4 border-t border-slate-100">
        <h3 class="text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2">
          <lucide-icon name="lightbulb" class="w-4 h-4 text-amber-500"></lucide-icon>
          Recommendations
        </h3>
        <div class="space-y-2">
          <div *ngFor="let rec of risk.recommendations; let i = index"
            class="flex items-start gap-3 p-3 rounded-lg bg-amber-50/50 border border-amber-100">
            <span class="w-5 h-5 rounded-full bg-amber-100 text-amber-700 text-xs font-bold flex items-center justify-center flex-none">{{ i + 1 }}</span>
            <p class="text-sm text-slate-700">{{ rec }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ── ML Prediction Card ───────────────────────────────── -->
  <div class="bg-white rounded-xl border border-slate-200 shadow-sm">
    <div class="px-6 py-4 border-b border-slate-100 flex items-center gap-3">
      <div class="p-2 rounded-lg bg-violet-50 text-violet-600">
        <lucide-icon name="brain-circuit" class="w-5 h-5"></lucide-icon>
      </div>
      <div>
        <h2 class="text-base font-semibold text-slate-900">ML Prediction</h2>
        <p class="text-xs text-slate-500">Machine learning approval forecast</p>
      </div>
    </div>
    <div class="p-6">
      <!-- KPI Row -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="rounded-lg bg-emerald-50 border border-emerald-100 p-4 text-center">
          <p class="text-2xl font-bold text-emerald-700">{{ mlPrediction.approvalLikelihood }}%</p>
          <p class="text-xs text-emerald-600 mt-1">Approval Likelihood</p>
        </div>
        <div class="rounded-lg bg-blue-50 border border-blue-100 p-4 text-center">
          <p class="text-2xl font-bold text-blue-700">{{ mlPrediction.timelineDays }}d</p>
          <p class="text-xs text-blue-600 mt-1">Estimated Timeline</p>
        </div>
        <div class="rounded-lg bg-amber-50 border border-amber-100 p-4 text-center">
          <p class="text-2xl font-bold text-amber-700">{{ mlPrediction.bottleneckDept }}</p>
          <p class="text-xs text-amber-600 mt-1">Bottleneck</p>
        </div>
        <div class="rounded-lg bg-slate-50 border border-slate-100 p-4 text-center">
          <p class="text-2xl font-bold text-slate-700">{{ mlPrediction.riskScore }}</p>
          <p class="text-xs text-slate-500 mt-1">Risk Score</p>
        </div>
      </div>

      <!-- Feature Importance -->
      <h3 class="text-sm font-semibold text-slate-700 mb-3">Feature Importance</h3>
      <div class="space-y-2.5 mb-6">
        <div *ngFor="let f of mlPrediction.features" class="flex items-center gap-3">
          <span class="text-xs text-slate-600 w-40 flex-none truncate">{{ f.name }}</span>
          <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
            <div class="h-full bg-violet-500 rounded-full" [style.width.%]="f.importance * 100"></div>
          </div>
          <span class="text-xs font-mono text-slate-500 w-14 text-right">{{ (f.importance * 100) | number:'1.0-0' }}%</span>
          <span class="text-xs text-slate-400 w-16 text-right truncate">{{ f.value }}</span>
        </div>
      </div>

      <!-- Comparison Insights -->
      <h3 class="text-sm font-semibold text-slate-700 mb-3">Comparison Insights</h3>
      <div class="space-y-2">
        <div *ngFor="let insight of mlPrediction.comparisonInsights"
          class="flex items-start gap-2 text-sm text-slate-600 p-2 rounded-lg bg-slate-50/50">
          <lucide-icon name="sparkles" class="w-4 h-4 text-violet-500 mt-0.5 flex-none"></lucide-icon>
          {{ insight }}
        </div>
      </div>
    </div>
  </div>
</div>
