import{a as W}from"./chunk-E3IMKM74.js";import{f as V}from"./chunk-WR7XAGZW.js";import{Wb as N}from"./chunk-FLFKSUZI.js";import{b as U,c as G,f as j,i as H,j as Y,k as z,m as q}from"./chunk-SL2VEL43.js";import{Bb as s,Cc as O,Dc as P,Ib as L,Jc as K,Kb as E,Mb as o,Na as l,Nb as f,Ob as h,Rb as b,Sb as y,Tb as v,Wb as T,Y as C,_b as M,ab as A,bc as R,ca as p,da as m,eb as w,pb as u,qb as t,rb as i,sb as _,wc as D,xc as I,yb as S,yc as B,zb as g}from"./chunk-IVDQKAZB.js";import{a as F,b as k}from"./chunk-7RJXRMKA.js";var Q=r=>({"animation-delay":r});function ee(r,c){if(r&1){let e=S();t(0,"div",34),g("click",function(){let n=p(e).$implicit,d=s(2);return m(d.openDoc(n))}),t(1,"div",35)(2,"div",36),_(3,"lucide-icon",37),i(),t(4,"h3",38),o(5),i(),t(6,"p",39),o(7),i()(),t(8,"div",40)(9,"div",41)(10,"span",42),o(11),i(),_(12,"span",43),t(13,"span"),o(14),i()(),t(15,"span",44),o(16,"View \u2192"),i()()()}if(r&2){let e=c.$implicit;l(3),u("name",e.icon),l(2),h(" ",e.title),l(2),f(e.desc),l(4),f(e.type),l(3),f(e.date)}}function te(r,c){if(r&1&&(t(0,"section",26)(1,"div",27)(2,"div")(3,"h2",28),_(4,"lucide-icon",29),o(5," Universal Knowledge Bases "),i(),t(6,"p",30),o(7,"Foundational rules applied globally across the NPA lifecycle."),i()(),t(8,"span",31),o(9),i()(),t(10,"div",32),w(11,ee,17,5,"div",33),i()()),r&2){let e=s();l(9),h("",e.universalDocs.length," Documents"),l(2),u("ngForOf",e.universalDocs)}}function ie(r,c){if(r&1){let e=S();t(0,"div",49),g("click",function(){let n=p(e).$implicit,d=s(2);return m(d.openDoc(n))}),t(1,"div",50),o(2),i(),t(3,"div",51)(4,"div",52),_(5,"lucide-icon",37),i(),t(6,"h3",53),o(7),i(),t(8,"p",39),o(9),i()()()}if(r&2){let e=c.$implicit;l(2),h(" ",e.agent," "),l(3),u("name",e.icon),l(2),h(" ",e.title),l(2),f(e.desc)}}function ne(r,c){if(r&1&&(t(0,"section",45)(1,"div",46)(2,"div")(3,"h2",28),_(4,"lucide-icon",47),o(5," Agent-Specific Knowledge Bases "),i(),t(6,"p",30),o(7,"Specialized rulebooks utilized by individual domain agents."),i()(),t(8,"span",31),o(9),i()(),t(10,"div",32),w(11,ie,10,4,"div",48),i()()),r&2){let e=s();u("ngStyle",T(3,Q,e.activeTab==="ALL"?"100ms":"0ms")),l(9),h("",e.agentDocs.length," Documents"),l(2),u("ngForOf",e.agentDocs)}}function oe(r,c){if(r&1){let e=S();t(0,"div",58),g("click",function(){let n=p(e).$implicit,d=s(2);return m(d.openDoc(n))}),t(1,"div",59),_(2,"lucide-icon",60),i(),t(3,"div")(4,"h3",61),o(5),i(),t(6,"p",62),o(7),i()()()}if(r&2){let e=c.$implicit;l(2),u("name",e.icon),l(3),h(" ",e.title),l(2),f(e.desc)}}function ae(r,c){if(r&1&&(t(0,"section",54)(1,"div",46)(2,"div")(3,"h2",28),_(4,"lucide-icon",55),o(5," Workflow & Orchestration "),i(),t(6,"p",30),o(7,"Routing paths, SLA matrices, and escalation frameworks."),i()(),t(8,"span",31),o(9),i()(),t(10,"div",56),w(11,oe,8,3,"div",57),i()()),r&2){let e=s();u("ngStyle",T(3,Q,e.activeTab==="ALL"?"200ms":"0ms")),l(9),h("",e.workflowDocs.length," Documents"),l(2),u("ngForOf",e.workflowDocs)}}function le(r,c){if(r&1&&(t(0,"div",103),o(1),i()),r&2){let e=s(2);l(),h(" ",e.uploadError," ")}}function re(r,c){if(r&1){let e=S();t(0,"div",63)(1,"div",64),g("click",function(){p(e);let n=s();return m(n.closeUploadModal())}),i(),t(2,"div",65)(3,"div",66)(4,"div")(5,"div",67),o(6,"Knowledge Base"),i(),t(7,"div",68),o(8,"Upload a document"),i()(),t(9,"button",69),g("click",function(){p(e);let n=s();return m(n.closeUploadModal())}),_(10,"lucide-icon",70),i()(),t(11,"div",71)(12,"div",72)(13,"div")(14,"label",73),o(15,"Section"),i(),t(16,"select",74),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.ui_category,n)||(d.uploadForm.ui_category=n),m(n)}),t(17,"option",75),o(18,"Universal Rules"),i(),t(19,"option",76),o(20,"Agent Specific"),i(),t(21,"option",77),o(22,"Workflow & Orchestration"),i()()(),t(23,"div")(24,"label",73),o(25,"Doc Type"),i(),t(26,"select",74),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.doc_type,n)||(d.uploadForm.doc_type=n),m(n)}),t(27,"option",78),o(28,"REGULATORY"),i(),t(29,"option",79),o(30,"POLICY"),i(),t(31,"option",80),o(32,"SOP"),i(),t(33,"option",81),o(34,"GOLDEN_SOURCE"),i(),t(35,"option",82),o(36,"PLAYBOOK"),i(),t(37,"option",83),o(38,"TEMPLATE"),i()()()(),t(39,"div")(40,"label",73),o(41,"Title"),i(),t(42,"input",84),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.title,n)||(d.uploadForm.title=n),m(n)}),i()(),t(43,"div")(44,"label",73),o(45,"Description"),i(),t(46,"textarea",85),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.description,n)||(d.uploadForm.description=n),m(n)}),i()(),t(47,"div",72)(48,"div")(49,"label",73),o(50,"Link to agent (optional)"),i(),t(51,"input",86),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.agent_target,n)||(d.uploadForm.agent_target=n),m(n)}),i()(),t(52,"div")(53,"label",73),o(54,"Source URL (optional)"),i(),t(55,"input",87),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.source_url,n)||(d.uploadForm.source_url=n),m(n)}),i()()(),t(56,"div",72)(57,"div")(58,"label",73),o(59,"Display date (optional)"),i(),t(60,"input",88),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.display_date,n)||(d.uploadForm.display_date=n),m(n)}),i()(),t(61,"div")(62,"label",73),o(63,"Visibility"),i(),t(64,"select",74),v("ngModelChange",function(n){p(e);let d=s();return y(d.uploadForm.visibility,n)||(d.uploadForm.visibility=n),m(n)}),t(65,"option",89),o(66,"INTERNAL"),i(),t(67,"option",90),o(68,"PUBLIC"),i()()()(),t(69,"div",91)(70,"div",92)(71,"div",93)(72,"div",94),o(73,"PDF file"),i(),t(74,"div",95),o(75),i()(),t(76,"div",96)(77,"input",97,0),g("change",function(n){p(e);let d=s();return m(d.onUploadFileSelected(n))}),i(),t(79,"button",98),g("click",function(){p(e);let n=L(78);return m(n.click())}),o(80," Choose PDF "),i()()()(),w(81,le,2,1,"div",99),i(),t(82,"div",100)(83,"button",101),g("click",function(){p(e);let n=s();return m(n.closeUploadModal())}),o(84," Cancel "),i(),t(85,"button",102),g("click",function(){p(e);let n=s();return m(n.submitUpload())}),o(86," Upload "),i()()()()}if(r&2){let e=s();l(16),b("ngModel",e.uploadForm.ui_category),l(10),b("ngModel",e.uploadForm.doc_type),l(16),b("ngModel",e.uploadForm.title),l(4),b("ngModel",e.uploadForm.description),l(5),b("ngModel",e.uploadForm.agent_target),l(4),b("ngModel",e.uploadForm.source_url),l(5),b("ngModel",e.uploadForm.display_date),l(4),b("ngModel",e.uploadForm.visibility),l(11),h(" ",(e.uploadFile==null?null:e.uploadFile.name)||"No file selected"," "),l(6),u("ngIf",e.uploadError)}}function de(r,c){if(r&1&&(t(0,"div",112),o(1),i()),r&2){let e=s(2);l(),h(" ",e.difySyncError," ")}}function se(r,c){if(r&1&&(t(0,"div",113),o(1," Imported: "),t(2,"span",114),o(3),i(),o(4," \u2022 Skipped: "),t(5,"span",114),o(6),i(),o(7," \u2022 Errors: "),t(8,"span",114),o(9),i()()),r&2){let e=s(2);l(3),f(e.difySyncResult.imported),l(3),f(e.difySyncResult.skipped),l(3),f(e.difySyncResult.errors)}}function ce(r,c){if(r&1&&(t(0,"div",126),o(1),i()),r&2){let e=s().$implicit;l(),f(e.reason)}}function pe(r,c){if(r&1&&(t(0,"div",127),o(1," PDF: "),t(2,"span",114),o(3),i(),o(4," \u2022 Source URL: "),t(5,"span",114),o(6),i()()),r&2){let e=s().$implicit;l(3),f(e.downloaded_pdf?"yes":"no"),l(3),f(e.source_url?"yes":"no")}}function me(r,c){if(r&1&&(t(0,"div",119)(1,"div",120)(2,"div",121),o(3),i(),t(4,"div",122),o(5),i()(),t(6,"div",123),o(7),i(),w(8,ce,2,1,"div",124)(9,pe,7,2,"div",125),i()),r&2){let e=c.$implicit;l(3),f(e.doc_id),l(),E("text-emerald-700",e.status==="IMPORTED")("text-rose-700",e.status==="ERROR")("text-slate-500",e.status==="SKIPPED"),l(),h(" ",e.status," "),l(2),f(e.title),l(),u("ngIf",e.reason),l(),u("ngIf",e.status==="IMPORTED")}}function ue(r,c){if(r&1&&(t(0,"div",115)(1,"div",116),o(2,"Details (first 8)"),i(),t(3,"div",117),w(4,me,10,11,"div",118),M(5,"slice"),i()()),r&2){let e=s(2);l(4),u("ngForOf",R(5,1,e.difySyncDocs,0,8))}}function ge(r,c){if(r&1){let e=S();t(0,"div",63)(1,"div",64),g("click",function(){p(e);let n=s();return m(n.closeDifySyncModal())}),i(),t(2,"div",65)(3,"div",66)(4,"div")(5,"div",67),o(6,"Knowledge Base"),i(),t(7,"div",68),o(8,"Sync PDFs from Dify Dataset"),i()(),t(9,"button",69),g("click",function(){p(e);let n=s();return m(n.closeDifySyncModal())}),_(10,"lucide-icon",70),i()(),t(11,"div",71)(12,"div")(13,"label",73),o(14,"KB UUID or Name"),i(),t(15,"input",104),v("ngModelChange",function(n){p(e);let d=s();return y(d.difySyncForm.dataset_id,n)||(d.difySyncForm.dataset_id=n),m(n)}),i()(),t(16,"div",72)(17,"div")(18,"label",73),o(19,"Section"),i(),t(20,"select",74),v("ngModelChange",function(n){p(e);let d=s();return y(d.difySyncForm.ui_category,n)||(d.difySyncForm.ui_category=n),m(n)}),t(21,"option",75),o(22,"Universal Rules"),i(),t(23,"option",76),o(24,"Agent Specific"),i(),t(25,"option",77),o(26,"Workflow & Orchestration"),i()()(),t(27,"div")(28,"label",73),o(29,"Visibility"),i(),t(30,"select",74),v("ngModelChange",function(n){p(e);let d=s();return y(d.difySyncForm.visibility,n)||(d.difySyncForm.visibility=n),m(n)}),t(31,"option",89),o(32,"Internal"),i(),t(33,"option",90),o(34,"Public"),i()()()(),t(35,"div",72)(36,"div")(37,"label",73),o(38,"Agent Target (optional)"),i(),t(39,"input",105),v("ngModelChange",function(n){p(e);let d=s();return y(d.difySyncForm.agent_target,n)||(d.difySyncForm.agent_target=n),m(n)}),i()(),t(40,"div")(41,"label",73),o(42,"Doc Type"),i(),t(43,"input",74),v("ngModelChange",function(n){p(e);let d=s();return y(d.difySyncForm.doc_type,n)||(d.difySyncForm.doc_type=n),m(n)}),i()()(),w(44,de,2,1,"div",106)(45,se,10,3,"div",107)(46,ue,6,5,"div",108),i(),t(47,"div",109)(48,"button",110),g("click",function(){p(e);let n=s();return m(n.closeDifySyncModal())}),o(49," Cancel "),i(),t(50,"button",111),g("click",function(){p(e);let n=s();return m(n.submitDifySync())}),o(51," Sync "),i()()()()}if(r&2){let e=s();l(15),b("ngModel",e.difySyncForm.dataset_id),l(5),b("ngModel",e.difySyncForm.ui_category),l(10),b("ngModel",e.difySyncForm.visibility),l(9),b("ngModel",e.difySyncForm.agent_target),l(4),b("ngModel",e.difySyncForm.doc_type),l(),u("ngIf",e.difySyncError),l(),u("ngIf",e.difySyncResult),l(),u("ngIf",e.difySyncDocs.length)}}var X=class r{activeTab="ALL";http=C(K);router=C(V);fallbackUniversalDocs=[{title:"DBS Group NPA Policy & Standard",id:"DBS_10_S_0012_GR",desc:"Overarching global policy (RMG-OR). Defines NTG vs Variation vs Existing classifications and standard 1-year validity.",type:"PDF",date:"Oct 2025",icon:"file-text"},{title:"GFM NPA Standard Operating Procedures",id:"GFM_SOP_v2.3",desc:"Stricter GFM-specific rules. Dictates mandatory 5 sign-offs for cross-border deals and 3-loop-back circuit breaker.",type:"Docs",date:"Jan 2026",icon:"book-open"},{title:"Global Prohibited & Sanctions List",id:"SANCTIONS_2026",desc:'OFAC, UN, EU sanctions list plus internal prohibited products. "Hard Stop" reference for Ideation Agent.',type:"Database",date:"Live",icon:"alert-triangle"},{title:"Regulatory & License Mapping Matrix",id:"REG_MATRIX_Q1",desc:"Matrix of allowed activities per jurisdiction (MAS in SG, HKMA in HK, FCA in UK).",type:"Sheet",date:"Feb 2026",icon:"map"},{title:"Historical NPA Master Archive",id:"NPA_ARCHIVE_DB",desc:"Indexed database of all past NPA documents (1,784+ records) for similarity searches.",type:"Database",date:"Live",icon:"archive"},{title:"DBS Group Holdings Liquidity Policy",id:"DBS_LIQ_POL",desc:"Enterprise-wide liquidity requirements affecting GFM funding and capital products.",type:"PDF",date:"Dec 2025",icon:"droplet"},{title:"GFM Data Management Policy (PURE)",id:"D4D_PURE_v1",desc:"Design for Data (D4D) standards for ensuring Risk Data Aggregation and Reporting compliance.",type:"Docs",date:"Nov 2025",icon:"database"},{title:"Product Approval Committee Charter",id:"PAC_CHARTER_26",desc:"Group PAC mandate for approving New-To-Group (NTG) products before the NPA process begins.",type:"PDF",date:"Jan 2026",icon:"users"},{title:"External Platform Review Standards",id:"EXT_PLATFORM_STDS",desc:"Checklists and risk controls for connecting GFM product flows to third-party vendor platforms.",type:"Sheet",date:"Aug 2025",icon:"monitor-speaker"},{title:"DBS Group Sustainability Framework",id:"ESG_FRAMEWORK",desc:'Definitions and criteria for classifying products as "Green", "Social", or "Sustainable".',type:"PDF",date:"May 2025",icon:"leaf"}];fallbackAgentDocs=[{title:"NPA Decision Matrix / Classification Tree",agent:"Ideation",desc:"Ontological decision tree for NTG vs. Variation vs. Existing mapping.",icon:"git-branch"},{title:"Evergreen Eligibility Master List",agent:"Ideation",desc:"Constantly maintained list of products eligible for the 3-year Evergreen track.",icon:"list-checks"},{title:"Evergreen Usage Tracker API",agent:"Ideation",desc:"Real-time tracker of current Evergreen notional usage against the $500M GFM-wide cap.",icon:"activity"},{title:"Approved FX Bundles List",agent:"Ideation",desc:"Catalog of 28+ pre-approved FX derivative bundles (KIKO, Boosted KO Forward) bypassing arbitration.",icon:"package"},{title:"Cross-Border Booking Rulebook",agent:"Regulatory",desc:"Legal implications for cross-location trades (e.g., SG booking with HK entity).",icon:"globe"},{title:"Third-Party Comm Channels Risk Matrix",agent:"Compliance",desc:"Classification matrix (High/Low impact) for using WhatsApp, WeChat, external sites.",icon:"message-square"},{title:"Standard Legal Template Library",agent:"Legal",desc:"Approved boilerplate clauses for ISDA, GMRA, NAFMII, and CSA agreements.",icon:"scale"},{title:"Financial Crime Risk Guidelines (Appx 3)",agent:"Compliance",desc:"Questionnaires and compliance standards for AML, CFT, and Fraud assessment.",icon:"shield-alert"},{title:"Accounting Treatment Standards",agent:"Finance",desc:"Rules determining Trading Book vs Banking Book, FVPL vs FVOCI.",icon:"calculator"},{title:"ROAE Sensitivity Analysis Templates",agent:"Finance",desc:"Required calculation templates for any product with a notional >$20M.",icon:"trending-up"},{title:"Global Tax Protocol Database",agent:"Finance",desc:"Guidelines on withholding taxes, VAT, and transfer pricing implications per jurisdiction.",icon:"landmark"},{title:"Approved Pricing Models Registry",agent:"Market Risk",desc:"Mathematically validated pricing models and their specific validation expiry dates.",icon:"bar-chart-2"},{title:"Risk Metric Thresholds",agent:"Market Risk",desc:"Acceptable tolerances for VaR, IR/FX Delta, Vega, LCR, and NSFR impacts.",icon:"thermometer"},{title:"Credit Exposure (PCE/SACCR) Methodologies",agent:"Credit Risk",desc:"Standard formulas for pre-settlement and counterparty credit risk calculations.",icon:"percent"},{title:"Eligible Collateral Master List",agent:"Credit Risk",desc:"Basel-eligible HQLA and acceptable collateral haircut matrices.",icon:"shield-check"},{title:"System Booking Schemas & Typologies",agent:"Tech & Ops",desc:"Mapping of standard products to Murex/Mini/FA typologies.",icon:"server"},{title:"BCM Standards (BIA/RTO/RPO)",agent:"Tech & Ops",desc:"Rules for required RTO/RPO limits and Business Impact Analysis generation.",icon:"hard-drive"}];fallbackWorkflowDocs=[{title:"SOP SLA Matrix",desc:"Turnaround times for paths (e.g., 48 hours for Impending Deal, targets for Full NPA).",icon:"clock"},{title:"PIR Playbook",desc:"Rules for triggering PIRs (6 months post-launch), tracking conditions, and repeating failed PIRs.",icon:"clipboard-check"},{title:"Governance Hierarchy & Escalation Paths",desc:"Contact mapping for GFM COO Office, PAC, and Forum routing.",icon:"network"},{title:"Bundling Arbitration Team Charter",desc:"Arbitration rules when a bundle fails one of the 8 safety conditions.",icon:"gavel"},{title:"Fast-Track Dormant Reactivation Rules",desc:"Requirements to bypass NPA Lite for products dormant under 3 years with no variations.",icon:"zap"}];universalDocs=[...this.fallbackUniversalDocs];agentDocs=[...this.fallbackAgentDocs];workflowDocs=[...this.fallbackWorkflowDocs];isLoading=!0;showUploadModal=!1;uploadError=null;showDifySyncModal=!1;difySyncError=null;difySyncResult=null;difySyncForm={dataset_id:"",ui_category:"UNIVERSAL",doc_type:"REGULATORY",agent_target:"",icon_name:"file-text",visibility:"INTERNAL"};uploadForm={title:"",description:"",ui_category:"UNIVERSAL",doc_type:"REGULATORY",agent_target:"",icon_name:"file-text",display_date:"",visibility:"INTERNAL",source_url:""};uploadFile=null;ngOnInit(){this.fetchData()}fetchData(){this.isLoading=!0,this.http.get("/api/knowledge").subscribe({next:c=>{let e=Array.isArray(c)?c:[],a=x=>{let $=String(x?.category||x?.ui_category||"").trim().toUpperCase();return k(F({},x),{category:$,icon:x.icon_name||x.icon||"file-text",desc:x.description,agent:x.agent_target,type:x.doc_type||x.doc_format||x.type||null,date:x.display_date||(x.last_synced?new Date(x.last_synced).toLocaleDateString():"N/A")})},n=e.map(a),d=n.filter(x=>x.category==="UNIVERSAL"),J=n.filter(x=>x.category==="AGENT"),Z=n.filter(x=>x.category==="WORKFLOW");n.length>0?(this.universalDocs=d,this.agentDocs=J,this.workflowDocs=Z):(this.universalDocs=[...this.fallbackUniversalDocs],this.agentDocs=[...this.fallbackAgentDocs],this.workflowDocs=[...this.fallbackWorkflowDocs]),this.isLoading=!1},error:c=>{console.warn("[KnowledgeBase] Failed to fetch data from DB; using fallback.",c),this.isLoading=!1}})}openDoc(c){let e=c?.doc_id||c?.docId||c?.id;e&&this.router.navigate(["/knowledge/base",e])}openUploadModal(){this.showUploadModal=!0,this.uploadError=null,this.uploadFile=null,this.uploadForm={title:"",description:"",ui_category:"UNIVERSAL",doc_type:"REGULATORY",agent_target:"",icon_name:"file-text",display_date:"",visibility:"INTERNAL",source_url:""}}closeUploadModal(){this.showUploadModal=!1,this.uploadError=null,this.uploadFile=null}openDifySyncModal(){this.showDifySyncModal=!0,this.difySyncError=null,this.difySyncResult=null,this.difySyncForm={dataset_id:"",ui_category:this.activeTab==="AGENT"?"AGENT":this.activeTab==="WORKFLOW"?"WORKFLOW":"UNIVERSAL",doc_type:"REGULATORY",agent_target:"",icon_name:"file-text",visibility:"INTERNAL"}}closeDifySyncModal(){this.showDifySyncModal=!1,this.difySyncError=null,this.difySyncResult=null}get difySyncDocs(){return this.difySyncResult?.docs||[]}submitDifySync(){this.difySyncError=null,this.difySyncResult=null;let c=(this.difySyncForm.dataset_id||"").trim();if(!c){this.difySyncError="Please enter a Dify Dataset ID.";return}this.http.post("/api/kb/dify/sync",{dataset_id:c,ui_category:this.difySyncForm.ui_category,doc_type:this.difySyncForm.doc_type,agent_target:(this.difySyncForm.agent_target||"").trim()||null,icon_name:(this.difySyncForm.icon_name||"file-text").trim(),visibility:this.difySyncForm.visibility}).subscribe({next:e=>{this.difySyncResult=e,this.fetchData()},error:e=>{let a=e?.error?.error||e?.message||"Sync failed";this.difySyncError=String(a)}})}onUploadFileSelected(c){let e=c.target;this.uploadFile=e.files?.[0]||null}submitUpload(){if(this.uploadError=null,!this.uploadFile){this.uploadError="Please choose a PDF file.";return}let c=this.uploadFile.name.replace(/\.pdf$/i,""),e=new FormData;e.append("file",this.uploadFile),e.append("title",(this.uploadForm.title||c).trim()),e.append("description",(this.uploadForm.description||"").trim()),e.append("ui_category",this.uploadForm.ui_category),e.append("doc_type",this.uploadForm.doc_type),e.append("agent_target",(this.uploadForm.agent_target||"").trim()),e.append("icon_name",(this.uploadForm.icon_name||"file-text").trim()),e.append("display_date",(this.uploadForm.display_date||"").trim()),e.append("visibility",this.uploadForm.visibility),(this.uploadForm.source_url||"").trim()&&e.append("source_url",this.uploadForm.source_url.trim()),this.http.post("/api/kb/upload",e).subscribe({next:a=>{this.closeUploadModal(),this.fetchData(),a?.doc_id&&this.router.navigate(["/knowledge/base",a.doc_id])},error:a=>{let n=a?.error?.error||a?.message||"Upload failed";this.uploadError=String(n)}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=A({type:r,selectors:[["app-knowledge-base"]],decls:40,vars:53,consts:[["kbFile",""],[1,"h-full","flex","flex-col","bg-slate-50","relative","overflow-hidden"],[1,"flex-none","bg-white","border-b","border-slate-200","px-6","py-5","flex","items-center","justify-between","z-10"],[1,"flex","items-center","gap-2","text-sm","text-slate-500","mb-1"],["name","book-open",1,"w-4","h-4"],[1,"font-medium"],["name","chevron-right",1,"w-3","h-3"],[1,"text-slate-800","font-semibold"],[1,"text-2xl","font-bold","text-slate-900","tracking-tight"],[1,"text-sm","text-slate-500","mt-1","max-w-2xl"],[1,"flex","items-center","gap-3"],[1,"relative","group"],["name","search",1,"w-4","h-4","text-slate-400","absolute","left-3","top-1/2","-translate-y-1/2"],["type","text","placeholder","Search policies, tags, or IDs...",1,"pl-9","pr-4","py-2","w-64","bg-slate-100","hover:bg-slate-200/60","focus:bg-white","border","border-transparent","focus:border-blue-500","focus:ring-2","focus:ring-blue-100","placeholder:text-slate-400","text-sm","rounded-lg","transition-all","outline-none"],[1,"flex","items-center","gap-2","px-4","py-2","bg-white","border","border-slate-200","hover:bg-slate-50","text-slate-800","text-sm","font-semibold","rounded-lg","shadow-sm","transition-all",3,"click"],["name","refresh-cw",1,"w-4","h-4"],[1,"flex","items-center","gap-2","px-4","py-2","bg-blue-600","hover:bg-blue-700","text-white","text-sm","font-semibold","rounded-lg","shadow-sm","shadow-blue-600/20","transition-all",3,"click"],["name","upload-cloud",1,"w-4","h-4"],[1,"flex-1","overflow-y-auto","p-6","scrollbar-hide"],[1,"max-w-7xl","mx-auto","space-y-8"],[1,"flex","items-center","gap-2","bg-white","p-1","rounded-xl","border","border-slate-200","inline-flex","shadow-sm"],[1,"px-5","py-2","text-sm","font-semibold","rounded-lg","transition-all",3,"click"],["class","space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",4,"ngIf"],["class","space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500 fill-mode-both",3,"ngStyle",4,"ngIf"],["class","space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500 fill-mode-both mb-10",3,"ngStyle",4,"ngIf"],["class","fixed inset-0 z-50 flex items-center justify-center",4,"ngIf"],[1,"space-y-4","animate-in","fade-in","slide-in-from-bottom-4","duration-500"],[1,"flex","items-end","justify-between"],[1,"text-lg","font-bold","text-slate-800","flex","items-center","gap-2"],["name","globe",1,"w-5","h-5","text-blue-600"],[1,"text-[13px]","text-slate-500","mt-1"],[1,"text-xs","font-bold","text-slate-400","uppercase","tracking-wider"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],["class","group bg-white rounded-xl border border-slate-200 overflow-hidden hover:shadow-xl hover:shadow-slate-200/50 hover:border-slate-300 transition-all cursor-pointer flex flex-col h-full",3,"click",4,"ngFor","ngForOf"],[1,"group","bg-white","rounded-xl","border","border-slate-200","overflow-hidden","hover:shadow-xl","hover:shadow-slate-200/50","hover:border-slate-300","transition-all","cursor-pointer","flex","flex-col","h-full",3,"click"],[1,"p-5","flex-1","flex","flex-col"],[1,"w-10","h-10","rounded-lg","bg-blue-50","text-blue-600","flex","items-center","justify-center","mb-4","group-hover:scale-110","group-hover:bg-blue-600","group-hover:text-white","transition-all","duration-300"],[1,"w-5","h-5",3,"name"],[1,"font-bold","text-slate-900","text-[15px]","leading-tight","mb-2","group-hover:text-blue-700","transition-colors"],[1,"text-xs","text-slate-500","leading-relaxed","flex-1"],[1,"px-5","py-3","bg-slate-50","border-t","border-slate-100","flex","items-center","justify-between","text-xs","font-medium"],[1,"flex","items-center","gap-2","text-slate-400","shrink-0"],[1,"uppercase","tracking-wider","font-bold"],[1,"w-1","h-1","rounded-full","bg-slate-300"],[1,"text-blue-600","font-bold","opacity-0","-translate-x-2","group-hover:opacity-100","group-hover:translate-x-0","transition-all"],[1,"space-y-4","animate-in","fade-in","slide-in-from-bottom-4","duration-500","fill-mode-both",3,"ngStyle"],[1,"flex","items-end","justify-between","mt-8"],["name","cpu",1,"w-5","h-5","text-emerald-600"],["class","group bg-white rounded-xl border border-slate-200 overflow-hidden hover:shadow-xl hover:shadow-emerald-100/50 hover:border-emerald-200 transition-all cursor-pointer flex flex-col h-full relative",3,"click",4,"ngFor","ngForOf"],[1,"group","bg-white","rounded-xl","border","border-slate-200","overflow-hidden","hover:shadow-xl","hover:shadow-emerald-100/50","hover:border-emerald-200","transition-all","cursor-pointer","flex","flex-col","h-full","relative",3,"click"],[1,"absolute","top-4","right-4","bg-slate-100","text-slate-600","text-[10px]","font-bold","uppercase","tracking-wider","px-2","py-1","rounded","border","border-slate-200","group-hover:bg-emerald-50","group-hover:text-emerald-700","group-hover:border-emerald-200","transition-colors"],[1,"p-5","flex-1","flex","flex-col","mt-2"],[1,"w-10","h-10","rounded-lg","bg-emerald-50","text-emerald-600","flex","items-center","justify-center","mb-4","group-hover:scale-110","group-hover:bg-emerald-600","group-hover:text-white","transition-all","duration-300"],[1,"font-bold","text-slate-900","text-[14px]","leading-tight","mb-2","group-hover:text-emerald-700","transition-colors","pr-6"],[1,"space-y-4","animate-in","fade-in","slide-in-from-bottom-4","duration-500","fill-mode-both","mb-10",3,"ngStyle"],["name","git-merge",1,"w-5","h-5","text-indigo-600"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["class","group bg-white rounded-xl border border-slate-200 p-5 flex items-start gap-4 hover:shadow-lg hover:shadow-indigo-100/50 hover:border-indigo-200 transition-all cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"group","bg-white","rounded-xl","border","border-slate-200","p-5","flex","items-start","gap-4","hover:shadow-lg","hover:shadow-indigo-100/50","hover:border-indigo-200","transition-all","cursor-pointer",3,"click"],[1,"w-12","h-12","rounded-xl","bg-indigo-50","text-indigo-600","flex","items-center","justify-center","shrink-0","group-hover:scale-110","group-hover:bg-indigo-600","group-hover:text-white","transition-all","duration-300"],[1,"w-6","h-6",3,"name"],[1,"font-bold","text-slate-900","text-[15px]","mb-1","group-hover:text-indigo-700","transition-colors"],[1,"text-xs","text-slate-500","leading-relaxed"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-slate-900/40",3,"click"],[1,"relative","w-full","max-w-2xl","bg-white","rounded-2xl","shadow-2xl","border","border-slate-200","overflow-hidden"],[1,"px-6","py-4","border-b","border-slate-100","flex","items-center","justify-between"],[1,"text-xs","text-slate-500"],[1,"text-lg","font-bold","text-slate-900"],[1,"p-2","rounded-lg","hover:bg-slate-100","text-slate-600",3,"click"],["name","x",1,"w-5","h-5"],[1,"p-6","space-y-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-xs","font-semibold","text-slate-600","mb-1"],[1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","bg-white",3,"ngModelChange","ngModel"],["value","UNIVERSAL"],["value","AGENT"],["value","WORKFLOW"],["value","REGULATORY"],["value","POLICY"],["value","SOP"],["value","GOLDEN_SOURCE"],["value","PLAYBOOK"],["value","TEMPLATE"],["type","text","placeholder","e.g. MAS Notice 626 \u2014 AML/CFT (Banks)",1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","outline-none","focus:ring-2","focus:ring-blue-100","focus:border-blue-400",3,"ngModelChange","ngModel"],["rows","3","placeholder","Short description for users and agents\u2026",1,"w-full","resize-none","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","outline-none","focus:ring-2","focus:ring-blue-100","focus:border-blue-400",3,"ngModelChange","ngModel"],["type","text","placeholder","e.g. CF_NPA_LCS / Compliance / Finance",1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","outline-none","focus:ring-2","focus:ring-blue-100","focus:border-blue-400",3,"ngModelChange","ngModel"],["type","text","placeholder","https://\u2026",1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","outline-none","focus:ring-2","focus:ring-blue-100","focus:border-blue-400",3,"ngModelChange","ngModel"],["type","text","placeholder","e.g. Jan 2026",1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","outline-none","focus:ring-2","focus:ring-blue-100","focus:border-blue-400",3,"ngModelChange","ngModel"],["value","INTERNAL"],["value","PUBLIC"],[1,"border","border-dashed","border-slate-300","rounded-2xl","p-4","bg-slate-50"],[1,"flex","items-center","justify-between","gap-3"],[1,"min-w-0"],[1,"text-sm","font-semibold","text-slate-800"],[1,"text-xs","text-slate-500","truncate"],[1,"shrink-0"],["type","file","accept","application/pdf",1,"hidden",3,"change"],[1,"px-3","py-2","rounded-xl","bg-white","border","border-slate-200","hover:bg-slate-100","text-sm","font-semibold","text-slate-700",3,"click"],["class","text-sm text-red-600 bg-red-50 border border-red-100 rounded-xl px-3 py-2",4,"ngIf"],[1,"px-6","py-4","border-t","border-slate-100","flex","items-center","justify-end","gap-2","bg-white"],[1,"px-4","py-2","rounded-xl","border","border-slate-200","hover:bg-slate-100","text-sm","font-semibold","text-slate-700",3,"click"],[1,"px-4","py-2","rounded-xl","bg-blue-600","hover:bg-blue-700","text-white","text-sm","font-semibold",3,"click"],[1,"text-sm","text-red-600","bg-red-50","border","border-red-100","rounded-xl","px-3","py-2"],["placeholder","UUID (recommended) or exact KB name",1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","bg-white",3,"ngModelChange","ngModel"],["placeholder","e.g., CF_NPA_LCS",1,"w-full","border","border-slate-200","rounded-xl","px-3","py-2","text-sm","bg-white",3,"ngModelChange","ngModel"],["class","text-sm text-rose-700 bg-rose-50 border border-rose-100 rounded-xl p-3",4,"ngIf"],["class","text-xs text-slate-700 bg-slate-50 border border-slate-200 rounded-xl p-3",4,"ngIf"],["class","text-xs",4,"ngIf"],[1,"px-6","py-4","border-t","border-slate-100","flex","items-center","justify-end","gap-2"],[1,"px-4","py-2","rounded-lg","border","border-slate-200","text-slate-700","font-semibold","hover:bg-slate-50",3,"click"],[1,"px-4","py-2","rounded-lg","bg-blue-600","hover:bg-blue-700","text-white","font-semibold",3,"click"],[1,"text-sm","text-rose-700","bg-rose-50","border","border-rose-100","rounded-xl","p-3"],[1,"text-xs","text-slate-700","bg-slate-50","border","border-slate-200","rounded-xl","p-3"],[1,"font-mono"],[1,"text-xs"],[1,"font-semibold","text-slate-700","mb-2"],[1,"space-y-2","max-h-44","overflow-y-auto","pr-1"],["class","border border-slate-200 rounded-xl p-2 bg-white",4,"ngFor","ngForOf"],[1,"border","border-slate-200","rounded-xl","p-2","bg-white"],[1,"flex","items-center","justify-between"],[1,"font-mono","text-[11px]","text-slate-700"],[1,"text-[11px]","font-semibold"],[1,"text-[11px]","text-slate-600","mt-0.5"],["class","text-[11px] text-rose-700 mt-1 whitespace-pre-wrap",4,"ngIf"],["class","text-[11px] text-slate-500 mt-1",4,"ngIf"],[1,"text-[11px]","text-rose-700","mt-1","whitespace-pre-wrap"],[1,"text-[11px]","text-slate-500","mt-1"]],template:function(e,a){e&1&&(t(0,"div",1)(1,"header",2)(2,"div")(3,"div",3),_(4,"lucide-icon",4),t(5,"span",5),o(6,"Knowledge & Evidence"),i(),_(7,"lucide-icon",6),t(8,"span",7),o(9,"Knowledge Base"),i()(),t(10,"h1",8),o(11,"Enterprise Knowledge Base"),i(),t(12,"p",9),o(13," The centralized repository of policies, SOPs, matrices, and rulebooks used by the COO Multi-Agent Workbench for automated decisioning and compliance checks. "),i()(),t(14,"div",10)(15,"div",11),_(16,"lucide-icon",12)(17,"input",13),i(),t(18,"button",14),g("click",function(){return a.openDifySyncModal()}),_(19,"lucide-icon",15),o(20," Sync from Dify "),i(),t(21,"button",16),g("click",function(){return a.openUploadModal()}),_(22,"lucide-icon",17),o(23," Upload Document "),i()()(),t(24,"div",18)(25,"div",19)(26,"div",20)(27,"button",21),g("click",function(){return a.activeTab="ALL"}),o(28," All Documents "),i(),t(29,"button",21),g("click",function(){return a.activeTab="UNIVERSAL"}),o(30," Universal Rules "),i(),t(31,"button",21),g("click",function(){return a.activeTab="AGENT"}),o(32," Agent-Specific "),i(),t(33,"button",21),g("click",function(){return a.activeTab="WORKFLOW"}),o(34," Workflow & Orchestration "),i()(),w(35,te,12,2,"section",22)(36,ne,12,5,"section",23)(37,ae,12,5,"section",24),i()(),w(38,re,87,10,"div",25)(39,ge,52,8,"div",25),i()),e&2&&(l(27),E("bg-slate-900",a.activeTab==="ALL")("text-white",a.activeTab==="ALL")("shadow",a.activeTab==="ALL")("text-slate-500",a.activeTab!=="ALL")("hover:text-slate-800",a.activeTab!=="ALL")("hover:bg-slate-100",a.activeTab!=="ALL"),l(2),E("bg-slate-900",a.activeTab==="UNIVERSAL")("text-white",a.activeTab==="UNIVERSAL")("shadow",a.activeTab==="UNIVERSAL")("text-slate-500",a.activeTab!=="UNIVERSAL")("hover:text-slate-800",a.activeTab!=="UNIVERSAL")("hover:bg-slate-100",a.activeTab!=="UNIVERSAL"),l(2),E("bg-slate-900",a.activeTab==="AGENT")("text-white",a.activeTab==="AGENT")("shadow",a.activeTab==="AGENT")("text-slate-500",a.activeTab!=="AGENT")("hover:text-slate-800",a.activeTab!=="AGENT")("hover:bg-slate-100",a.activeTab!=="AGENT"),l(2),E("bg-slate-900",a.activeTab==="WORKFLOW")("text-white",a.activeTab==="WORKFLOW")("shadow",a.activeTab==="WORKFLOW")("text-slate-500",a.activeTab!=="WORKFLOW")("hover:text-slate-800",a.activeTab!=="WORKFLOW")("hover:bg-slate-100",a.activeTab!=="WORKFLOW"),l(2),u("ngIf",a.activeTab==="ALL"||a.activeTab==="UNIVERSAL"),l(),u("ngIf",a.activeTab==="ALL"||a.activeTab==="AGENT"),l(),u("ngIf",a.activeTab==="ALL"||a.activeTab==="WORKFLOW"),l(),u("ngIf",a.showUploadModal),l(),u("ngIf",a.showDifySyncModal))},dependencies:[P,D,I,B,q,Y,z,U,H,G,j,W,N,O],encapsulation:2})};export{X as KnowledgeBaseComponent};
