import{a as Be,c as Ve,d as $e}from"./chunk-VS5SVXXY.js";import{a as qe}from"./chunk-J3WGSLJR.js";import{a as Fe}from"./chunk-SAMWE3XV.js";import{a as je}from"./chunk-IUB5JG3Z.js";import{a as B}from"./chunk-E3IMKM74.js";import{f as Oe,g as Me}from"./chunk-WR7XAGZW.js";import{Wb as L,Xb as Ne}from"./chunk-FLFKSUZI.js";import{b as Pe,c as Le,f as Ge,m as We}from"./chunk-SL2VEL43.js";import{$b as ke,Ac as Te,Bb as c,Bc as Re,Dc as P,Fb as ye,Gb as Se,Hb as Ce,Jb as K,Jc as De,Kb as we,Mb as s,Na as a,Nb as f,Ob as u,Pb as U,Qb as Ie,Rb as X,Sa as J,Sb as Z,T as ae,Tb as ee,Vb as se,Wb as fe,Xb as D,Y as V,Yb as k,_b as oe,ab as O,ac as Ae,ca as y,da as S,eb as g,fc as Ee,la as z,n as Y,oa as be,pb as o,qb as r,rb as n,sb as p,vc as M,wc as N,xc as F,yb as C,zb as w}from"./chunk-IVDQKAZB.js";import{a as T,b as G}from"./chunk-7RJXRMKA.js";var le=class i{isSidebarCollapsed=z(!1);isSidebarVisible=z(!0);chatMode=z(null);toggleSidebar(){this.isSidebarCollapsed.update(t=>!t)}setSidebarState(t){this.isSidebarCollapsed.set(t)}setSidebarVisible(t){this.isSidebarVisible.set(t)}enterChatMode(t){this.chatMode.set(G(T({},t),{active:!0}))}exitChatMode(){this.chatMode.set(null)}updateChatTab(t){let e=this.chatMode();e&&this.chatMode.set(G(T({},e),{activeTab:t}))}updateChatSubtitle(t){let e=this.chatMode();e&&this.chatMode.set(G(T({},e),{subtitle:t}))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=ae({token:i,factory:i.\u0275fac,providedIn:"root"})};var ze=(i,t,e)=>({"text-green-600":i,"text-amber-600":t,"text-red-600":e});function Ke(i,t){if(i&1&&(r(0,"div",17),p(1,"lucide-icon",18),r(2,"div")(3,"p",19),s(4,"HARD STOP \u2014 Prohibited Product"),n(),r(5,"p",20),s(6),n()()()),i&2){let e=c(2);a(6),U(" Matched: ",e.result.prohibitedMatch.item," (Layer: ",e.result.prohibitedMatch.layer,") ")}}function Ue(i,t){if(i&1&&(r(0,"div",21)(1,"div",22)(2,"span",23),s(3),n(),r(4,"span",24),s(5),n()(),r(6,"div",25),p(7,"div",26),n(),r(8,"p",27),s(9),n()()),i&2){let e=t.$implicit,l=c(2);a(3),f(e.criterion),a(2),U(" ",e.score,"/",e.maxScore," "),a(2),K("width",e.score/e.maxScore*100,"%"),o("ngClass",l.getScoreBarColor(e.score,e.maxScore)),a(2),u(" ",e.reasoning," ")}}function Qe(i,t){if(i&1&&(r(0,"span",32),s(1),n()),i&2){let e=t.$implicit;a(),u(" ",e," ")}}function Ye(i,t){if(i&1&&(r(0,"div",3)(1,"h4",28),p(2,"lucide-icon",29),s(3," Mandatory Sign-offs Required "),n(),r(4,"div",30),g(5,Qe,2,1,"span",31),n()()),i&2){let e=c(2);a(5),o("ngForOf",e.result.mandatorySignOffs)}}function Je(i,t){if(i&1&&(r(0,"div",39),s(1),n()),i&2){let e=c(3);a(),u(" run: ",e.result.workflowRunId," ")}}function Xe(i,t){if(i&1&&(r(0,"li"),s(1),n()),i&2){let e=t.$implicit;a(),f(e)}}function Ze(i,t){if(i&1&&(r(0,"ul",40),g(1,Xe,2,1,"li",41),n()),i&2){let e=c(3);a(),o("ngForOf",e.result.analysisSummary)}}function et(i,t){if(i&1&&(r(0,"span",51),s(1),n()),i&2){let e=c().$implicit;a(),u(" \u2014 ",e.reason)}}function tt(i,t){if(i&1&&(r(0,"div",45)(1,"div",46)(2,"span",47),s(3),n(),r(4,"span",48),s(5),n(),g(6,et,2,1,"span",49),n(),r(7,"span",50),s(8),n()()),i&2){let e=t.$implicit;a(3),f(e.id),a(2),f(e.name),a(),o("ngIf",e.reason),a(),o("ngClass",e.fired?"bg-red-50 text-red-700 border border-red-200":"bg-slate-50 text-slate-600 border border-slate-200"),a(),u(" ",e.fired?"FIRED":"NO"," ")}}function it(i,t){if(i&1&&(r(0,"div",42)(1,"div",14),s(2,"NTG Triggers"),n(),r(3,"div",43),g(4,tt,9,5,"div",44),n()()),i&2){let e=c(3);a(4),o("ngForOf",e.result.ntgTriggers)}}function nt(i,t){if(i&1&&(r(0,"div",3)(1,"div",33)(2,"h4",34),p(3,"lucide-icon",35),s(4," Rationale "),n(),g(5,Je,2,1,"div",36),n(),g(6,Ze,2,1,"ul",37)(7,it,5,1,"div",38),n()),i&2){let e=c(2);a(5),o("ngIf",e.result.workflowRunId),a(),o("ngIf",e.result.analysisSummary&&e.result.analysisSummary.length),a(),o("ngIf",e.result.ntgTriggers&&e.result.ntgTriggers.length)}}function rt(i,t){if(i&1&&(r(0,"div",56)(1,"div",57),s(2," If this output is narrative text, update the Dify workflow to return JSON-only so the UI can render structured scoring/summary automatically. "),n(),r(3,"pre",58),s(4),n()()),i&2){let e=c(3);a(4),f(e.result.rawOutput)}}function at(i,t){if(i&1){let e=C();r(0,"div",3)(1,"div",52)(2,"h4",34),p(3,"lucide-icon",53),s(4," Full Output "),n(),r(5,"button",54),w("click",function(){y(e);let d=c(2);return S(d.showFullOutput=!d.showFullOutput)}),s(6),n()(),g(7,rt,5,1,"div",55),n()}if(i&2){let e=c(2);a(6),u(" ",e.showFullOutput?"Hide":"Show"," "),a(),o("ngIf",e.showFullOutput)}}function st(i,t){if(i&1&&(r(0,"div",1),g(1,Ke,7,2,"div",2),r(2,"div",3)(3,"div",4)(4,"div",5)(5,"span",6),p(6,"lucide-icon",7),s(7),n(),r(8,"span",6),p(9,"lucide-icon",8),s(10),n()(),r(11,"div",9),p(12,"lucide-icon",10),r(13,"span",11),s(14,"Confidence"),n(),r(15,"span",12),s(16),n()()(),r(17,"div",13)(18,"h4",14),s(19," Classification Criteria "),n(),g(20,Ue,10,7,"div",15),n()(),g(21,Ye,6,1,"div",16)(22,nt,8,3,"div",16)(23,at,8,2,"div",16),n()),i&2){let e=c();a(),o("ngIf",e.result.prohibitedMatch==null?null:e.result.prohibitedMatch.matched),a(4),o("ngClass",e.getTypeBadgeClass(e.result.type)),a(2),u(" ",e.result.type," "),a(),o("ngClass",e.getTrackBadgeClass(e.result.track)),a(2),u(" ",e.result.track," "),a(5),o("ngClass",k(11,ze,e.result.overallConfidence>=80,e.result.overallConfidence>=50&&e.result.overallConfidence<80,e.result.overallConfidence<50)),a(),u(" ",e.result.overallConfidence,"% "),a(4),o("ngForOf",e.result.scores),a(),o("ngIf",e.result.mandatorySignOffs.length>0),a(),o("ngIf",e.result.analysisSummary&&e.result.analysisSummary.length||e.result.ntgTriggers&&e.result.ntgTriggers.length),a(),o("ngIf",e.result.rawOutput)}}var de=class i{result;showFullOutput=!1;getTypeBadgeClass(t){switch(t){case"NTG":return"bg-orange-100 text-orange-700 border border-orange-200";case"Variation":return"bg-blue-100 text-blue-700 border border-blue-200";case"Existing":return"bg-green-100 text-green-700 border border-green-200";default:return"bg-slate-100 text-slate-700 border border-slate-200"}}getTrackBadgeClass(t){switch(t){case"Full NPA":return"bg-red-100 text-red-700 border border-red-200";case"NPA Lite":return"bg-blue-100 text-blue-700 border border-blue-200";case"Evergreen":return"bg-green-100 text-green-700 border border-green-200";case"Prohibited":return"bg-red-200 text-red-900 border border-red-300";default:return"bg-slate-100 text-slate-700 border border-slate-200"}}getScoreBarColor(t,e){let l=t/e*100;return l>=75?"bg-green-500":l>=50?"bg-amber-500":"bg-red-500"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-classification-result"]],inputs:{result:"result"},decls:1,vars:1,consts:[["class","space-y-5",4,"ngIf"],[1,"space-y-5"],["class","w-full bg-red-600 text-white rounded-lg p-4 flex items-center gap-3 shadow-lg animate-pulse",4,"ngIf"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","p-5"],[1,"flex","items-center","justify-between","mb-5"],[1,"flex","items-center","gap-3"],[1,"px-3","py-1.5","rounded-full","text-xs","font-bold","uppercase","tracking-wide",3,"ngClass"],["name","git-branch",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],["name","target",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"flex","items-center","gap-2","text-sm"],["name","gauge",1,"w-4","h-4","text-slate-400"],[1,"text-slate-500","font-medium"],[1,"font-bold","text-lg",3,"ngClass"],[1,"space-y-3"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider","mb-2"],["class","group",4,"ngFor","ngForOf"],["class","bg-white rounded-xl border border-slate-200 shadow-sm p-5",4,"ngIf"],[1,"w-full","bg-red-600","text-white","rounded-lg","p-4","flex","items-center","gap-3","shadow-lg","animate-pulse"],["name","shield-alert",1,"w-6","h-6","flex-shrink-0"],[1,"font-bold","text-lg"],[1,"text-sm","text-red-100"],[1,"group"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-sm","font-medium","text-slate-700"],[1,"text-xs","font-mono","text-slate-500"],[1,"w-full","bg-slate-100","rounded-full","h-2.5","overflow-hidden"],[1,"h-full","rounded-full","transition-all","duration-500",3,"ngClass"],[1,"text-xs","text-slate-400","mt-0.5","opacity-0","group-hover:opacity-100","transition-opacity"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider","mb-3"],["name","clipboard-check",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"flex","flex-wrap","gap-2"],["class","px-3 py-1 rounded-lg bg-slate-100 text-slate-700 text-xs font-medium border border-slate-200",4,"ngFor","ngForOf"],[1,"px-3","py-1","rounded-lg","bg-slate-100","text-slate-700","text-xs","font-medium","border","border-slate-200"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],["name","info",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],["class","text-[11px] text-slate-400 font-mono",4,"ngIf"],["class","list-disc pl-5 space-y-1 text-sm text-slate-700",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"text-[11px]","text-slate-400","font-mono"],[1,"list-disc","pl-5","space-y-1","text-sm","text-slate-700"],[4,"ngFor","ngForOf"],[1,"mt-4"],[1,"space-y-1.5"],["class","flex items-start justify-between gap-3 text-sm",4,"ngFor","ngForOf"],[1,"flex","items-start","justify-between","gap-3","text-sm"],[1,"text-slate-700"],[1,"font-mono","text-[11px]","text-slate-400","mr-2"],[1,"font-medium"],["class","text-slate-500",4,"ngIf"],[1,"px-2","py-0.5","rounded-md","text-[11px]","font-semibold",3,"ngClass"],[1,"text-slate-500"],[1,"flex","items-center","justify-between"],["name","file-text",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"text-xs","font-medium","text-slate-600","hover:text-slate-900","px-2","py-1","rounded-md","border","border-slate-200","hover:bg-slate-50","transition-colors",3,"click"],["class","mt-3",4,"ngIf"],[1,"mt-3"],[1,"text-xs","text-slate-500","mb-2"],[1,"whitespace-pre-wrap","text-[12px]","leading-relaxed","text-slate-800","bg-slate-50","border","border-slate-200","rounded-lg","p-3","overflow-auto","max-h-[420px]"]],template:function(e,l){e&1&&g(0,st,24,15,"div",0),e&2&&o("ngIf",l.result)},dependencies:[P,M,N,F,B,L],encapsulation:2})};var ot=(i,t,e)=>({"text-green-600":i,"text-amber-600":t,"text-red-600":e}),lt=(i,t,e)=>({"bg-green-500":i,"bg-amber-500":t,"bg-red-500":e}),dt=(i,t,e)=>({"bg-green-50":i,"bg-red-50":t,"bg-amber-50":e}),ct=(i,t)=>({"text-green-500":i,"text-red-500":t});function pt(i,t){if(i&1&&(r(0,"div",17),p(1,"lucide-icon",18),r(2,"p",19),s(3,"HARD STOP"),n(),r(4,"p",20),s(5),n()()),i&2){let e=c(2);a(5),u(" ",e.result.hardStopReason||"This product has failed critical risk checks and cannot proceed."," ")}}function mt(i,t){if(i&1&&(r(0,"span",21),s(1),n()),i&2){let e=c(2);o("ngClass",e.getRatingBadgeClass(e.result.overallRating)),a(),u(" ",e.result.overallRating," ")}}function ut(i,t){if(i&1&&(r(0,"div",35)(1,"div",24),p(2,"lucide-icon",36),r(3,"span",37),s(4),n()(),r(5,"span",38),s(6),n()()),i&2){let e=t.$implicit,l=c(4);o("ngClass",k(5,dt,e.status==="PASS",e.status==="FAIL",e.status==="WARNING")),a(2),o("name",l.getStatusIcon(e.status))("ngClass",l.getStatusIconColor(e.status)),a(2),f(e.name),a(2),f(e.detail)}}function gt(i,t){if(i&1&&(r(0,"div",31)(1,"p",32),s(2),n(),r(3,"div",33),g(4,ut,7,9,"div",34),n()()),i&2){let e=c().$implicit;a(2),f(e.details),a(2),o("ngForOf",e.checks)}}function xt(i,t){if(i&1){let e=C();r(0,"div")(1,"div",22)(2,"div",23),w("click",function(){let d=y(e).index,m=c(2);return S(m.toggleLayer(d))}),r(3,"div",7)(4,"div",24)(5,"span",25),s(6),n(),p(7,"lucide-icon",26),n(),r(8,"span",27),s(9),n()(),r(10,"div",24)(11,"span",28),s(12),n(),p(13,"lucide-icon",29),n()(),g(14,gt,5,2,"div",30),n()()}if(i&2){let e=t.$implicit,l=t.index,d=c(2);a(),o("ngClass",d.getLayerBorderClass(e.status)),a(),o("ngClass",d.getLayerBgClass(e.status)),a(4),f(l+1),a(),o("name",d.getStatusIcon(e.status))("ngClass",d.getStatusIconColor(e.status)),a(2),f(e.name),a(2),o("ngClass",d.getStatusBadgeClass(e.status)),a(),u(" ",e.status," "),a(),o("name",d.expandedLayers[l]?"chevron-up":"chevron-down"),a(),o("ngIf",d.expandedLayers[l])}}function ft(i,t){if(i&1&&(r(0,"li",57)(1,"span",58),s(2,"\u2022"),n(),s(3),n()),i&2){let e=t.$implicit;a(3),u(" ",e," ")}}function vt(i,t){if(i&1&&(r(0,"div",53)(1,"p",54),s(2,"Findings"),n(),r(3,"ul",55),g(4,ft,4,1,"li",56),n()()),i&2){let e=c(2).$implicit;a(4),o("ngForOf",e.keyFindings)}}function _t(i,t){if(i&1&&(r(0,"li",60)(1,"span",61),s(2,"\u2713"),n(),s(3),n()),i&2){let e=t.$implicit;a(3),u(" ",e," ")}}function ht(i,t){if(i&1&&(r(0,"div")(1,"p",54),s(2,"Mitigants"),n(),r(3,"ul",55),g(4,_t,4,1,"li",59),n()()),i&2){let e=c(2).$implicit;a(4),o("ngForOf",e.mitigants)}}function bt(i,t){if(i&1&&(r(0,"div",50),g(1,vt,5,1,"div",51)(2,ht,5,1,"div",52),n()),i&2){let e=c().$implicit;a(),o("ngIf",e.keyFindings==null?null:e.keyFindings.length),a(),o("ngIf",e.mitigants==null?null:e.mitigants.length)}}function yt(i,t){if(i&1){let e=C();r(0,"div",42),w("click",function(){let d=y(e).$implicit,m=c(3);return S(m.toggleDomain(d.domain))}),r(1,"div",43)(2,"span",44),s(3),n(),r(4,"span",45),s(5),n()(),r(6,"div",46),s(7),n(),r(8,"div",47),p(9,"div",48),n(),g(10,bt,3,2,"div",49),n()}if(i&2){let e=t.$implicit,l=c(3);o("ngClass",l.getDomainBorderClass(e.rating)),a(3),f(e.domain),a(),o("ngClass",l.getRatingBadgeClass(e.rating)),a(),u(" ",e.rating," "),a(),o("ngClass",l.getDomainScoreColor(e.score)),a(),u(" ",e.score," "),a(2),K("width",e.score,"%"),o("ngClass",l.getDomainBarColor(e.score)),a(),o("ngIf",l.expandedDomains[e.domain])}}function St(i,t){if(i&1&&(r(0,"div",3)(1,"h4",12),p(2,"lucide-icon",39),s(3," 7-Domain Risk Assessment "),n(),r(4,"div",40),g(5,yt,11,10,"div",41),n()()),i&2){let e=c(2);a(5),o("ngForOf",e.result.domainAssessments)}}function Ct(i,t){i&1&&(r(0,"span",68),p(1,"lucide-icon",69),s(2," Finance VP Required (>$20M) "),n())}function wt(i,t){i&1&&(r(0,"span",70),p(1,"lucide-icon",69),s(2," CFO Required (>$100M) "),n())}function It(i,t){i&1&&(r(0,"span",71),p(1,"lucide-icon",72),s(2," ROAE Analysis Required "),n())}function kt(i,t){if(i&1&&(r(0,"span",70),p(1,"lucide-icon",73),s(2),n()),i&2){let e=c(3);a(2),u(" ",e.result.notionalFlags.threshold_breached," ")}}function At(i,t){if(i&1&&(r(0,"div",3)(1,"h4",62),p(2,"lucide-icon",63),s(3," Notional Threshold Flags "),n(),r(4,"div",64),g(5,Ct,3,0,"span",65)(6,wt,3,0,"span",66)(7,It,3,0,"span",67)(8,kt,3,1,"span",66),n()()),i&2){let e=c(2);a(5),o("ngIf",e.result.notionalFlags.finance_vp_required),a(),o("ngIf",e.result.notionalFlags.cfo_required),a(),o("ngIf",e.result.notionalFlags.roae_required),a(),o("ngIf",e.result.notionalFlags.threshold_breached)}}function Et(i,t){if(i&1&&(r(0,"span",79),s(1),n()),i&2){let e=c(3);a(),u(" Deadline: ",e.result.pirRequirements.deadline_months," months post-launch ")}}function Tt(i,t){if(i&1&&(r(0,"li",82),p(1,"lucide-icon",83),s(2),n()),i&2){let e=t.$implicit;a(2),u(" ",e," ")}}function Rt(i,t){if(i&1&&(r(0,"ul",80),g(1,Tt,3,1,"li",81),n()),i&2){let e=c(3);a(),o("ngForOf",e.result.pirRequirements.conditions)}}function Dt(i,t){if(i&1&&(r(0,"div",3)(1,"h4",62),p(2,"lucide-icon",74),s(3," Post-Implementation Review (PIR) "),n(),r(4,"div",75)(5,"span",76),s(6),n(),g(7,Et,2,1,"span",77),n(),g(8,Rt,2,1,"ul",78),n()),i&2){let e=c(2);a(6),u(" ",e.result.pirRequirements.type||"STANDARD"," "),a(),o("ngIf",e.result.pirRequirements.deadline_months),a(),o("ngIf",e.result.pirRequirements.conditions==null?null:e.result.pirRequirements.conditions.length)}}function Ot(i,t){if(i&1&&(r(0,"div",90),s(1," Auto-escalated to: "),r(2,"span",91),s(3),n()()),i&2){let e=c(3);a(3),f(e.result.circuitBreaker.escalation_target)}}function Mt(i,t){if(i&1&&(r(0,"div",84)(1,"h4",85),p(2,"lucide-icon",86),s(3," Circuit Breaker TRIGGERED "),n(),r(4,"div",87),s(5," Loop-back count: "),r(6,"span",88),s(7),n(),s(8),n(),g(9,Ot,4,1,"div",89),n()),i&2){let e=c(2);a(7),f(e.result.circuitBreaker.loop_back_count),a(),u(" / ",e.result.circuitBreaker.threshold||3," "),a(),o("ngIf",e.result.circuitBreaker.escalation_target)}}function Nt(i,t){if(i&1&&(r(0,"div"),s(1," Notional Remaining: "),r(2,"span",91),s(3),oe(4,"number"),n()()),i&2){let e=c(4);a(3),u("",ke(4,1,e.result.evergreenLimits.notional_remaining||0),"M")}}function Ft(i,t){if(i&1&&(r(0,"div"),s(1," Deals Remaining: "),r(2,"span",91),s(3),n()()),i&2){let e=c(4);a(3),f(e.result.evergreenLimits.deal_count_remaining)}}function Pt(i,t){if(i&1&&(r(0,"div",96),g(1,Nt,5,3,"div",52)(2,Ft,4,1,"div",52),n()),i&2){let e=c(3);a(),o("ngIf",e.result.evergreenLimits.notional_remaining!==void 0),a(),o("ngIf",e.result.evergreenLimits.deal_count_remaining!==void 0)}}function Lt(i,t){if(i&1&&(r(0,"span",99),s(1),n()),i&2){let e=t.$implicit;a(),u(" ",e," ")}}function Gt(i,t){if(i&1&&(r(0,"div",97),g(1,Lt,2,1,"span",98),n()),i&2){let e=c(3);a(),o("ngForOf",e.result.evergreenLimits.flags)}}function Wt(i,t){if(i&1&&(r(0,"div",3)(1,"h4",62),p(2,"lucide-icon",92),s(3," Evergreen Eligibility "),n(),r(4,"div",93)(5,"span",28),s(6),n()(),g(7,Pt,3,2,"div",94)(8,Gt,2,1,"div",95),n()),i&2){let e=c(2);a(5),o("ngClass",e.result.evergreenLimits.eligible?"bg-green-100 text-green-700":"bg-slate-100 text-slate-500"),a(),u(" ",e.result.evergreenLimits.eligible?"ELIGIBLE":"NOT ELIGIBLE"," "),a(),o("ngIf",e.result.evergreenLimits.eligible),a(),o("ngIf",e.result.evergreenLimits.flags==null?null:e.result.evergreenLimits.flags.length)}}function Bt(i,t){if(i&1&&(r(0,"span",102),p(1,"lucide-icon",103),s(2),n()),i&2){let e=t.$implicit;a(2),u(" ",e," ")}}function Vt(i,t){if(i&1&&(r(0,"div",3)(1,"h4",62),p(2,"lucide-icon",100),s(3),n(),r(4,"div",64),g(5,Bt,3,1,"span",101),n()()),i&2){let e=c(2);a(3),u(" Mandatory Sign-Offs (",e.result.mandatorySignoffs.length,") "),a(2),o("ngForOf",e.result.mandatorySignoffs)}}function $t(i,t){if(i&1&&(r(0,"div",106),p(1,"lucide-icon",36),r(2,"span",107),s(3),n(),r(4,"span",108),s(5),n()()),i&2){let e=t.$implicit;a(),o("name",e.status==="PASS"?"check-circle-2":"x-circle")("ngClass",D(4,ct,e.status==="PASS",e.status==="FAIL")),a(2),f(e.name),a(2),u(" ",e.category," ")}}function jt(i,t){if(i&1&&(r(0,"div",3)(1,"h4",62),p(2,"lucide-icon",104),s(3," Prerequisites "),n(),r(4,"div",33),g(5,$t,6,7,"div",105),n()()),i&2){let e=c(2);a(5),o("ngForOf",e.result.prerequisites)}}function qt(i,t){if(i&1&&(r(0,"li",111)(1,"span",112),s(2),n(),s(3),n()),i&2){let e=t.$implicit,l=t.index;a(2),u(" ",l+1," "),a(),u(" ",e," ")}}function Ht(i,t){if(i&1&&(r(0,"div",3)(1,"h4",62),p(2,"lucide-icon",109),s(3," Recommendations "),n(),r(4,"ul",33),g(5,qt,4,2,"li",110),n()()),i&2){let e=c(2);a(5),o("ngForOf",e.result.recommendations)}}function zt(i,t){if(i&1&&(r(0,"div",1),g(1,pt,6,1,"div",2),r(2,"div",3)(3,"div",4)(4,"h3",5),p(5,"lucide-icon",6),s(6," Overall Risk Score "),n(),r(7,"div",7),g(8,mt,2,2,"span",8),r(9,"span",9),s(10),n()()(),r(11,"div",10),p(12,"div",11),n()(),r(13,"div",3)(14,"h4",12),s(15," Risk Cascade: Internal Policy \u2192 Regulatory \u2192 Sanctions \u2192 Dynamic \u2192 Finance & Tax "),n(),r(16,"div",13),g(17,xt,15,10,"div",14),n()(),g(18,St,6,1,"div",15)(19,At,9,4,"div",15)(20,Dt,9,3,"div",15)(21,Mt,10,3,"div",16)(22,Wt,9,4,"div",15)(23,Vt,6,2,"div",15)(24,jt,6,1,"div",15)(25,Ht,6,1,"div",15),n()),i&2){let e=c();a(),o("ngIf",e.result.hardStop),a(7),o("ngIf",e.result.overallRating),a(),o("ngClass",k(16,ot,e.result.overallScore<=30,e.result.overallScore>30&&e.result.overallScore<=60,e.result.overallScore>60)),a(),u(" ",e.result.overallScore,"/100 "),a(2),K("width",e.result.overallScore,"%"),o("ngClass",k(20,lt,e.result.overallScore<=30,e.result.overallScore>30&&e.result.overallScore<=60,e.result.overallScore>60)),a(5),o("ngForOf",e.result.layers),a(),o("ngIf",e.result.domainAssessments==null?null:e.result.domainAssessments.length),a(),o("ngIf",e.result.notionalFlags&&e.hasNotionalFlags),a(),o("ngIf",e.result.pirRequirements==null?null:e.result.pirRequirements.required),a(),o("ngIf",e.result.circuitBreaker==null?null:e.result.circuitBreaker.triggered),a(),o("ngIf",e.result.evergreenLimits),a(),o("ngIf",e.result.mandatorySignoffs==null?null:e.result.mandatorySignoffs.length),a(),o("ngIf",e.result.prerequisites&&e.result.prerequisites.length>0),a(),o("ngIf",e.result.recommendations==null?null:e.result.recommendations.length)}}var ce=class i{result;expandedLayers=[];expandedDomains={};ngOnChanges(){this.result?.layers&&(this.expandedLayers=this.result.layers.map(()=>!1))}get hasNotionalFlags(){if(!this.result?.notionalFlags)return!1;let t=this.result.notionalFlags;return!!(t.finance_vp_required||t.cfo_required||t.roae_required||t.threshold_breached)}toggleLayer(t){this.expandedLayers[t]=!this.expandedLayers[t]}toggleDomain(t){this.expandedDomains[t]=!this.expandedDomains[t]}getStatusIcon(t){switch(t){case"PASS":return"check-circle-2";case"FAIL":return"x-circle";case"WARNING":return"alert-triangle";default:return"circle"}}getStatusIconColor(t){switch(t){case"PASS":return"text-green-500";case"FAIL":return"text-red-500";case"WARNING":return"text-amber-500";default:return"text-slate-400"}}getLayerBorderClass(t){switch(t){case"PASS":return"border-green-200";case"FAIL":return"border-red-200";case"WARNING":return"border-amber-200";default:return"border-slate-200"}}getLayerBgClass(t){switch(t){case"PASS":return"bg-green-50/50";case"FAIL":return"bg-red-50/50";case"WARNING":return"bg-amber-50/50";default:return"bg-slate-50"}}getStatusBadgeClass(t){switch(t){case"PASS":return"bg-green-100 text-green-700";case"FAIL":return"bg-red-100 text-red-700";case"WARNING":return"bg-amber-100 text-amber-700";default:return"bg-slate-100 text-slate-700"}}getRatingBadgeClass(t){switch(t?.toUpperCase()){case"LOW":return"bg-green-100 text-green-700";case"MEDIUM":return"bg-amber-100 text-amber-700";case"HIGH":return"bg-red-100 text-red-700";case"CRITICAL":return"bg-red-200 text-red-800";default:return"bg-slate-100 text-slate-700"}}getDomainBorderClass(t){switch(t?.toUpperCase()){case"LOW":return"border-green-200";case"MEDIUM":return"border-amber-200";case"HIGH":return"border-red-200";case"CRITICAL":return"border-red-300";default:return"border-slate-200"}}getDomainScoreColor(t){return t<=30?"text-green-600":t<=60?"text-amber-600":"text-red-600"}getDomainBarColor(t){return t<=30?"bg-green-500":t<=60?"bg-amber-500":"bg-red-500"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-risk-assessment-result"]],inputs:{result:"result"},features:[be],decls:1,vars:1,consts:[["class","space-y-5 relative",4,"ngIf"],[1,"space-y-5","relative"],["class","absolute inset-0 z-10 bg-red-600/95 rounded-xl flex flex-col items-center justify-center text-white p-8",4,"ngIf"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","p-5"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","font-semibold","text-slate-700","flex","items-center","gap-2"],["name","shield",1,"w-4","h-4","text-slate-400"],[1,"flex","items-center","gap-3"],["class","text-xs font-bold uppercase px-2.5 py-1 rounded-full",3,"ngClass",4,"ngIf"],[1,"text-2xl","font-bold",3,"ngClass"],[1,"w-full","bg-slate-100","rounded-full","h-3","overflow-hidden"],[1,"h-full","rounded-full","transition-all","duration-700",3,"ngClass"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider","mb-4"],[1,"space-y-3"],[4,"ngFor","ngForOf"],["class","bg-white rounded-xl border border-slate-200 shadow-sm p-5",4,"ngIf"],["class","bg-red-50 rounded-xl border border-red-200 shadow-sm p-5",4,"ngIf"],[1,"absolute","inset-0","z-10","bg-red-600/95","rounded-xl","flex","flex-col","items-center","justify-center","text-white","p-8"],["name","shield-alert",1,"w-12","h-12","mb-3"],[1,"text-2xl","font-bold","mb-2"],[1,"text-sm","text-red-100","text-center","max-w-md"],[1,"text-xs","font-bold","uppercase","px-2.5","py-1","rounded-full",3,"ngClass"],[1,"rounded-lg","border","overflow-hidden","transition-all",3,"ngClass"],[1,"flex","items-center","justify-between","px-4","py-3","cursor-pointer",3,"click","ngClass"],[1,"flex","items-center","gap-2"],[1,"text-xs","font-mono","text-slate-400","w-4","text-center"],[1,"w-5","h-5",3,"name","ngClass"],[1,"font-semibold","text-sm","text-slate-800"],[1,"text-xs","font-bold","uppercase","px-2","py-0.5","rounded-full",3,"ngClass"],[1,"w-4","h-4","text-slate-400",3,"name"],["class","px-4 py-3 bg-white border-t border-slate-100",4,"ngIf"],[1,"px-4","py-3","bg-white","border-t","border-slate-100"],[1,"text-sm","text-slate-600","mb-3"],[1,"space-y-2"],["class","flex items-center justify-between py-1.5 px-3 rounded-md",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","py-1.5","px-3","rounded-md",3,"ngClass"],[1,"w-4","h-4",3,"name","ngClass"],[1,"text-sm","font-medium","text-slate-700"],[1,"text-xs","text-slate-500"],["name","layout-grid",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","gap-3"],["class","rounded-lg border p-3 cursor-pointer hover:shadow-sm transition-shadow",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"rounded-lg","border","p-3","cursor-pointer","hover:shadow-sm","transition-shadow",3,"click","ngClass"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","font-bold","text-slate-600","uppercase"],[1,"text-xs","font-bold","px-1.5","py-0.5","rounded",3,"ngClass"],[1,"text-lg","font-bold","mb-1",3,"ngClass"],[1,"w-full","bg-slate-100","rounded-full","h-1.5","overflow-hidden"],[1,"h-full","rounded-full","transition-all",3,"ngClass"],["class","mt-3 pt-2 border-t border-slate-100",4,"ngIf"],[1,"mt-3","pt-2","border-t","border-slate-100"],["class","mb-2",4,"ngIf"],[4,"ngIf"],[1,"mb-2"],[1,"text-[10px]","font-semibold","text-slate-400","uppercase","mb-1"],[1,"space-y-0.5"],["class","text-xs text-slate-600 flex items-start gap-1",4,"ngFor","ngForOf"],[1,"text-xs","text-slate-600","flex","items-start","gap-1"],[1,"text-amber-500","mt-0.5"],["class","text-xs text-green-700 flex items-start gap-1",4,"ngFor","ngForOf"],[1,"text-xs","text-green-700","flex","items-start","gap-1"],[1,"text-green-500","mt-0.5"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider","mb-3"],["name","alert-circle",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"flex","flex-wrap","gap-2"],["class","inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-semibold bg-amber-50 text-amber-700 border border-amber-200",4,"ngIf"],["class","inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-semibold bg-red-50 text-red-700 border border-red-200",4,"ngIf"],["class","inline-flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-semibold bg-purple-50 text-purple-700 border border-purple-200",4,"ngIf"],[1,"inline-flex","items-center","gap-1","px-3","py-1.5","rounded-full","text-xs","font-semibold","bg-amber-50","text-amber-700","border","border-amber-200"],["name","user-check",1,"w-3","h-3"],[1,"inline-flex","items-center","gap-1","px-3","py-1.5","rounded-full","text-xs","font-semibold","bg-red-50","text-red-700","border","border-red-200"],[1,"inline-flex","items-center","gap-1","px-3","py-1.5","rounded-full","text-xs","font-semibold","bg-purple-50","text-purple-700","border","border-purple-200"],["name","calculator",1,"w-3","h-3"],["name","trending-up",1,"w-3","h-3"],["name","clipboard-check",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"flex","items-center","gap-4","mb-2"],[1,"text-sm","font-semibold","text-blue-700","bg-blue-50","px-2.5","py-1","rounded","border","border-blue-200"],["class","text-sm text-slate-600",4,"ngIf"],["class","space-y-1 mt-2",4,"ngIf"],[1,"text-sm","text-slate-600"],[1,"space-y-1","mt-2"],["class","text-xs text-slate-600 flex items-start gap-1.5",4,"ngFor","ngForOf"],[1,"text-xs","text-slate-600","flex","items-start","gap-1.5"],["name","chevron-right",1,"w-3","h-3","text-slate-400","mt-0.5","flex-shrink-0"],[1,"bg-red-50","rounded-xl","border","border-red-200","shadow-sm","p-5"],[1,"text-xs","font-semibold","text-red-600","uppercase","tracking-wider","mb-3"],["name","zap-off",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"text-sm","text-red-800"],[1,"font-bold"],["class","text-sm text-red-700 mt-1",4,"ngIf"],[1,"text-sm","text-red-700","mt-1"],[1,"font-semibold"],["name","refresh-cw",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"flex","items-center","gap-3","mb-2"],["class","grid grid-cols-2 gap-3 text-sm text-slate-600",4,"ngIf"],["class","mt-2 flex flex-wrap gap-1",4,"ngIf"],[1,"grid","grid-cols-2","gap-3","text-sm","text-slate-600"],[1,"mt-2","flex","flex-wrap","gap-1"],["class","text-xs px-2 py-0.5 rounded bg-amber-50 text-amber-700 border border-amber-200",4,"ngFor","ngForOf"],[1,"text-xs","px-2","py-0.5","rounded","bg-amber-50","text-amber-700","border","border-amber-200"],["name","users",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],["class","inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-slate-50 text-slate-700 border border-slate-200",4,"ngFor","ngForOf"],[1,"inline-flex","items-center","gap-1","px-2.5","py-1","rounded-full","text-xs","font-medium","bg-slate-50","text-slate-700","border","border-slate-200"],["name","circle-dot",1,"w-3","h-3","text-slate-400"],["name","list-checks",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],["class","flex items-center gap-3 py-1.5",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-3","py-1.5"],[1,"text-sm","text-slate-700"],[1,"text-xs","text-slate-400","ml-auto","px-2","py-0.5","rounded","bg-slate-50","border","border-slate-100"],["name","lightbulb",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],["class","flex items-start gap-2 text-sm text-slate-700",4,"ngFor","ngForOf"],[1,"flex","items-start","gap-2","text-sm","text-slate-700"],[1,"flex-shrink-0","w-5","h-5","rounded-full","bg-blue-50","text-blue-600","flex","items-center","justify-center","text-xs","font-bold"]],template:function(e,l){e&1&&g(0,zt,26,24,"div",0),e&2&&o("ngIf",l.result)},dependencies:[P,M,N,F,B,L,Re],encapsulation:2})};var Kt=(i,t,e)=>({"bg-slate-100 text-slate-500":i,"bg-amber-100 text-amber-600":t,"bg-red-100 text-red-600":e}),Ut=(i,t,e)=>({"text-slate-700":i,"text-amber-600":t,"text-red-600":e}),Qt=(i,t)=>({"bg-green-500":i,"bg-red-500":t});function Yt(i,t){if(i&1&&(r(0,"span",43),s(1),n()),i&2){let e=c().$implicit;a(),u(" ",e.slaDeadline," ")}}function Jt(i,t){i&1&&(r(0,"span",21),s(1," N/A "),n())}function Xt(i,t){i&1&&(r(0,"span",44),s(1," Breached "),n())}function Zt(i,t){if(i&1){let e=C();r(0,"button",45),w("click",function(){y(e);let d=c().$implicit,m=c(2);return S(m.onNudge.emit(d.department))}),p(1,"lucide-icon",46),s(2," Nudge "),n()}}function ei(i,t){if(i&1){let e=C();r(0,"button",47),w("click",function(){y(e);let d=c().$implicit,m=c(2);return S(m.onAssign.emit(d.department))}),p(1,"lucide-icon",48),s(2," Assign "),n()}}function ti(i,t){i&1&&(r(0,"span",49),p(1,"lucide-icon",50),s(2," Done "),n())}function ii(i,t){if(i&1&&(r(0,"tr",27)(1,"td",28),s(2),n(),r(3,"td",29)(4,"span",30),p(5,"lucide-icon",31),s(6),n()(),r(7,"td",32),s(8),n(),r(9,"td",29)(10,"div",33),p(11,"span",34),g(12,Yt,2,1,"span",35)(13,Jt,2,0,"span",36)(14,Xt,2,0,"span",37),n()(),r(15,"td",38)(16,"div",39),g(17,Zt,3,0,"button",40)(18,ei,3,0,"button",41)(19,ti,3,0,"span",42),n()()()),i&2){let e=t.$implicit,l=c(2);a(2),f(e.department),a(2),o("ngClass",l.getStatusBadgeClass(e.status)),a(),o("name",l.getStatusIcon(e.status)),a(),u(" ",l.formatStatus(e.status)," "),a(2),u(" ",e.assignee||"---"," "),a(3),o("ngClass",D(12,Qt,!e.slaBreached,e.slaBreached)),a(),o("ngIf",e.slaDeadline),a(),o("ngIf",!e.slaDeadline),a(),o("ngIf",e.slaBreached),a(3),o("ngIf",e.status==="PENDING"||e.status==="REWORK"),a(),o("ngIf",!e.assignee),a(),o("ngIf",e.status==="APPROVED")}}function ni(i,t){if(i&1&&(r(0,"div",51),p(1,"lucide-icon",52),r(2,"div")(3,"p",53),s(4,"Circuit Breaker Triggered"),n(),r(5,"p",54),s(6),n()()()),i&2){let e=c(2);a(6),U(" Loop-back limit reached (",e.result.loopBackCount,"/",e.result.circuitBreakerThreshold,"). Process requires escalation to proceed. ")}}function ri(i,t){if(i&1&&(r(0,"div",55)(1,"div",56),p(2,"lucide-icon",57),r(3,"div")(4,"h4",58),s(5),n(),r(6,"p",59)(7,"span",60),s(8,"Escalated to:"),n(),s(9),n(),r(10,"p",61)(11,"span",60),s(12,"Reason:"),n(),s(13),n()()()()),i&2){let e=c(2);a(5),u(" Escalation Level ",e.result.escalation.level," "),a(4),u(" ",e.result.escalation.escalatedTo," "),a(4),u(" ",e.result.escalation.reason," ")}}function ai(i,t){if(i&1&&(r(0,"div",1)(1,"div",2),p(2,"lucide-icon",3),r(3,"div")(4,"p",4),s(5),n(),r(6,"p",5),s(7),n()()(),r(8,"div",6)(9,"div",7)(10,"h4",8),p(11,"lucide-icon",9),s(12," Department Sign-offs "),n()(),r(13,"table",10)(14,"thead")(15,"tr",11)(16,"th",12),s(17,"Department"),n(),r(18,"th",12),s(19,"Status"),n(),r(20,"th",12),s(21,"Assignee"),n(),r(22,"th",12),s(23,"SLA"),n(),r(24,"th",13),s(25,"Actions"),n()()(),r(26,"tbody"),g(27,ii,20,15,"tr",14),n()()(),r(28,"div",15)(29,"div",16)(30,"div",17)(31,"div",18),p(32,"lucide-icon",19),n(),r(33,"div")(34,"p",20),s(35,"Loop-back Count"),n(),r(36,"p",21),s(37),n()()(),r(38,"div",22)(39,"span",23),s(40),n(),r(41,"span",24),s(42),n()()(),g(43,ni,7,2,"div",25),n(),g(44,ri,14,3,"div",26),n()),i&2){let e=c();a(),o("ngClass",e.getSlaStatusBannerClass(e.result.slaStatus)),a(),o("name",e.getSlaStatusIcon(e.result.slaStatus)),a(3),u("SLA Status: ",e.getSlaStatusLabel(e.result.slaStatus)),a(2),u(" ",e.getSlaStatusDescription(e.result.slaStatus)," "),a(20),o("ngForOf",e.result.signoffs),a(4),o("ngClass",k(12,Kt,e.result.loopBackCount<2,e.result.loopBackCount===2,e.result.loopBackCount>=3)),a(6),u(" Threshold: ",e.result.circuitBreakerThreshold," "),a(2),o("ngClass",k(16,Ut,e.result.loopBackCount<2,e.result.loopBackCount===2,e.result.loopBackCount>=3)),a(),u(" ",e.result.loopBackCount," "),a(2),u("/ ",e.result.circuitBreakerThreshold),a(),o("ngIf",e.result.circuitBreaker||e.result.loopBackCount>=3),a(),o("ngIf",e.result.escalation)}}var pe=class i{result;onNudge=new J;onAssign=new J;getStatusBadgeClass(t){switch(t){case"APPROVED":return"bg-green-100 text-green-700";case"REJECTED":return"bg-red-100 text-red-700";case"REWORK":return"bg-amber-100 text-amber-700";case"PENDING":default:return"bg-slate-100 text-slate-600"}}getStatusIcon(t){switch(t){case"APPROVED":return"check-circle-2";case"REJECTED":return"x-circle";case"REWORK":return"rotate-ccw";case"PENDING":default:return"clock"}}formatStatus(t){switch(t){case"REWORK":return"Rework";default:return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}}getSlaStatusBannerClass(t){switch(t){case"on_track":return"bg-green-50 text-green-800 border border-green-200";case"at_risk":return"bg-amber-50 text-amber-800 border border-amber-200";case"breached":return"bg-red-50 text-red-800 border border-red-200";default:return"bg-slate-50 text-slate-800 border border-slate-200"}}getSlaStatusIcon(t){switch(t){case"on_track":return"check-circle-2";case"at_risk":return"alert-triangle";case"breached":return"alert-circle";default:return"clock"}}getSlaStatusLabel(t){switch(t){case"on_track":return"On Track";case"at_risk":return"At Risk";case"breached":return"Breached";default:return"Unknown"}}getSlaStatusDescription(t){switch(t){case"on_track":return"All sign-offs are progressing within SLA deadlines.";case"at_risk":return"One or more sign-offs are approaching their SLA deadline.";case"breached":return"SLA deadlines have been exceeded. Immediate attention required.";default:return""}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-governance-status"]],inputs:{result:"result"},outputs:{onNudge:"onNudge",onAssign:"onAssign"},decls:1,vars:1,consts:[["class","space-y-5",4,"ngIf"],[1,"space-y-5"],[1,"rounded-xl","p-4","flex","items-center","gap-3",3,"ngClass"],[1,"w-5","h-5","flex-shrink-0",3,"name"],[1,"font-bold","text-sm"],[1,"text-xs","opacity-80"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","overflow-hidden"],[1,"px-5","pt-5","pb-3"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],["name","clipboard-check",1,"w-3.5","h-3.5","inline-block","mr-1","-mt-0.5"],[1,"w-full","text-sm"],[1,"border-t","border-b","border-slate-100","bg-slate-50/50"],[1,"text-left","px-5","py-2.5","text-xs","font-semibold","text-slate-500","uppercase"],[1,"text-right","px-5","py-2.5","text-xs","font-semibold","text-slate-500","uppercase"],["class","border-b border-slate-50 hover:bg-slate-50/50 transition-colors",4,"ngFor","ngForOf"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","p-5"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center",3,"ngClass"],["name","rotate-ccw",1,"w-5","h-5"],[1,"text-sm","font-semibold","text-slate-700"],[1,"text-xs","text-slate-400"],[1,"flex","items-center","gap-2"],[1,"text-3xl","font-bold",3,"ngClass"],[1,"text-sm","text-slate-400"],["class","mt-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",4,"ngIf"],["class","bg-amber-50 rounded-xl border border-amber-200 shadow-sm p-5",4,"ngIf"],[1,"border-b","border-slate-50","hover:bg-slate-50/50","transition-colors"],[1,"px-5","py-3","font-medium","text-slate-700"],[1,"px-5","py-3"],[1,"inline-flex","items-center","gap-1.5","px-2.5","py-1","rounded-full","text-xs","font-bold","uppercase",3,"ngClass"],[1,"w-3","h-3",3,"name"],[1,"px-5","py-3","text-slate-500"],[1,"flex","items-center","gap-1.5"],[1,"w-2","h-2","rounded-full",3,"ngClass"],["class","text-xs text-slate-500",4,"ngIf"],["class","text-xs text-slate-400",4,"ngIf"],["class","text-[10px] font-bold text-red-600 uppercase ml-1",4,"ngIf"],[1,"px-5","py-3","text-right"],[1,"flex","items-center","justify-end","gap-1.5"],["class","px-2 py-1 text-[10px] font-bold text-amber-700 bg-amber-50 hover:bg-amber-100 rounded border border-amber-200 transition-colors","title","Send reminder to approver",3,"click",4,"ngIf"],["class","px-2 py-1 text-[10px] font-bold text-blue-700 bg-blue-50 hover:bg-blue-100 rounded border border-blue-200 transition-colors","title","Assign approver",3,"click",4,"ngIf"],["class","text-[10px] text-green-600 font-medium",4,"ngIf"],[1,"text-xs","text-slate-500"],[1,"text-[10px]","font-bold","text-red-600","uppercase","ml-1"],["title","Send reminder to approver",1,"px-2","py-1","text-[10px]","font-bold","text-amber-700","bg-amber-50","hover:bg-amber-100","rounded","border","border-amber-200","transition-colors",3,"click"],["name","bell",1,"w-3","h-3","inline","-mt-0.5","mr-0.5"],["title","Assign approver",1,"px-2","py-1","text-[10px]","font-bold","text-blue-700","bg-blue-50","hover:bg-blue-100","rounded","border","border-blue-200","transition-colors",3,"click"],["name","user-plus",1,"w-3","h-3","inline","-mt-0.5","mr-0.5"],[1,"text-[10px]","text-green-600","font-medium"],["name","check",1,"w-3","h-3","inline","-mt-0.5"],[1,"mt-4","p-3","bg-red-50","border","border-red-200","rounded-lg","flex","items-center","gap-3"],["name","alert-circle",1,"w-5","h-5","text-red-500","flex-shrink-0"],[1,"text-sm","font-bold","text-red-700"],[1,"text-xs","text-red-500"],[1,"bg-amber-50","rounded-xl","border","border-amber-200","shadow-sm","p-5"],[1,"flex","items-start","gap-3"],["name","arrow-up-right",1,"w-5","h-5","text-amber-600","mt-0.5","flex-shrink-0"],[1,"text-sm","font-bold","text-amber-800","mb-1"],[1,"text-sm","text-amber-700","mb-2"],[1,"font-semibold"],[1,"text-xs","text-amber-600"]],template:function(e,l){e&1&&g(0,ai,45,20,"div",0),e&2&&o("ngIf",l.result)},dependencies:[P,M,N,F,B,L],encapsulation:2})};var si=(i,t,e)=>({"bg-green-50 border-green-200 text-green-800":i,"bg-amber-50 border-amber-200 text-amber-800":t,"bg-red-50 border-red-200 text-red-800":e}),oi=(i,t)=>({"border-red-200 bg-red-50/50":i,"border-amber-200 bg-amber-50/50":t}),li=(i,t)=>({"text-red-400":i,"text-amber-400":t}),di=(i,t)=>({"bg-red-100 text-red-700":i,"bg-amber-100 text-amber-700":t}),ci=(i,t)=>({"text-green-500":i,"text-slate-300":t}),pi=(i,t)=>({"text-green-600":i,"text-slate-500":t}),mi=(i,t,e)=>({"bg-red-100 text-red-700":i,"bg-amber-100 text-amber-700":t,"bg-green-100 text-green-700":e}),ui=(i,t,e)=>({"bg-red-100 text-red-600":i,"bg-amber-100 text-amber-600":t,"bg-slate-100 text-slate-500":e});function gi(i,t){if(i&1&&(r(0,"div",18)(1,"div",19),p(2,"lucide-icon",20),r(3,"div",21)(4,"p",22),s(5),n(),r(6,"p",23),s(7),n()()(),r(8,"span",24),s(9),n()()),i&2){let e=t.$implicit;o("ngClass",D(7,oi,e.priority==="BLOCKING",e.priority==="WARNING")),a(2),o("size",14)("ngClass",D(10,li,e.priority==="BLOCKING",e.priority==="WARNING")),a(3),f(e.docType),a(2),f(e.reason),a(),o("ngClass",D(13,di,e.priority==="BLOCKING",e.priority==="WARNING")),a(),u(" ",e.priority," ")}}function xi(i,t){if(i&1&&(r(0,"div",6)(1,"h4",14),p(2,"lucide-icon",15),s(3),n(),r(4,"div",16),g(5,gi,10,16,"div",17),n()()),i&2){let e=c(2);a(2),o("size",13),a(),u(" Missing Documents (",e.result.missingDocs.length,") "),a(2),o("ngForOf",e.result.missingDocs)}}function fi(i,t){if(i&1&&(r(0,"div",27)(1,"div",28)(2,"span",29),s(3),n(),p(4,"lucide-icon",30),n(),r(5,"p",31),s(6),n(),r(7,"p",32),p(8,"lucide-icon",33),s(9),n()()),i&2){let e=t.$implicit;a(3),f(e.docType),a(),o("size",14),a(2),f(e.reason),a(2),o("size",11),a(),u(" ",e.action," ")}}function vi(i,t){if(i&1&&(r(0,"div",6)(1,"h4",14),p(2,"lucide-icon",25),s(3),n(),r(4,"div",16),g(5,fi,10,5,"div",26),n()()),i&2){let e=c(2);a(2),o("size",13),a(),u(" Invalid Documents (",e.result.invalidDocs.length,") "),a(2),o("ngForOf",e.result.invalidDocs)}}function _i(i,t){if(i&1&&(r(0,"tr",42)(1,"td",43),s(2),n(),r(3,"td",44),s(4),n(),r(5,"td",45)(6,"span",46),p(7,"lucide-icon",47),r(8,"span",48),s(9),n()()()()),i&2){let e=t.$implicit;a(2),f(e.condition),a(2),f(e.requiredDoc),a(3),o("name",e.status==="present"?"check-circle":"circle")("size",12)("ngClass",D(7,ci,e.status==="present",e.status!=="present")),a(),o("ngClass",D(10,pi,e.status==="present",e.status!=="present")),a(),u(" ",e.status," ")}}function hi(i,t){if(i&1&&(r(0,"div",6)(1,"h4",14),p(2,"lucide-icon",34),s(3),n(),r(4,"div",35)(5,"table",36)(6,"thead",37)(7,"tr")(8,"th",38),s(9,"Condition"),n(),r(10,"th",38),s(11,"Required Doc"),n(),r(12,"th",39),s(13,"Status"),n()()(),r(14,"tbody",40),g(15,_i,10,13,"tr",41),n()()()()),i&2){let e=c(2);a(2),o("size",13),a(),u(" Conditional Rules Triggered (",e.result.conditionalRules.length,") "),a(12),o("ngForOf",e.result.conditionalRules)}}function bi(i,t){if(i&1&&(r(0,"div",51)(1,"div",19),p(2,"lucide-icon",52),r(3,"div",21)(4,"p",22),s(5),n(),r(6,"p",23),s(7),n()()(),r(8,"div",53)(9,"span",54),s(10),n(),r(11,"span",55),s(12),n()()()),i&2){let e=t.$implicit;a(2),o("size",14),a(3),f(e.docType),a(2),u("Expires: ",e.expiryDate),a(2),o("ngClass",k(7,mi,e.daysRemaining<=7,e.daysRemaining>7&&e.daysRemaining<=30,e.daysRemaining>30)),a(),u(" ",e.daysRemaining,"d left "),a(),o("ngClass",k(11,ui,e.alertLevel==="CRITICAL"||e.alertLevel==="HIGH",e.alertLevel==="MEDIUM"||e.alertLevel==="WARNING",e.alertLevel==="LOW"||e.alertLevel==="INFO")),a(),u(" ",e.alertLevel," ")}}function yi(i,t){if(i&1&&(r(0,"div",6)(1,"h4",14),p(2,"lucide-icon",49),s(3),n(),r(4,"div",16),g(5,bi,13,15,"div",50),n()()),i&2){let e=c(2);a(2),o("size",13),a(),u(" Expiring Documents (",e.result.expiringDocs.length,") "),a(2),o("ngForOf",e.result.expiringDocs)}}function Si(i,t){if(i&1&&(r(0,"div",1)(1,"div",2),p(2,"lucide-icon",3),r(3,"div")(4,"p",4),s(5),n(),r(6,"p",5),s(7),n()()(),r(8,"div",6)(9,"div",7)(10,"span",8),p(11,"lucide-icon",9),s(12," Document Completeness "),n(),r(13,"span",10),s(14),n()(),r(15,"div",11),p(16,"div",12),n()(),g(17,xi,6,3,"div",13)(18,vi,6,3,"div",13)(19,hi,16,3,"div",13)(20,yi,6,3,"div",13),n()),i&2){let e=c();a(),o("ngClass",k(17,si,e.result.stageGateStatus==="CLEAR",e.result.stageGateStatus==="WARNING",e.result.stageGateStatus==="BLOCKED")),a(),o("name",e.result.stageGateStatus==="CLEAR"?"check-circle":e.result.stageGateStatus==="WARNING"?"alert-triangle":"alert-circle")("size",22),a(3),u("Stage Gate: ",e.result.stageGateStatus),a(2),Ie("",e.result.totalPresent,"/",e.result.totalRequired," documents present \xB7 ",e.result.totalValid," valid"),a(4),o("size",15),a(2),o("ngClass",e.percentTextClass),a(),u("",e.result.completenessPercent,"%"),a(2),K("width",e.result.completenessPercent,"%"),o("ngClass",e.progressBarClass),a(),o("ngIf",e.result.missingDocs.length>0),a(),o("ngIf",e.result.invalidDocs.length>0),a(),o("ngIf",e.result.conditionalRules.length>0),a(),o("ngIf",e.result.expiringDocs.length>0)}}var me=class i{result;get progressBarClass(){return this.result?{"bg-green-500":this.result.stageGateStatus==="CLEAR","bg-amber-500":this.result.stageGateStatus==="WARNING","bg-red-500":this.result.stageGateStatus==="BLOCKED"}:{}}get percentTextClass(){return this.result?{"text-green-600":this.result.stageGateStatus==="CLEAR","text-amber-600":this.result.stageGateStatus==="WARNING","text-red-600":this.result.stageGateStatus==="BLOCKED"}:{}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-doc-completeness"]],inputs:{result:"result"},decls:1,vars:1,consts:[["class","space-y-5",4,"ngIf"],[1,"space-y-5"],[1,"flex","items-center","gap-3","rounded-xl","px-5","py-4","border",3,"ngClass"],[3,"name","size"],[1,"font-semibold","text-sm"],[1,"text-xs","opacity-80"],[1,"space-y-2"],[1,"flex","items-center","justify-between","text-sm"],[1,"font-medium","text-slate-700","flex","items-center","gap-1.5"],["name","file-check",3,"size"],[1,"font-semibold",3,"ngClass"],[1,"w-full","h-3","rounded-full","bg-slate-100","overflow-hidden"],[1,"h-full","rounded-full","transition-all","duration-500","ease-out",3,"ngClass"],["class","space-y-2",4,"ngIf"],[1,"text-xs","font-semibold","text-slate-500","uppercase","tracking-wider","flex","items-center","gap-1.5"],["name","file-search",3,"size"],[1,"space-y-1.5"],["class","flex items-center justify-between rounded-lg border px-3 py-2.5",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","rounded-lg","border","px-3","py-2.5",3,"ngClass"],[1,"flex","items-center","gap-2","min-w-0"],["name","file",3,"size","ngClass"],[1,"min-w-0"],[1,"text-sm","font-medium","text-slate-700","truncate"],[1,"text-xs","text-slate-500"],[1,"text-[10px]","font-bold","px-2","py-0.5","rounded-full","shrink-0","ml-2",3,"ngClass"],["name","alert-circle",3,"size"],["class","rounded-lg border border-slate-200 bg-white px-3 py-2.5",4,"ngFor","ngForOf"],[1,"rounded-lg","border","border-slate-200","bg-white","px-3","py-2.5"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-slate-700"],["name","x-circle",1,"text-red-400",3,"size"],[1,"text-xs","text-slate-500","mt-0.5"],[1,"text-xs","text-blue-600","mt-1","flex","items-center","gap-1"],["name","arrow-right",3,"size"],["name","git-branch",3,"size"],[1,"overflow-hidden","rounded-lg","border","border-slate-200"],[1,"w-full","text-xs"],[1,"bg-slate-50"],[1,"px-3","py-2","text-left","font-medium","text-slate-500"],[1,"px-3","py-2","text-center","font-medium","text-slate-500"],[1,"divide-y","divide-slate-100"],["class","hover:bg-slate-50/50",4,"ngFor","ngForOf"],[1,"hover:bg-slate-50/50"],[1,"px-3","py-2","text-slate-600"],[1,"px-3","py-2","font-medium","text-slate-700"],[1,"px-3","py-2","text-center"],[1,"inline-flex","items-center","gap-1"],[3,"name","size","ngClass"],[3,"ngClass"],["name","clock",3,"size"],["class","flex items-center justify-between rounded-lg border border-slate-200 bg-white px-3 py-2.5",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","rounded-lg","border","border-slate-200","bg-white","px-3","py-2.5"],["name","file-text",1,"text-slate-400","shrink-0",3,"size"],[1,"flex","items-center","gap-2","shrink-0","ml-2"],[1,"text-xs","font-semibold","px-2","py-0.5","rounded-full",3,"ngClass"],[1,"text-[10px]","font-bold","px-1.5","py-0.5","rounded","uppercase",3,"ngClass"]],template:function(e,l){e&1&&g(0,Si,21,21,"div",0),e&2&&o("ngIf",l.result)},dependencies:[P,M,N,F,B,L],encapsulation:2})};var Ci=(i,t,e)=>({"bg-green-50 border-green-200 text-green-800":i,"bg-amber-50 border-amber-200 text-amber-800":t,"bg-red-50 border-red-200 text-red-800":e}),wi=(i,t)=>({"border-red-300 bg-red-50/60":i,"border-amber-300 bg-amber-50/60":t}),Ii=(i,t)=>({"bg-red-100 text-red-700":i,"bg-amber-100 text-amber-700":t}),ki=(i,t,e)=>({"text-red-500":i,"text-green-500":t,"text-slate-400":e}),Ai=(i,t,e)=>({"bg-red-100 text-red-700":i,"bg-amber-100 text-amber-700":t,"bg-green-100 text-green-700":e});function Ei(i,t){if(i&1&&(r(0,"div",16)(1,"div",17)(2,"span",18),s(3),n(),r(4,"span",19),s(5),n()(),r(6,"div",20)(7,"span"),s(8,"Threshold: "),r(9,"strong"),s(10),n()(),r(11,"span"),s(12,"Actual: "),r(13,"strong"),s(14),n()(),r(15,"span",21),s(16," Trend: "),p(17,"lucide-icon",22),s(18),n()(),r(19,"p",23),s(20),n()()),i&2){let e=t.$implicit;o("ngClass",D(11,wi,e.severity==="CRITICAL",e.severity==="WARNING")),a(3),f(e.metric),a(),o("ngClass",D(14,Ii,e.severity==="CRITICAL",e.severity==="WARNING")),a(),u(" ",e.severity," "),a(5),f(e.threshold),a(4),f(e.actual),a(3),o("name",e.trend==="worsening"?"trending-up":e.trend==="improving"?"trending-down":"arrow-right")("size",14)("ngClass",k(17,ki,e.trend==="worsening",e.trend==="improving",e.trend==="stable")),a(),u(" ",e.trend," "),a(2),u("First detected: ",e.firstDetected)}}function Ti(i,t){if(i&1&&(r(0,"div",12)(1,"h3",13),p(2,"lucide-icon",14),s(3," Breach Alerts "),n(),g(4,Ei,21,21,"div",15),n()),i&2){let e=c(2);a(2),o("size",16),a(2),o("ngForOf",e.sortedBreaches)}}function Ri(i,t){if(i&1&&(r(0,"tr",32)(1,"td",33),s(2),n(),r(3,"td",34),s(4),n(),r(5,"td",35),s(6),n(),r(7,"td",36)(8,"span",37),s(9),n()(),r(10,"td",38),s(11),n()()),i&2){let e=t.$implicit;a(2),f(e.type),a(2),f(e.description),a(2),f(e.deadline),a(2),o("ngClass",k(6,Ai,e.daysRemaining<=7,e.daysRemaining>7&&e.daysRemaining<=30,e.daysRemaining>30)),a(),u(" ",e.daysRemaining,"d "),a(2),f(e.status)}}function Di(i,t){if(i&1&&(r(0,"div",12)(1,"h3",13),p(2,"lucide-icon",24),s(3," Conditions "),n(),r(4,"div",25)(5,"table",26)(6,"thead",27)(7,"tr")(8,"th",28),s(9,"Type"),n(),r(10,"th",28),s(11,"Description"),n(),r(12,"th",28),s(13,"Deadline"),n(),r(14,"th",29),s(15,"Days Left"),n(),r(16,"th",29),s(17,"Status"),n()()(),r(18,"tbody",30),g(19,Ri,12,10,"tr",31),n()()()()),i&2){let e=c(2);a(2),o("size",16),a(17),o("ngForOf",e.result.conditions)}}function Oi(i,t){if(i&1&&(r(0,"span",39),p(1,"lucide-icon",40),s(2),n()),i&2){let e=c(2);a(),o("size",12),a(),u(" Due: ",e.result.pirDueDate," ")}}function Mi(i,t){if(i&1&&(r(0,"div",1)(1,"div",2),p(2,"lucide-icon",3),r(3,"div")(4,"p",4),s(5),n(),r(6,"p",5),s(7),n()()(),g(8,Ti,5,2,"div",6)(9,Di,20,2,"div",6),r(10,"div",7)(11,"div",8),p(12,"lucide-icon",9),r(13,"span",10),s(14,"PIR Status:"),n(),r(15,"span"),s(16),n()(),g(17,Oi,3,2,"span",11),n()()),i&2){let e=c();a(),o("ngClass",k(11,Ci,e.result.productHealth==="HEALTHY",e.result.productHealth==="WARNING",e.result.productHealth==="CRITICAL")),a(),o("name",e.result.productHealth==="HEALTHY"?"check-circle":e.result.productHealth==="WARNING"?"alert-triangle":"alert-circle")("size",22),a(3),u("Product Health: ",e.result.productHealth),a(2),U("",e.result.metrics.length," metrics tracked \xB7 ",e.result.breaches.length," breach(es) detected"),a(),o("ngIf",e.result.breaches.length>0),a(),o("ngIf",e.result.conditions.length>0),a(3),o("size",16),a(4),f(e.result.pirStatus),a(),o("ngIf",e.result.pirDueDate)}}var ue=class i{result;get sortedBreaches(){return this.result?.breaches?[...this.result.breaches].sort((t,e)=>t.severity==="CRITICAL"&&e.severity!=="CRITICAL"?-1:t.severity!=="CRITICAL"&&e.severity==="CRITICAL"?1:0):[]}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-monitoring-alerts"]],inputs:{result:"result"},decls:1,vars:1,consts:[["class","space-y-5",4,"ngIf"],[1,"space-y-5"],[1,"flex","items-center","gap-3","rounded-xl","px-5","py-4","border",3,"ngClass"],[3,"name","size"],[1,"font-semibold","text-sm"],[1,"text-xs","opacity-80"],["class","space-y-3",4,"ngIf"],[1,"flex","items-center","justify-between","rounded-lg","border","border-slate-200","bg-slate-50","px-4","py-3"],[1,"flex","items-center","gap-2","text-sm","text-slate-700"],["name","clipboard-list",1,"text-slate-500",3,"size"],[1,"font-medium"],["class","text-xs text-slate-500 flex items-center gap-1",4,"ngIf"],[1,"space-y-3"],[1,"text-sm","font-semibold","text-slate-700","flex","items-center","gap-2"],["name","alert-triangle",3,"size"],["class","rounded-lg border p-4 space-y-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"rounded-lg","border","p-4","space-y-2",3,"ngClass"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-sm","text-slate-800"],[1,"text-xs","font-semibold","px-2","py-0.5","rounded-full",3,"ngClass"],[1,"flex","items-center","gap-4","text-xs","text-slate-600"],[1,"flex","items-center","gap-1"],[3,"name","size","ngClass"],[1,"text-xs","text-slate-500"],["name","list-checks",3,"size"],[1,"overflow-hidden","rounded-lg","border","border-slate-200"],[1,"w-full","text-xs"],[1,"bg-slate-50"],[1,"px-3","py-2","text-left","font-medium","text-slate-500"],[1,"px-3","py-2","text-center","font-medium","text-slate-500"],[1,"divide-y","divide-slate-100"],["class","hover:bg-slate-50/50",4,"ngFor","ngForOf"],[1,"hover:bg-slate-50/50"],[1,"px-3","py-2","font-medium","text-slate-700"],[1,"px-3","py-2","text-slate-600"],[1,"px-3","py-2","text-slate-500"],[1,"px-3","py-2","text-center"],[1,"inline-block","px-2","py-0.5","rounded-full","font-semibold",3,"ngClass"],[1,"px-3","py-2","text-center","text-slate-600"],[1,"text-xs","text-slate-500","flex","items-center","gap-1"],["name","clock",3,"size"]],template:function(e,l){e&1&&g(0,Mi,18,15,"div",0),e&2&&o("ngIf",l.result)},dependencies:[P,M,N,F,B,L],encapsulation:2})};var j="/api/agents",re="coo_active_chat_session_id",ge=class i{http=V(De);_sessions=z([]);sessions=this._sessions.asReadonly();groupedSessions=Ee(()=>{let t=this._sessions(),e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),d=new Date(l.getTime()-864e5),m=new Date(l.getTime()-7*864e5),x=new Date(l.getTime()-30*864e5),_=[{label:"Today",sessions:[]},{label:"Yesterday",sessions:[]},{label:"Previous 7 Days",sessions:[]},{label:"Previous 30 Days",sessions:[]},{label:"Older",sessions:[]}];for(let b of t){let I=new Date(b.updatedAt);I>=l?_[0].sessions.push(b):I>=d?_[1].sessions.push(b):I>=m?_[2].sessions.push(b):I>=x?_[3].sessions.push(b):_[4].sessions.push(b)}return _.filter(b=>b.sessions.length>0)});_activeSessionId=z(null);activeSessionId=this._activeSessionId.asReadonly();constructor(){try{let t=localStorage.getItem(re);t&&this._activeSessionId.set(t)}catch{}this.loadSessionsWithRetry()}async loadSessionsWithRetry(t=2,e=3e3){for(let l=0;l<=t;l++)try{await this.loadSessionsFromDB();return}catch{l<t&&(console.warn(`[ChatSessionService] Retry ${l+1}/${t} in ${e/1e3}s...`),await new Promise(d=>setTimeout(d,e)))}}saveSession(t,e,l){return this.saveSessionFor(this._activeSessionId(),t,e,l,{makeActive:!0})}saveSessionFor(t,e,l,d,m={}){if(e.length===0)return"";let x=e.map(v=>({role:v.role,content:v.content,timestamp:v.timestamp instanceof Date?v.timestamp.toISOString():v.timestamp,agentIdentityId:v.agentIdentity?.id,cardType:v.cardType,cardData:v.cardData,agentAction:v.agentAction})),_=e.find(v=>v.role==="user"),b=this.generateTitle(_?.content||"New Chat"),I=(_?.content||"New conversation").substring(0,200);if(t){let v=[...this._sessions()],h=v.findIndex(R=>R.id===t);if(h>=0){v[h]=G(T({},v[h]),{messages:x,messageCount:x.length,updatedAt:new Date().toISOString(),activeAgentId:l,domainAgent:d||void 0,conversationState:m.conversationState??v[h].conversationState,title:b,preview:I});let R=v.splice(h,1)[0];v.unshift(R),this._sessions.set(v)}this.updateSessionInDB(t,b,I,l,d,x,m.conversationState)}else{t=this.generateId();let h=[{id:t,title:b,preview:I,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),messageCount:x.length,messages:x,activeAgentId:l,conversationState:m.conversationState,domainAgent:d||void 0},...this._sessions()];this._sessions.set(h),m.makeActive&&this._activeSessionId.set(t),this.createSessionInDB(t,b,I,l,d,x,m.conversationState)}if(m.makeActive&&t){this._activeSessionId.set(t);try{localStorage.setItem(re,t)}catch{}}return t}getSession(t){return this._sessions().find(e=>e.id===t)||null}async fetchSessionWithMessages(t){try{let e=await Y(this.http.get(`${j}/sessions/${t}`));return this.mapRowToSession(e,e.messages||[])}catch{return null}}setActiveSession(t){this._activeSessionId.set(t);try{t?localStorage.setItem(re,t):localStorage.removeItem(re)}catch{}}startNewSession(){this._activeSessionId.set(null);try{localStorage.removeItem(re)}catch{}}deleteSession(t){let e=this._sessions().filter(l=>l.id!==t);this._sessions.set(e),this._activeSessionId()===t&&this._activeSessionId.set(null),this.http.delete(`${j}/sessions/${t}`).subscribe({error:l=>console.warn("[ChatSessionService] DB delete failed:",l)})}renameSession(t,e){let l=[...this._sessions()],d=l.findIndex(m=>m.id===t);d>=0&&(l[d]=G(T({},l[d]),{title:e}),this._sessions.set(l),this.http.put(`${j}/sessions/${t}`,{title:e}).subscribe({error:m=>console.warn("[ChatSessionService] DB rename failed:",m)}))}clearAll(){this._sessions.set([]),this._activeSessionId.set(null),this.http.delete(`${j}/sessions`).subscribe({error:t=>console.warn("[ChatSessionService] DB clear failed:",t)})}async loadSessionsFromDB(){try{let e=(await Y(this.http.get(`${j}/sessions`))).map(l=>this.mapRowToSession(l));this._sessions.set(e)}catch(t){throw console.warn("[ChatSessionService] Failed to load sessions from DB:",t),this._sessions.set([]),t}}async createSessionInDB(t,e,l,d,m,x,_){try{await Y(this.http.post(`${j}/sessions`,{id:t,title:e,preview:l,agent_identity:d||null,domain_agent_json:m||null,conversation_state_json:_||null})),x&&x.length>0&&await this.batchSaveMessages(t,x)}catch(b){console.warn("[ChatSessionService] DB create failed:",b)}}async updateSessionInDB(t,e,l,d,m,x,_){try{await Y(this.http.put(`${j}/sessions/${t}`,{title:e,preview:l,agent_identity:d||null,domain_agent_json:m||null,conversation_state_json:_||null})),x&&x.length>0&&await this.batchSaveMessages(t,x)}catch(b){console.warn("[ChatSessionService] DB update failed:",b)}}async batchSaveMessages(t,e){let l=e.map(d=>({role:d.role,content:d.content,agent_identity_id:d.agentIdentityId||null,timestamp:d.timestamp||new Date().toISOString(),metadata:{cardType:d.cardType||null,cardData:d.cardData||null,agentAction:d.agentAction||null}}));await Y(this.http.post(`${j}/sessions/${t}/messages/batch`,{messages:l}))}mapRowToSession(t,e){let l=t.domain_agent_json?typeof t.domain_agent_json=="string"?JSON.parse(t.domain_agent_json):t.domain_agent_json:void 0,d=t.conversation_state_json?typeof t.conversation_state_json=="string"?JSON.parse(t.conversation_state_json):t.conversation_state_json:void 0,m=(e||[]).map(x=>{let _=x.metadata?typeof x.metadata=="string"?JSON.parse(x.metadata):x.metadata:{};return{role:x.role,content:x.content,timestamp:x.timestamp?new Date(x.timestamp).toISOString():new Date().toISOString(),agentIdentityId:x.agent_identity_id||void 0,cardType:_?.cardType||void 0,cardData:_?.cardData||void 0,agentAction:_?.agentAction||void 0}});return{id:t.id,title:t.title||"Untitled Chat",preview:t.preview||"",createdAt:t.started_at?new Date(t.started_at).toISOString():new Date().toISOString(),updatedAt:t.updated_at?new Date(t.updated_at).toISOString():new Date().toISOString(),messageCount:t.message_count||m.length,messages:m,activeAgentId:t.agent_identity||void 0,conversationState:d,domainAgent:l}}generateId(){return`cs_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}generateTitle(t){let e=t.replace(/[#*_~`]/g,"").replace(/\n/g," ").trim();return e.length<=50?e:e.substring(0,47)+"..."}static \u0275fac=function(e){return new(e||i)};static \u0275prov=ae({token:i,factory:i.\u0275fac,providedIn:"root"})};var ve=[{id:"STRATEGY",name:"Product Strategy"},{id:"RISK",name:"Risk & Compliance"},{id:"LEGAL",name:"Legal & Regulatory"},{id:"OPS",name:"Operations"},{id:"MARKETING",name:"Marketing & Sales"},{id:"KB",name:"Knowledge & Policy"},{id:"DESK",name:"Desk Support"}],_e=[{id:"S1",title:"Draft New Product Concept",description:"Generate a structured concept paper for a new financial product, including target market and revenue model.",category:"STRATEGY",icon:"lightbulb",iconBg:"bg-amber-100 text-amber-600",prompt:"I want to create a new NPA. Help me draft a product concept paper.",successRate:88,avgTime:"2m 15s",inputs:[{label:"Product Name",placeholder:"e.g. Green Bond ETF",key:"name",required:!0},{label:"Target Segment",placeholder:"e.g. Institutional Investors",key:"segment"},{label:"Key Features",placeholder:"Describe main features...",key:"features",type:"textarea"}]},{id:"S2",title:"Competitor Analysis",description:"Analyze key competitors for a proposed product and identify differentiators.",category:"STRATEGY",icon:"users",iconBg:"bg-blue-100 text-blue-600",prompt:"Analyze key competitors for my proposed product and identify differentiators.",successRate:92,avgTime:"45s",inputs:[{label:"Product Type",placeholder:"e.g. Robo-advisory",key:"type",required:!0},{label:"Main Competitor",placeholder:"e.g. StashAway",key:"competitor"}]},{id:"S3",title:"Product Feasibility Assessment",description:"Evaluate market demand, regulatory landscape, and resource requirements for a product idea.",category:"STRATEGY",icon:"bar-chart-3",iconBg:"bg-emerald-100 text-emerald-600",prompt:"Run a feasibility assessment for a new product idea. Evaluate market demand, regulatory landscape, and resource requirements.",successRate:85,avgTime:"1m 30s",inputs:[{label:"Product Idea",placeholder:"Brief description of the product...",key:"idea",type:"textarea",required:!0},{label:"Target Market",placeholder:"e.g. Singapore retail investors",key:"market"}]},{id:"R1",title:"Initial Risk Assessment",description:"Evaluate potential operational, credit, and market risks for a new initiative.",category:"RISK",icon:"shield-alert",iconBg:"bg-red-100 text-red-600",prompt:"Run an initial risk assessment for my product covering operational, credit, and market risks.",successRate:95,avgTime:"1m 30s",inputs:[{label:"Product/Process",placeholder:"e.g. Crypto Custody",key:"product",required:!0},{label:"Jurisdiction",placeholder:"e.g. Singapore, HK",key:"jurisdiction"}]},{id:"R2",title:"Check Prohibited Lists",description:"Scan entities or product types against internal prohibited/restricted lists.",category:"RISK",icon:"search",iconBg:"bg-orange-100 text-orange-600",prompt:"Check prohibited and restricted lists for the following entities/product types.",successRate:99,avgTime:"10s",inputs:[{label:"Keywords",placeholder:"Enter names or sectors...",key:"keywords",required:!0}]},{id:"R3",title:"Sanctions & AML Screening",description:"Screen counterparties and jurisdictions against sanctions lists and AML databases.",category:"RISK",icon:"shield-check",iconBg:"bg-rose-100 text-rose-600",prompt:"Screen the following entities and jurisdictions against sanctions lists and AML databases.",successRate:97,avgTime:"15s",inputs:[{label:"Entity Name",placeholder:"e.g. Acme Corp Ltd",key:"entity",required:!0},{label:"Country",placeholder:"e.g. Myanmar",key:"country"}]},{id:"L1",title:"MAS Regulatory Review",description:"Verify if a product structure adheres to MAS Guidelines (e.g. SFA, FAA).",category:"LEGAL",icon:"scale",iconBg:"bg-slate-100 text-slate-700",prompt:"Review MAS regulatory compliance for a product structure. Check adherence to SFA, FAA, and relevant MAS notices.",successRate:91,avgTime:"3m",inputs:[{label:"Product Structure",placeholder:"Describe structure...",key:"structure",type:"textarea"},{label:"Relevant Regulation",placeholder:"e.g. MAS 656",key:"reg"}]},{id:"L2",title:"Legal Opinion Request",description:"Draft a legal opinion request for internal or external counsel review.",category:"LEGAL",icon:"file-pen",iconBg:"bg-violet-100 text-violet-600",prompt:"Help me draft a legal opinion request for counsel review regarding a new product.",successRate:87,avgTime:"2m",inputs:[{label:"Subject Matter",placeholder:"e.g. Cross-border derivative structuring",key:"subject",required:!0},{label:"Key Legal Question",placeholder:"What specific legal issue needs opinion?",key:"question",type:"textarea"}]},{id:"O1",title:"Draft Process Flow",description:"Outline the end-to-end operational workflow for booking and settlement.",category:"OPS",icon:"workflow",iconBg:"bg-indigo-100 text-indigo-600",prompt:"Draft an end-to-end operational process flow for booking and settlement.",successRate:85,avgTime:"2m",inputs:[{label:"Asset Class",placeholder:"e.g. Equities",key:"asset"},{label:"Booking System",placeholder:"e.g. Murex",key:"system"}]},{id:"O2",title:"Settlement Workflow Setup",description:"Configure settlement parameters and cutoff times for a new product launch.",category:"OPS",icon:"clock",iconBg:"bg-cyan-100 text-cyan-600",prompt:"Help me set up settlement workflow parameters and cutoff times for a new product.",successRate:90,avgTime:"1m 15s",inputs:[{label:"Product Type",placeholder:"e.g. Fixed Income ETF",key:"product",required:!0},{label:"Settlement Cycle",placeholder:"e.g. T+2",key:"cycle"}]},{id:"M1",title:"Go-to-Market Strategy",description:"Create a go-to-market plan for a new financial product including channels, messaging, and timeline.",category:"MARKETING",icon:"megaphone",iconBg:"bg-pink-100 text-pink-600",prompt:"Create a go-to-market strategy for a new financial product covering channels, messaging, and launch timeline.",successRate:82,avgTime:"2m 30s",inputs:[{label:"Product Name",placeholder:"e.g. ESG Wealth Portfolio",key:"product",required:!0},{label:"Target Audience",placeholder:"e.g. HNW retail clients",key:"audience"},{label:"Key Value Proposition",placeholder:"What makes it compelling?",key:"value",type:"textarea"}]},{id:"M2",title:"Client Communication Draft",description:"Draft client-facing communications such as product fact sheets, FAQs, or launch announcements.",category:"MARKETING",icon:"mail",iconBg:"bg-fuchsia-100 text-fuchsia-600",prompt:"Draft a client-facing communication for a product launch \u2014 include a product fact sheet and FAQ.",successRate:89,avgTime:"1m 45s",inputs:[{label:"Communication Type",placeholder:"e.g. Product Fact Sheet, FAQ, Launch Email",key:"type",required:!0},{label:"Product Summary",placeholder:"Brief product overview...",key:"summary",type:"textarea"}]},{id:"K1",title:"Search SOPs & Policies",description:"Search internal SOPs, policies, and procedure manuals for specific topics or requirements.",category:"KB",icon:"book-open",iconBg:"bg-purple-100 text-purple-600",prompt:"Search our internal SOPs and policy documents for relevant procedures and requirements.",successRate:94,avgTime:"20s",inputs:[{label:"Search Topic",placeholder:"e.g. Client onboarding procedures",key:"topic",required:!0}]},{id:"K2",title:"Regulatory Guidelines Lookup",description:"Look up specific MAS guidelines, circulars, or regulatory notices by topic or reference number.",category:"KB",icon:"file-search",iconBg:"bg-teal-100 text-teal-600",prompt:"Look up MAS regulatory guidelines and circulars related to the specified topic.",successRate:93,avgTime:"15s",inputs:[{label:"Topic or Reference",placeholder:"e.g. MAS 656, Technology Risk Management",key:"reference",required:!0}]},{id:"D1",title:"Query Help & Troubleshooting",description:"Get help with system issues, process questions, or troubleshoot common problems.",category:"DESK",icon:"help-circle",iconBg:"bg-sky-100 text-sky-600",prompt:"I need help troubleshooting an issue. Please assist with the following problem.",successRate:88,avgTime:"30s",inputs:[{label:"Issue Description",placeholder:"Describe the problem...",key:"issue",type:"textarea",required:!0}]},{id:"D2",title:"System Access Request",description:"Generate a system access request form for new tools, environments, or elevated permissions.",category:"DESK",icon:"key",iconBg:"bg-amber-100 text-amber-700",prompt:"Help me create a system access request for the following tools and permissions.",successRate:95,avgTime:"45s",inputs:[{label:"System/Tool",placeholder:"e.g. Bloomberg Terminal, Murex",key:"system",required:!0},{label:"Access Level",placeholder:"e.g. Read-only, Full Access",key:"level"}]}];var Ni=["scrollContainer"],Fi=()=>["/agents/npa"],Pi=()=>["/workspace/inbox"],Li=()=>["/knowledge/base"],Gi=i=>({"h-[calc(100vh-64px)]":i}),Wi=i=>({"flex-row-reverse":i});function Bi(i,t){if(i&1){let e=C();r(0,"button",48),w("click",function(){let d=y(e).$implicit,m=c(2);return S(m.startChatFromHint(d.prompt))}),s(1),n()}if(i&2){let e=t.$implicit;a(),u(" ",e.label," ")}}function Vi(i,t){if(i&1){let e=C();r(0,"div",3)(1,"div",4),p(2,"div",5)(3,"div",6)(4,"div",7),n(),r(5,"div",8)(6,"div",9),p(7,"span",10),s(8," Pilot Active: NPA Automation (Phase 0) "),n(),r(9,"h1",11),s(10),n(),r(11,"p",12),s(12," Orchestrating complex operations across Trading & Markets with intelligent, task-aware agents. "),n(),r(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16),p(17,"lucide-icon",17),n(),r(18,"h3",18),s(19,"Functional Agents"),n(),r(20,"p",19),s(21," Specialized agents for Ideation, Risk, Finance, and Tech approvals. "),n()(),r(22,"div",20)(23,"div",21)(24,"div",22),p(25,"div",23),r(26,"span",24),s(27,"Product Ideation Agent"),n()(),p(28,"lucide-icon",25),n(),r(29,"div",26)(30,"div",22),p(31,"div",27),r(32,"span",24),s(33,"Risk Control Agent"),n()(),r(34,"span",28),s(35,"Soon"),n()()()(),r(36,"div",14)(37,"div",15)(38,"div",29),p(39,"lucide-icon",30),n(),r(40,"h3",18),s(41,"Work Items"),n(),r(42,"p",19),s(43," Track cross-functional workflows, approvals, and exceptions in real-time. "),n()(),r(44,"div",20)(45,"div",31)(46,"span",24),s(47,"My Dashboard"),n(),p(48,"lucide-icon",32),n(),r(49,"div",26)(50,"span",24),s(51,"Exception Queue"),n(),r(52,"span",28),s(53,"Soon"),n()()()(),r(54,"div",14)(55,"div",15)(56,"div",33),p(57,"lucide-icon",34),n(),r(58,"h3",18),s(59,"Intelligence"),n(),r(60,"p",19),s(61," Centralized Knowledge Base (SOPs), Policy Engine, and Audit Trails. "),n()(),r(62,"div",20)(63,"div",35)(64,"span",24),s(65,"Knowledge Base"),n(),p(66,"lucide-icon",36),n(),r(67,"div",26)(68,"span",24),s(69,"Audit Logs"),n(),r(70,"span",28),s(71,"Soon"),n()()()()(),r(72,"div",37)(73,"div",38)(74,"div",39),p(75,"lucide-icon",40),n(),r(76,"input",41),ee("ngModelChange",function(d){y(e);let m=c();return Z(m.landingInput,d)||(m.landingInput=d),S(d)}),w("keydown.enter",function(){y(e);let d=c();return S(d.startChatFromLanding())})("focus",function(){y(e);let d=c();return S(d.inputFocused=!0)})("blur",function(){y(e);let d=c();return S(d.inputFocused=!1)}),n(),r(77,"button",42),w("click",function(){y(e);let d=c();return S(d.startChatFromLanding())}),p(78,"lucide-icon",43),n()(),r(79,"div",44),g(80,Bi,2,1,"button",45),n()(),r(81,"div",46),s(82," System Status: "),r(83,"span",47),s(84,"Online"),n(),s(85," \u2022 Dify API: "),r(86,"span",47),s(87,"Connected"),n(),s(88," \u2022 v0.1.0-alpha "),n()()()}if(i&2){let e=c();a(10),u(" ",e.config.title," "),a(4),we("opacity-50",e.userRole()!=="MAKER"&&e.userRole()!=="ADMIN")("pointer-events-none",e.userRole()!=="MAKER"&&e.userRole()!=="ADMIN"),a(9),o("routerLink",se(11,Fi)),a(22),o("routerLink",se(12,Pi)),a(18),o("routerLink",se(13,Li)),a(13),X("ngModel",e.landingInput),a(),o("disabled",!e.landingInput.trim()),a(3),o("ngForOf",e.quickHints)}}function $i(i,t){if(i&1){let e=C();r(0,"button",77),w("click",function(){let d=y(e).$implicit,m=c(4);return S(m.processMessage(d.prompt))}),p(1,"lucide-icon",78),s(2),n()}if(i&2){let e=t.$implicit;a(),o("name",e.icon),a(),u(" ",e.label," ")}}function ji(i,t){if(i&1&&(r(0,"div",69)(1,"div",70),p(2,"lucide-icon",71),n(),r(3,"h3",72),s(4,"Start a conversation"),n(),r(5,"p",73),s(6),n(),r(7,"div",74),g(8,$i,3,2,"button",75),n(),r(9,"p",76),s(10,"Press Enter to send \xB7 Shift+Enter for newline"),n()()),i&2){let e=c(3);a(6),f(e.config.context==="NPA_AGENT"?"Ask the NPA Agent about product approvals, risk, classification, or compliance.":"Ask the COO Agent about operations, risk, compliance, or knowledge base."),a(2),o("ngForOf",e.suggestionChips)}}function qi(i,t){if(i&1&&(r(0,"span"),s(1),n()),i&2){let e=c(4);a(),f(e.userInitial())}}function Hi(i,t){if(i&1&&p(0,"lucide-icon",95),i&2){let e=c().$implicit;o("name",(e.agentIdentity==null?null:e.agentIdentity.icon)||"brain-circuit")}}function zi(i,t){if(i&1&&(r(0,"span",96),s(1),n()),i&2){let e=c().$implicit,l=c(3);o("ngClass",l.getAgentLabelClass(e.agentIdentity)),a(),u(" ",e.agentIdentity.name," ")}}function Ki(i,t){if(i&1&&p(0,"markdown",97),i&2){let e=c().$implicit;o("data",e.content)}}function Ui(i,t){i&1&&p(0,"span",98)}function Qi(i,t){if(i&1){let e=C();r(0,"button",102),w("click",function(){y(e);let d=c(2).$implicit,m=c(3);return S(m.copyMessage(d.content))}),p(1,"lucide-icon",103),n()}if(i&2){let e=c(2).$implicit,l=c(3);a(),o("name",l.copiedMessageId===e.timestamp.getTime()?"check":"clipboard-list")}}function Yi(i,t){if(i&1&&(r(0,"div",99)(1,"span",100),s(2),oe(3,"date"),n(),g(4,Qi,2,1,"button",101),n()),i&2){let e=c().$implicit;o("ngClass",e.role==="user"?"border-t border-indigo-500/30":"border-t border-slate-100"),a(),o("ngClass",e.role==="user"?"text-indigo-200":"text-slate-400"),a(),f(Ae(3,4,e.timestamp,"shortTime")),a(2),o("ngIf",e.role==="agent")}}function Ji(i,t){if(i&1&&(r(0,"div",104)(1,"div",105),p(2,"lucide-icon",106),r(3,"span",107),s(4,"Domain Identified"),n()(),r(5,"div",108)(6,"div",109),p(7,"lucide-icon",110),n(),r(8,"div",111)(9,"h4",112),s(10),n(),r(11,"p",113),s(12),n()(),p(13,"lucide-icon",114),n()()),i&2){let e=c().$implicit;a(6),o("ngClass",e.cardData.color),a(),o("name",e.cardData.icon),a(3),f(e.cardData.name),a(2),f(e.cardData.description)}}function Xi(i,t){if(i&1&&p(0,"app-classification-result",115),i&2){let e=c().$implicit;o("result",e.cardData)}}function Zi(i,t){if(i&1&&(r(0,"div",116)(1,"div",117)(2,"div",118),p(3,"lucide-icon",119),n(),r(4,"div")(5,"h4",120),s(6,"PROHIBITED - Hard Stop"),n(),r(7,"p",121),s(8),n()()(),r(9,"div",122),s(10," Matched prohibited item: "),r(11,"strong"),s(12),n(),s(13,". Process blocked. "),n()()),i&2){let e=c().$implicit;a(8),f((e.cardData.prohibitedMatch==null?null:e.cardData.prohibitedMatch.layer)||"REGULATORY"),a(4),f((e.cardData.prohibitedMatch==null?null:e.cardData.prohibitedMatch.item)||"Unknown")}}function en(i,t){if(i&1&&(r(0,"div",123)(1,"div",117)(2,"div",124),p(3,"lucide-icon",125),n(),r(4,"h4",126),s(5,"ML Prediction"),n()(),r(6,"div",127)(7,"div")(8,"div",128),s(9),n(),r(10,"div",129),s(11,"Approval"),n()(),r(12,"div")(13,"div",128),s(14),n(),r(15,"div",129),s(16,"Timeline"),n()(),r(17,"div")(18,"div",126),s(19),n(),r(20,"div",129),s(21,"Bottleneck"),n()()()()),i&2){let e=c().$implicit;a(9),u("",e.cardData.approvalLikelihood||0,"%"),a(5),u("",e.cardData.timelineDays||0,"d"),a(5),f(e.cardData.bottleneckDept||"-")}}function tn(i,t){if(i&1&&p(0,"app-risk-assessment-result",115),i&2){let e=c().$implicit;o("result",e.cardData)}}function nn(i,t){if(i&1&&p(0,"app-governance-status",115),i&2){let e=c().$implicit;o("result",e.cardData)}}function rn(i,t){if(i&1&&p(0,"app-doc-completeness",115),i&2){let e=c().$implicit;o("result",e.cardData)}}function an(i,t){if(i&1&&p(0,"app-monitoring-alerts",115),i&2){let e=c().$implicit;o("result",e.cardData)}}function sn(i,t){if(i&1){let e=C();r(0,"div",130)(1,"div",117)(2,"div",131),p(3,"lucide-icon",132),n(),r(4,"div")(5,"p",133),s(6,"NPA Record Created"),n(),r(7,"p",134),s(8),n()()(),r(9,"div",135)(10,"div",136)(11,"span",137),s(12,"Title"),n(),r(13,"p",138),s(14),n()(),r(15,"div",136)(16,"span",137),s(17,"Stage"),n(),r(18,"p",139),s(19),n()(),r(20,"div",136)(21,"span",137),s(22,"Status"),n(),r(23,"p",140),s(24),n()(),r(25,"div",136)(26,"button",141),w("click",function(){y(e);let d=c(4);return S(d.navigateToDomain("/agents/npa"))}),s(27,"View in Dashboard"),n()()()()}if(i&2){let e=c().$implicit;a(8),f(e.cardData.npaId),a(6),f(e.cardData.title),a(5),f(e.cardData.stage),a(5),f(e.cardData.status)}}function on(i,t){if(i&1){let e=C();r(0,"div",142),w("click",function(){y(e);let d=c().$implicit,m=c(3);return S(m.navigateToNpaDraft(d.cardData))}),r(1,"div",117)(2,"div",143),p(3,"lucide-icon",144),n(),r(4,"div",111)(5,"p",145),s(6,"NPA Draft Created Successfully"),n(),r(7,"p",146),s(8),n()(),r(9,"div",147),p(10,"lucide-icon",148),n()(),r(11,"div",149)(12,"div",150)(13,"span",151),s(14,"Product"),n(),r(15,"p",138),s(16),n()(),r(17,"div",150)(18,"span",151),s(19,"Stage"),n(),r(20,"p",140),s(21),n()(),r(22,"div",150)(23,"span",151),s(24,"Status"),n(),r(25,"p",140),s(26),n()()(),r(27,"div",152),p(28,"lucide-icon",153),s(29," Open NPA Lifecycle "),n()()}if(i&2){let e=c().$implicit;a(8),f(e.cardData.npaId),a(8),f(e.cardData.title),a(5),f(e.cardData.stage),a(5),f(e.cardData.status)}}function ln(i,t){if(i&1&&(r(0,"div",79)(1,"div",80),g(2,qi,2,1,"span",81)(3,Hi,1,1,"lucide-icon",82),n(),r(4,"div",83),g(5,zi,2,2,"span",84),r(6,"div",85),g(7,Ki,1,1,"markdown",86)(8,Ui,1,0,"span",87)(9,Yi,5,7,"div",88),n(),g(10,Ji,14,4,"div",89)(11,Xi,1,1,"app-classification-result",90)(12,Zi,14,2,"div",91)(13,en,22,3,"div",92)(14,tn,1,1,"app-risk-assessment-result",90)(15,nn,1,1,"app-governance-status",90)(16,rn,1,1,"app-doc-completeness",90)(17,an,1,1,"app-monitoring-alerts",90)(18,sn,28,4,"div",93)(19,on,30,4,"div",94),n()()),i&2){let e=t.$implicit,l=c(3);o("ngClass",fe(19,Wi,e.role==="user")),a(),o("ngClass",e.role==="user"?"bg-indigo-600 text-white":l.getAvatarClasses(e.agentIdentity)),a(),o("ngIf",e.role==="user"),a(),o("ngIf",e.role!=="user"),a(2),o("ngIf",e.role==="agent"&&e.agentIdentity),a(),o("ngClass",e.role==="user"?"bg-indigo-600 text-white rounded-tr-sm":"bg-white border border-slate-200 text-slate-800 rounded-tl-sm"),a(),o("ngIf",e.content),a(),o("ngIf",e.isStreaming),a(),o("ngIf",!e.isStreaming),a(),o("ngIf",e.cardType==="DOMAIN_ROUTE"&&e.cardData),a(),o("ngIf",e.cardType==="CLASSIFICATION"&&e.cardData),a(),o("ngIf",e.cardType==="HARD_STOP"&&e.cardData),a(),o("ngIf",e.cardType==="PREDICTION"&&e.cardData),a(),o("ngIf",e.cardType==="RISK"&&e.cardData),a(),o("ngIf",e.cardType==="GOVERNANCE"&&e.cardData),a(),o("ngIf",e.cardType==="DOC_STATUS"&&e.cardData),a(),o("ngIf",e.cardType==="MONITORING"&&e.cardData),a(),o("ngIf",e.cardType==="NPA_CREATED"&&e.cardData),a(),o("ngIf",e.cardType==="NPA_DRAFT_CTA"&&e.cardData)}}function dn(i,t){if(i&1&&(r(0,"div",154)(1,"div",155),p(2,"lucide-icon",156),n(),r(3,"div",157)(4,"div",158)(5,"span",159),s(6),n(),r(7,"span",160),s(8),n()(),r(9,"div",62)(10,"div",161),p(11,"span",162)(12,"span",163)(13,"span",164),n(),r(14,"span",165),s(15),n()()()()),i&2){let e=c(3);a(6),f(e.thinkingMessage),a(2),f(e.thinkingElapsed),a(7),f(e.thinkingSubMessage)}}function cn(i,t){i&1&&p(0,"lucide-icon",173)}function pn(i,t){i&1&&p(0,"lucide-icon",174)}function mn(i,t){if(i&1&&(r(0,"div",169),p(1,"lucide-icon",170),s(2),g(3,cn,1,0,"lucide-icon",171)(4,pn,1,0,"lucide-icon",172),n()),i&2){let e=t.$implicit;o("ngClass",e.status==="running"?"bg-blue-50 text-blue-700 border-blue-200 animate-pulse":e.status==="done"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"),a(),o("name",e.icon),a(),u(" ",e.name," "),a(),o("ngIf",e.status==="running"),a(),o("ngIf",e.status==="done")}}function un(i,t){if(i&1&&(r(0,"div",166)(1,"span",167),s(2,"Agents:"),n(),g(3,mn,5,5,"div",168),n()),i&2){let e=c(3);a(3),o("ngForOf",e.getActiveAgentsList())}}function gn(i,t){if(i&1){let e=C();r(0,"div",175)(1,"button",176),w("click",function(){y(e);let d=c(3);return S(d.navigateToDomain(d.activeDomainRoute))}),p(2,"lucide-icon",177),s(3),n()()}if(i&2){let e=c(3);a(3),u(" Open in ",(e.activeDomainAgent==null?null:e.activeDomainAgent.name)||"Domain Agent"," ")}}function xn(i,t){if(i&1){let e=C();r(0,"button",178),w("click",function(){y(e);let d=c(3);return S(d.sendMessage())}),p(1,"lucide-icon",43),n()}if(i&2){let e=c(3);o("disabled",!e.userInput.trim())}}function fn(i,t){if(i&1){let e=C();r(0,"button",179),w("click",function(){y(e);let d=c(3);return S(d.stopRequest())}),p(1,"lucide-icon",180),n()}}function vn(i,t){if(i&1){let e=C();r(0,"div",53)(1,"div",54,0),g(3,ji,11,2,"div",55)(4,ln,20,21,"div",56)(5,dn,16,3,"div",57),n(),g(6,un,4,1,"div",58)(7,gn,4,1,"div",59),r(8,"div",60)(9,"div",61)(10,"div",62),p(11,"span",63),r(12,"span",64),s(13),n()()(),r(14,"div",65)(15,"textarea",66),ee("ngModelChange",function(d){y(e);let m=c(2);return Z(m.userInput,d)||(m.userInput=d),S(d)}),w("keydown",function(d){y(e);let m=c(2);return S(m.handleKeyDown(d))}),n(),g(16,xn,2,1,"button",67)(17,fn,2,0,"button",68),n()()()}if(i&2){let e=c(2);a(3),o("ngIf",e.messages.length===0&&!e.isThinking),a(),o("ngForOf",e.messages),a(),o("ngIf",e.isThinking),a(),o("ngIf",e.getActiveAgentsList().length>0),a(),o("ngIf",e.showGenerateButton),a(4),o("ngClass",e.activeDomainAgent?"bg-green-500":"bg-violet-500"),a(2),f(e.activeDomainAgent?e.activeDomainAgent.name:"Master COO Orchestrator"),a(2),X("ngModel",e.userInput),o("placeholder",e.config.context==="NPA_AGENT"?"Ask me anything about your NPA...":"Ask the COO Agent \u2014 NPA, Risk, Operations, Desk Support..."),a(),o("ngIf",!e.isThinking),a(),o("ngIf",e.isThinking)}}function _n(i,t){if(i&1){let e=C();r(0,"button",197),w("click",function(){let d=y(e).$implicit,m=c(3);return S(m.selectedCategory=d.id)}),s(1),n()}if(i&2){let e=t.$implicit,l=c(3);o("ngClass",l.selectedCategory===e.id?"bg-violet-50 text-violet-700 border-violet-200 shadow-sm":"bg-white text-slate-600 border-slate-200 hover:border-slate-300 hover:bg-slate-50"),a(),u(" ",e.name," ")}}function hn(i,t){if(i&1&&(r(0,"span",207),p(1,"lucide-icon",208),s(2),n()),i&2){let e=c(2).$implicit;a(2),u(" ",e.avgTime," ")}}function bn(i,t){if(i&1&&(r(0,"span",207),p(1,"lucide-icon",209),s(2),n()),i&2){let e=c(2).$implicit;a(2),u(" ",e.successRate,"% success ")}}function yn(i,t){if(i&1&&(r(0,"div",205),g(1,hn,3,1,"span",206)(2,bn,3,1,"span",206),n()),i&2){let e=c().$implicit;a(),o("ngIf",e.avgTime),a(),o("ngIf",e.successRate)}}function Sn(i,t){if(i&1){let e=C();r(0,"div",198),w("click",function(){let d=y(e).$implicit,m=c(3);return S(m.handleTemplateClick(d))}),r(1,"div",199)(2,"div",200),p(3,"lucide-icon",110),n(),p(4,"lucide-icon",201),n(),r(5,"h4",202),s(6),n(),r(7,"p",203),s(8),n(),g(9,yn,3,2,"div",204),n()}if(i&2){let e=t.$implicit;a(2),o("ngClass",e.iconBg),a(),o("name",e.icon),a(3),f(e.title),a(2),f(e.description),a(),o("ngIf",e.successRate||e.avgTime)}}function Cn(i,t){i&1&&(r(0,"span",230),s(1,"*"),n())}function wn(i,t){if(i&1){let e=C();r(0,"input",231),ee("ngModelChange",function(d){y(e);let m=c().index,x=c(4);return Z(x.templateFormValues[m],d)||(x.templateFormValues[m]=d),S(d)}),n()}if(i&2){let e=c(),l=e.$implicit,d=e.index,m=c(4);o("type",l.type||"text")("placeholder",l.placeholder),X("ngModel",m.templateFormValues[d])}}function In(i,t){if(i&1){let e=C();r(0,"textarea",232),ee("ngModelChange",function(d){y(e);let m=c().index,x=c(4);return Z(x.templateFormValues[m],d)||(x.templateFormValues[m]=d),S(d)}),n()}if(i&2){let e=c(),l=e.$implicit,d=e.index,m=c(4);o("placeholder",l.placeholder),X("ngModel",m.templateFormValues[d])}}function kn(i,t){if(i&1&&(r(0,"div")(1,"label",226),s(2),g(3,Cn,2,0,"span",227),n(),g(4,wn,1,3,"input",228)(5,In,1,2,"textarea",229),n()),i&2){let e=t.$implicit;a(2),u("",e.label," "),a(),o("ngIf",e.required),a(),o("ngIf",e.type!=="textarea"),a(),o("ngIf",e.type==="textarea")}}function An(i,t){if(i&1){let e=C();r(0,"div",210)(1,"div",211)(2,"h3",212),s(3,"Configure Template"),n(),r(4,"button",213),w("click",function(){y(e);let d=c(3);return S(d.activeTemplate=null)}),p(5,"lucide-icon",214),n()(),r(6,"div",215)(7,"div",216)(8,"div",217)(9,"div",218),p(10,"lucide-icon",110),n(),r(11,"div")(12,"label",219),s(13,"Selected"),n(),r(14,"p",220),s(15),n()()(),r(16,"div",221),s(17),n(),r(18,"div",222),g(19,kn,6,4,"div",223),n()()(),r(20,"div",224)(21,"button",176),w("click",function(){y(e);let d=c(3);return S(d.submitTemplateForm())}),p(22,"lucide-icon",225),s(23," Generate with AI "),n()()()}if(i&2){let e=c(3);a(9),o("ngClass",e.activeTemplate.iconBg),a(),o("name",e.activeTemplate.icon),a(5),f(e.activeTemplate.title),a(2),u(" ",e.activeTemplate.description," "),a(2),o("ngForOf",e.activeTemplate.inputs)}}function En(i,t){if(i&1){let e=C();r(0,"div",181)(1,"div",182)(2,"div",183),p(3,"lucide-icon",184),s(4," Categories: "),n(),g(5,_n,2,2,"button",185),n(),r(6,"div",186)(7,"div",187)(8,"div",188)(9,"h3",189),s(10),r(11,"span",190),s(12),n()(),r(13,"div",191),p(14,"lucide-icon",192),r(15,"input",193),ee("ngModelChange",function(d){y(e);let m=c(2);return Z(m.templateSearchQuery,d)||(m.templateSearchQuery=d),S(d)}),n()()(),r(16,"div",194),g(17,Sn,10,5,"div",195),n()()(),g(18,An,24,5,"div",196),n()}if(i&2){let e=c(2);a(5),o("ngForOf",e.filteredCategories),a(5),u(" ",e.getCategoryName(e.selectedCategory)," "),a(2),u("(",e.getTemplatesByCategory(e.selectedCategory).length," templates)"),a(3),X("ngModel",e.templateSearchQuery),a(2),o("ngForOf",e.getTemplatesByCategory(e.selectedCategory)),a(),o("ngIf",e.config.showTemplateForm&&e.activeTemplate)}}function Tn(i,t){if(i&1&&(r(0,"div",49)(1,"div",50),g(2,vn,18,11,"div",51)(3,En,19,6,"div",52),n()()),i&2){let e=c();o("ngClass",fe(3,Gi,e.config.showLanding)),a(2),o("ngIf",e.chatTab==="CHAT"),a(),o("ngIf",e.chatTab==="TEMPLATES")}}var He=class i{scrollContainer;config={context:"COMMAND_CENTER",showLanding:!0,showSidebar:!0,showTemplateForm:!1,templateFilter:null,title:"COO Multi-Agent Workbench",subtitle:"Master Orchestrator"};onBack=new J;onComplete=new J;userService=V(Fe);layoutService=V(le);difyService=V($e);chatSessionService=V(ge);npaService=V(je);router=V(Oe);activitySub;currentSubscription;userRole=()=>this.userService.currentUser().role;viewMode="LANDING";chatTab="TEMPLATES";isHistoryPanelOpen=!0;landingInput="";inputFocused=!1;quickHints=[{label:"Create an NPA",prompt:"I want to create a new product approval for a structured note"},{label:"Risk check",prompt:"Run a risk assessment for a new FX derivative"},{label:"Search policies",prompt:"Search the knowledge base for MAS guidelines on structured deposits"},{label:"My approvals",prompt:"Show me my pending approvals and sign-off status"}];userInput="";isThinking=!1;thinkingMessage="Master COO analyzing request...";thinkingSubMessage="";thinkingElapsed="0s";thinkingStartTime=0;thinkingTimerInterval=null;thinkingSubMessageInterval=null;thinkingSubMessageIndex=0;messages=[];showGenerateButton=!1;activeDomainRoute="";pendingDraftPayload=null;activeDomainAgent=null;AGENTS={};activeAgents=new Map;copiedMessageId=null;get suggestionChips(){return this.config.context==="NPA_AGENT"?[{label:"Create a new NPA",icon:"file-plus",prompt:"I want to create a new product approval for a structured note"},{label:"Run risk assessment",icon:"shield-alert",prompt:"Run a risk assessment for a new FX derivative"},{label:"Check compliance",icon:"scale",prompt:"Check MAS regulatory compliance for a structured deposit"},{label:"Product classification",icon:"layers",prompt:"Classify a new equity-linked structured product"}]:[{label:"Create an NPA",icon:"file-plus",prompt:"I want to create a new product approval for a structured note"},{label:"Risk check",icon:"shield-alert",prompt:"Run a risk assessment for a new FX derivative"},{label:"Search policies",icon:"book-open",prompt:"Search the knowledge base for MAS guidelines on structured deposits"},{label:"My approvals",icon:"clipboard-check",prompt:"Show me my pending approvals and sign-off status"}]}selectedCategory="";templateSearchQuery="";activeTemplate=null;templateFormValues=[];filteredCategories=[];filteredTemplates=[];constructor(){for(let t of qe)this.AGENTS[t.id]={id:t.id,name:t.name,role:t.description,color:t.color,icon:t.icon},this.activeAgents.set(t.id,"idle")}ngOnInit(){this.config.templateFilter&&this.config.templateFilter.length>0?(this.filteredCategories=ve.filter(t=>this.config.templateFilter.includes(t.id)),this.filteredTemplates=_e.filter(t=>this.config.templateFilter.includes(t.category))):(this.filteredCategories=ve,this.filteredTemplates=_e),this.selectedCategory=this.filteredCategories[0]?.id||"",this.config.showLanding||(this.viewMode="CHAT",this.chatTab="TEMPLATES",this.registerChatModeWithLayout(),this.tryAutoRestoreActiveSession(),setTimeout(()=>this.tryAutoRestoreActiveSession(),500),setTimeout(()=>this.tryAutoRestoreActiveSession(),1500)),this.activitySub=this.difyService.getAgentActivity().subscribe(t=>{this.activeAgents.set(t.agentId,t.status)})}ngAfterViewChecked(){this.scrollToBottom()}ngOnDestroy(){this.activitySub?.unsubscribe(),this.currentSubscription?.unsubscribe(),this.stopThinkingTimer(),this.autoSaveSession(),this.layoutService.exitChatMode(),this.layoutService.setSidebarVisible(!0),this.layoutService.setSidebarState(!1)}userInitial(){return this.userService.currentUser().name.charAt(0)}startChatFromLanding(){if(!this.landingInput.trim())return;let t=this.landingInput;this.landingInput="",this.enterChatMode(),this.processMessage(t)}startChatFromHint(t){this.landingInput="",this.enterChatMode(),this.processMessage(t)}enterChatMode(){this.viewMode="CHAT",this.chatTab="CHAT",this.difyService.reset(),this.registerChatModeWithLayout()}registerChatModeWithLayout(){this.layoutService.enterChatMode({title:this.config.title,subtitle:this.activeDomainAgent?this.activeDomainAgent.name:this.config.subtitle,activeTab:this.chatTab,onBack:()=>this.goBack(),onTabChange:t=>{this.chatTab=t,this.layoutService.updateChatTab(t)},onNewChat:()=>this.newChatFromSidebar(),onResetChat:()=>this.resetChat(),onSelectSession:t=>this.loadSession(t)}),this.layoutService.setSidebarState(!1)}goBack(){this.layoutService.exitChatMode(),this.config.showLanding?(this.autoSaveSession(),this.chatSessionService.startNewSession(),this.viewMode="LANDING",this.messages=[],this.activeDomainAgent=null,this.showGenerateButton=!1,this.difyService.reset(),this.activeAgents.forEach((t,e)=>this.activeAgents.set(e,"idle")),this.layoutService.setSidebarVisible(!0),this.layoutService.setSidebarState(!1)):this.onBack.emit()}sendMessage(){if(!this.userInput.trim())return;let t=this.userInput;this.userInput="",this.processMessage(t)}stopRequest(){this.currentSubscription?.unsubscribe(),this.currentSubscription=void 0,this.isThinking=!1,this.stopThinkingTimer(),this.messages.push({role:"agent",content:"*Request cancelled by user.*",timestamp:new Date,agentIdentity:this.AGENTS.MASTER_COO})}handleKeyDown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.isThinking&&this.stopRequest(),this.userInput.trim()&&this.sendMessage())}AGENT_THINKING_MESSAGES={MASTER_COO:["Analyzing your request...","Identifying the right domain...","Routing to specialist agent...","Evaluating request context..."],IDEATION:["Gathering product information...","Searching for similar historical NPAs...","Checking prohibited products list...","Analyzing product structure...","Evaluating regulatory requirements...","Building NPA draft..."],CLASSIFIER:["Running classification model...","Comparing against product taxonomy...","Checking prohibited/restricted lists...","Scoring product complexity..."],RISK:["Evaluating risk factors...","Running risk scoring model...","Analyzing market exposure...","Checking regulatory risk limits..."],DILIGENCE:["Searching knowledge base...","Retrieving relevant policies...","Cross-referencing guidelines..."],DEFAULT:["Processing your request...","Analyzing data...","Preparing response..."]};startThinkingTimer(t){this.thinkingStartTime=Date.now(),this.thinkingElapsed="0s",this.thinkingSubMessageIndex=0;let e=this.AGENT_THINKING_MESSAGES[t]||this.AGENT_THINKING_MESSAGES.DEFAULT;this.thinkingSubMessage=e[0],this.thinkingTimerInterval=setInterval(()=>{let l=Math.floor((Date.now()-this.thinkingStartTime)/1e3);this.thinkingElapsed=l<60?`${l}s`:`${Math.floor(l/60)}m ${l%60}s`},1e3),this.thinkingSubMessageInterval=setInterval(()=>{this.thinkingSubMessageIndex=(this.thinkingSubMessageIndex+1)%e.length,this.thinkingSubMessage=e[this.thinkingSubMessageIndex]},4e3)}stopThinkingTimer(){this.thinkingTimerInterval&&(clearInterval(this.thinkingTimerInterval),this.thinkingTimerInterval=null),this.thinkingSubMessageInterval&&(clearInterval(this.thinkingSubMessageInterval),this.thinkingSubMessageInterval=null)}processMessage(t){this.messages.push({role:"user",content:t,timestamp:new Date}),this.sessionDirty=!0,this.isThinking=!0;let e=this.difyService.activeAgentId,l=this.AGENTS[e];this.thinkingMessage=l?`${l.name} is working`:"Master COO Orchestrator is working",this.startThinkingTimer(e);let d={role:"agent",content:"",timestamp:new Date,agentIdentity:l||this.AGENTS.MASTER_COO,isStreaming:!0};this.messages.push(d),this.currentSubscription?.unsubscribe(),this.currentSubscription=this.difyService.sendMessageStreamed(t).subscribe({next:m=>{if(m.type==="chunk")d.content+=m.text;else if(m.type==="thought")this.thinkingMessage=`${l?.name||"Agent"} is working`,this.thinkingSubMessage=m.thought;else if(m.type==="done"){let x=this.messages.indexOf(d);x!==-1&&this.messages.splice(x,1),this.handleResponse(m.response)}},error:()=>{let m=this.messages.indexOf(d);m!==-1&&this.messages.splice(m,1);let x=this.difyService.activeAgentId||"MASTER_COO";this.messages.push({role:"agent",content:"Sorry, I encountered an error. Please try again.",timestamp:new Date,agentIdentity:this.AGENTS[x]||this.AGENTS.MASTER_COO}),this.isThinking=!1,this.stopThinkingTimer(),this.autoSaveSession()}})}handleResponse(t){let e=this.difyService.activeAgentId||t.metadata?.agent_id||"MASTER_COO",l=this.AGENTS[e]||this.AGENTS.MASTER_COO,d=t.metadata?.agent_action,m=null;t.metadata&&(m=this.difyService.processAgentRouting(t.metadata));let x,_;if(d==="ROUTE_DOMAIN"&&t.metadata?.payload){let v=t.metadata.payload,h=v.data||v;x="DOMAIN_ROUTE",_=G(T({},h),{target_agent:v.target_agent,intent:v.intent}),this.activeDomainAgent={id:h.domainId||v.domainId||"NPA",name:h.name||v.name||"NPA Domain Orchestrator",icon:h.icon||v.icon||"target",color:h.color||v.color||"bg-orange-50 text-orange-600"},this.layoutService.updateChatSubtitle(this.activeDomainAgent.name);let R=h.route||v.uiRoute||v.route;R&&(this.activeDomainRoute=R)}else if(d==="DELEGATE_AGENT"&&t.metadata?.payload){let v=t.metadata.payload.target_agent,h=this.AGENTS[v];h&&(this.activeDomainAgent={id:v,name:h.name,icon:h.icon,color:h.color},this.layoutService.updateChatSubtitle(h.name)),x="INFO",_={title:`Delegating to ${h?.name||v}`,description:t.metadata.payload.reason||"Switching to specialist agent"}}else d==="SHOW_CLASSIFICATION"&&t.metadata?.payload?(x="CLASSIFICATION",_=t.metadata.payload):d==="HARD_STOP"||d==="STOP_PROCESS"?(x="HARD_STOP",_=t.metadata?.payload):d==="SHOW_PREDICTION"&&t.metadata?.payload?(x="PREDICTION",_=t.metadata.payload):d==="SHOW_RISK"&&t.metadata?.payload?(x="RISK",_=t.metadata.payload):d==="SHOW_GOVERNANCE"&&t.metadata?.payload?(x="GOVERNANCE",_=t.metadata.payload):d==="SHOW_DOC_STATUS"&&t.metadata?.payload?(x="DOC_STATUS",_=t.metadata.payload):d==="SHOW_MONITORING"&&t.metadata?.payload?(x="MONITORING",_=t.metadata.payload):d==="FINALIZE_DRAFT"&&(this.showGenerateButton=!0,this.activeDomainRoute=t.metadata?.payload?.route||"/agents/npa",this.triggerClassifier(t.metadata?.payload),this.pendingDraftPayload=t.metadata?.payload,this.createNpaFromDraft(t.metadata?.payload),t.metadata?.payload?.target_agent&&this.difyService.returnToPreviousAgent("finalize_draft"));if((t.answer&&t.answer.trim().length>0||!!x&&x!=="DOMAIN_ROUTE")&&(this.messages.push({role:"agent",content:t.answer,timestamp:new Date,agentIdentity:l,cardType:x,cardData:_,agentAction:d}),this.sessionDirty=!0),m?.shouldSwitch&&m.targetAgent){let v=m.targetAgent,h=this.AGENTS[v],R=t.metadata?.payload?.intent||t.metadata?.payload?.data?.intent||"";if(h&&(this.activeDomainAgent={id:v,name:h.name,icon:h.icon,color:h.color},this.layoutService.updateChatSubtitle(h.name)),(d==="DELEGATE_AGENT"||d==="ROUTE_DOMAIN")&&v){let W=this.AGENTS[v]||this.AGENTS.MASTER_COO,E=h?.name||v,$="Agent Handoff",q=`${E} is taking over with full context.`;d==="ROUTE_DOMAIN"&&R&&($="Domain Orchestrator",q=`Routing to ${E} to handle **${R}**. Forwarding your request...`),this.messages.push({role:"agent",content:`**${E}** is now connected. Forwarding context...`,timestamp:new Date,agentIdentity:W,cardType:"INFO",cardData:{title:$,description:q}}),this.sessionDirty=!0,this.isThinking=!0,this.startThinkingTimer(`${E} is loading context...`);let A=this._buildDelegationContext(t.answer);this.currentSubscription?.unsubscribe(),this.currentSubscription=this.difyService.sendMessageStreamed(A,{orchestrator_message:t.answer.substring(0,4e3)},v).subscribe({next:H=>{H.type==="done"&&this.handleResponse(H.response)},error:()=>{this.isThinking=!1,this.stopThinkingTimer()}})}else{let W=this.AGENTS[v]||this.AGENTS.MASTER_COO,E=h?.name||v,$=R?`

I understand you'd like to **${R}**. `:`

`,q=`**${E}** is ready.${$}Go ahead and describe your product idea or requirement \u2014 I'll guide you through the process step by step.`;this.messages.push({role:"agent",content:q,timestamp:new Date,agentIdentity:W}),this.sessionDirty=!0,this.isThinking=!1,this.stopThinkingTimer()}}else this.isThinking=!1,this.stopThinkingTimer();this.autoSaveSession()}resetChat(){this.messages=[],this.activeDomainAgent=null,this.showGenerateButton=!1,this.sessionDirty=!1,this.difyService.reset(),this.activeAgents.forEach((t,e)=>this.activeAgents.set(e,"idle")),this.layoutService.updateChatSubtitle(this.config.subtitle)}sessionDirty=!1;didAutoRestoreSession=!1;sessionLoadSeq=0;sessionId=null;_buildDelegationContext(t){let e=t.substring(0,3e3);return`[CONTEXT FROM ORCHESTRATOR]
The following product details were gathered during the routing phase. Please use this context to begin the structured interview \u2014 do not re-ask questions already answered.

User's original request:
${this.messages.filter(d=>d.role==="user").map(d=>d.content).join(" | ").substring(0,2e3)}

Orchestrator summary:
${e}`}autoSaveSession(){if(this.messages.length===0||!this.sessionDirty)return;let t=!this.sessionId;this.sessionId=this.chatSessionService.saveSessionFor(this.sessionId,this.messages,this.difyService.activeAgentId,this.activeDomainAgent,{makeActive:t,conversationState:this.difyService.exportConversationState()})}newChatFromSidebar(){this.autoSaveSession(),this.resetChat(),this.sessionId=null,this.chatSessionService.startNewSession()}async loadSession(t){let e=++this.sessionLoadSeq;this.autoSaveSession(),this.difyService.reset(),this.activeAgents.forEach((b,I)=>this.activeAgents.set(I,"idle")),this.showGenerateButton=!1;let l=await this.chatSessionService.fetchSessionWithMessages(t.id);if(e!==this.sessionLoadSeq)return;let d=l?.messages||t.messages||[];this.messages=d.map(b=>({role:b.role,content:b.content,timestamp:new Date(b.timestamp),agentIdentity:b.agentIdentityId?this.AGENTS[b.agentIdentityId]||this.AGENTS.MASTER_COO:void 0,cardType:b.cardType,cardData:b.cardData,agentAction:b.agentAction}));let m=l?.domainAgent||t.domainAgent;this.activeDomainAgent=m||null,this.layoutService.updateChatSubtitle(this.activeDomainAgent?.name||this.config.subtitle);let x=l?.activeAgentId||t.activeAgentId;x&&x!=="MASTER_COO"&&this.difyService.setActiveAgent(x);let _=l?.conversationState||t.conversationState;_&&this.difyService.restoreConversationState(_),this.chatSessionService.setActiveSession(t.id),this.sessionId=t.id,this.chatTab="CHAT",this.isThinking=!1,this.stopThinkingTimer(),this.sessionDirty=!1}tryAutoRestoreActiveSession(){if(this.didAutoRestoreSession)return;let t=this.chatSessionService.activeSessionId();if(!t)return;let e=this.chatSessionService.getSession(t);e&&(this.didAutoRestoreSession=!0,this.sessionId=t,this.loadSession(e))}navigateToDomain(t){t&&(this.layoutService.setSidebarState(!1),this.router.navigate([t]))}navigateToNpaDraft(t){let e=G(T({},t.draftPayload||{}),{npaId:t.npaId,title:t.title,stage:t.stage,sessionId:t.sessionId,conversationId:t.conversationId});this.onComplete.emit(e)}createNpaFromDraft(t){if(!t)return;let e=t.data||{},l=t.product_name||t.title||e.product_name||e.title||e.name||"Untitled NPA",d=t.product_description||t.description||e.product_description||e.description||`${t.product_type||e.product_type||""} \u2014 ${t.target_market||e.target_market||""}`.trim();this.npaService.create({title:l,description:d,npa_type:t.product_type||t.npa_type||e.product_type||e.npa_type||"STRUCTURED_PRODUCT"}).subscribe({next:m=>{let x=this.config.context==="NPA_AGENT";this.triggerClassifier(t,m.id);let _=["data","target_agent","uiRoute","projectId","intent","project_id","npaId","id","title","description","npa_type"],b=[],I=T(T({},t.data||{}),t);for(let[v,h]of Object.entries(I))_.includes(v)||h===null||h===void 0||h===""||(typeof h=="string"||typeof h=="number"||typeof h=="boolean"?b.push({field_key:v,field_value:String(h),lineage:"AUTO"}):Array.isArray(h)&&b.push({field_key:v,field_value:h.join(", "),lineage:"AUTO"}));b.find(v=>v.field_key==="risk_level")||b.push({field_key:"risk_level",field_value:t.risk_level||e.risk_level||"MEDIUM",lineage:"AUTO"}),b.find(v=>v.field_key==="is_cross_border")||b.push({field_key:"is_cross_border",field_value:t.is_cross_border||e.is_cross_border?"true":"false",lineage:"AUTO"}),this.npaService.update(m.id,{formData:b}).subscribe({next:()=>console.log(`[AgentWorkspace] Initial data persisted for ${m.id}`),error:v=>console.warn("[AgentWorkspace] Failed to persist initial formData",v)}),this.messages.push({role:"agent",content:x?`NPA Draft **${m.id}** created successfully! Click below to open the NPA Lifecycle view where you can review the proposal, track approvals, and continue chatting with the agent.`:`NPA record **${m.id}** created successfully and is now in the **INITIATION** stage.`,timestamp:new Date,agentIdentity:this.AGENTS.NPA_ORCHESTRATOR,cardType:x?"NPA_DRAFT_CTA":"NPA_CREATED",cardData:{npaId:m.id,title:l,stage:"INITIATION",status:"On Track",draftPayload:this.pendingDraftPayload,sessionId:this.chatSessionService.activeSessionId(),conversationId:this.difyService.getConversationId()}}),this.sessionDirty=!0,this.autoSaveSession()},error:m=>{console.error("[NPA] Creation failed:",m),this.messages.push({role:"agent",content:"NPA record creation failed \u2014 the draft data has been captured and you can create it manually from the NPA Dashboard.",timestamp:new Date,agentIdentity:this.AGENTS.NPA_ORCHESTRATOR,agentAction:"SHOW_ERROR"}),this.sessionDirty=!0,this.autoSaveSession()}})}triggerClassifier(t,e){let l=t?.data||{},d={product_name:t?.product_name||t?.title||l.product_name||l.title||l.name||"Untitled Product",product_description:t?.product_description||t?.description||l.product_description||l.description||"",product_type:t?.product_type||l.product_type||"",asset_class:t?.asset_class||l.asset_class||"",target_market:t?.target_market||l.target_market||"",distribution_channel:t?.distribution_channel||l.distribution_channel||"",risk_features:t?.risk_features||l.risk_features||"",jurisdictions:(t?.jurisdictions||l.jurisdictions||[]).join?.(", ")||"",notional_size:t?.notional_size||t?.notional||l.notional_size||l.notional||"",regulatory_framework:t?.regulatory_framework||l.regulatory_framework||""},m=e||t?.project_id||t?.projectId||t?.npaId||t?.id||l.project_id||l.projectId||"";m&&(d.project_id=String(m)),this.difyService.runWorkflow("CLASSIFIER",d).subscribe({next:x=>{if(x.data.status==="succeeded"){let _=this.parseClassifierResponse(x.data.outputs);_.workflowRunId=x.workflow_run_id,_.taskId=x.task_id,_.prohibitedMatch?.matched?(this.showGenerateButton=!1,this.messages.push({role:"agent",content:"**HARD STOP** \u2014 This product has been classified as **Prohibited**. NPA creation is blocked.",timestamp:new Date,agentIdentity:this.AGENTS.CLASSIFIER,cardType:"HARD_STOP",cardData:_})):this.messages.push({role:"agent",content:"Classification analysis complete.",timestamp:new Date,agentIdentity:this.AGENTS.CLASSIFIER,cardType:"CLASSIFICATION",cardData:_}),this.sessionDirty=!0,this.autoSaveSession()}},error:x=>{console.error("[CLASSIFIER] Workflow failed:",x),this.messages.push({role:"agent",content:"Classification workflow encountered an error. You can still proceed with the NPA draft manually.",timestamp:new Date,agentIdentity:this.AGENTS.CLASSIFIER,agentAction:"SHOW_ERROR"}),this.sessionDirty=!0,this.autoSaveSession()}})}parseClassifierResponse(t){let e=t?.result||"",l=e.match(/```json\s*([\s\S]*?)\s*```/);l&&(e=l[1]);let d;try{d=JSON.parse(e)}catch{return{type:"NTG",track:"Full NPA",scores:[],overallConfidence:0,mandatorySignOffs:[],analysisSummary:["Classifier returned unstructured (non-JSON) output. Update the Dify workflow to return JSON-only to enable structured scoring."],rawOutput:e}}let m={FULL_NPA:"Full NPA",NPA_LITE:"NPA Lite",EVERGREEN:"Evergreen",PROHIBITED:"Prohibited",VARIATION:"NPA Lite"},x={FULL_NPA:"NTG",NPA_LITE:"Variation",EVERGREEN:"Existing",PROHIBITED:"NTG",VARIATION:"Variation"},_=d.scorecard||d.score_card||{},b=_.ntg_total_score||0,I=_.ntg_max_score||30,v=[],h=[{key:"product_innovation",name:"Product Innovation",max:15},{key:"market_customer",name:"Market & Customer",max:8},{key:"risk_regulatory",name:"Risk & Regulatory",max:7},{key:"financial_operational",name:"Financial & Operational",max:0}];for(let A of h){let H=_[A.key];H&&v.push({criterion:A.name,score:H.subtotal||0,maxScore:H.max_subtotal||A.max,reasoning:Object.entries(H).filter(([xe])=>!["subtotal","max_subtotal"].includes(xe)).map(([xe,he])=>`${xe}: ${he.score}/${he.max}`).join(", ")})}let R=I>0?Math.round((1-Math.abs(b-I/2)/(I/2))*100):80,W=[],E=d.analysis_summary||d.summary||{};E?.prohibited_check&&W.push(`Prohibited check: ${E.prohibited_check}`),E?.cross_border!==void 0&&W.push(`Cross-border: ${E.cross_border?"YES":"NO"}`),E?.similar_npas&&W.push(`Similar NPAs: ${E.similar_npas}`),E?.product&&W.push(`Product: ${E.product}`);let $=[],q=d.ntg_triggers||d.ntg_trigger_check||[];if(Array.isArray(q))for(let A of q)A&&$.push({id:String(A.id||A.trigger_id||""),name:String(A.name||A.trigger||""),fired:!!(A.fired??A.applies??A.is_true),reason:A.reason?String(A.reason):void 0});return G(T(T({type:x[d.classification_type]||"NTG",track:m[d.classification_type]||"Full NPA",scores:v,overallConfidence:Math.max(R,60)},W.length?{analysisSummary:W}:{}),$.length?{ntgTriggers:$}:{}),{rawOutput:t?.result||e,rawJson:d,prohibitedMatch:d.prohibited_check?{matched:d.prohibited_check.is_prohibited||!1,item:(d.prohibited_check.matched_items||[])[0]||void 0,layer:d.prohibited_check.is_prohibited?"REGULATORY":void 0}:void 0,mandatorySignOffs:d.mandatory_signoffs||[]})}getCategoryName(t){return this.filteredCategories.find(e=>e.id===t)?.name||"Templates"}getTemplatesByCategory(t){let e=this.filteredTemplates.filter(l=>l.category===t);if(this.templateSearchQuery.trim()){let l=this.templateSearchQuery.toLowerCase();e=e.filter(d=>d.title.toLowerCase().includes(l)||d.description.toLowerCase().includes(l))}return e}handleTemplateClick(t){this.config.showTemplateForm&&t.inputs&&t.inputs.length>0?(this.activeTemplate=t,this.templateFormValues=t.inputs.map(()=>"")):(this.chatTab="CHAT",this.processMessage(t.prompt))}submitTemplateForm(){if(!this.activeTemplate)return;let t=this.activeTemplate.title,l=(this.activeTemplate.inputs||[]).map((m,x)=>`${m.label}: ${this.templateFormValues[x]||"[Not specified]"}`).join(`
`),d=`Task: ${t}

${l}`;this.activeTemplate=null,this.templateFormValues=[],this.chatTab="CHAT",this.processMessage(d)}getActiveAgentsList(){return Array.from(this.activeAgents.entries()).filter(([t,e])=>e!=="idle").map(([t,e])=>{let l=this.AGENTS[t];return{id:t,name:l?.name||t,icon:l?.icon||"bot",status:e}})}getAvatarClasses(t){if(!t)return"bg-violet-50 border border-violet-200 text-violet-600";let e=t.color.split(" ");return`${e[0]||"bg-violet-50"} border border-slate-200 ${e[1]||"text-violet-600"}`}getAgentLabelClass(t){return t&&t.color.split(" ")[1]||"text-violet-600"}copyMessage(t){navigator.clipboard.writeText(t).then(()=>{this.copiedMessageId=Date.now(),setTimeout(()=>this.copiedMessageId=null,2e3)})}scrollToBottom(){try{this.scrollContainer&&(this.scrollContainer.nativeElement.scrollTop=this.scrollContainer.nativeElement.scrollHeight)}catch{}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-agent-workspace"]],viewQuery:function(e,l){if(e&1&&ye(Ni,5),e&2){let d;Se(d=Ce())&&(l.scrollContainer=d.first)}},inputs:{config:"config"},outputs:{onBack:"onBack",onComplete:"onComplete"},decls:2,vars:2,consts:[["scrollContainer",""],["class","min-h-full flex flex-col items-center justify-center px-8 bg-white text-slate-900 relative overflow-hidden h-full",4,"ngIf"],["class","h-full w-full flex flex-col bg-white",3,"ngClass",4,"ngIf"],[1,"min-h-full","flex","flex-col","items-center","justify-center","px-8","bg-white","text-slate-900","relative","overflow-hidden","h-full"],[1,"absolute","inset-0","overflow-hidden","pointer-events-none"],[1,"absolute","top-0","-left-4","w-96","h-96","bg-[#FF3E3E]","rounded-full","mix-blend-multiply","filter","blur-3xl","opacity-10","animate-blob"],[1,"absolute","top-0","-right-4","w-96","h-96","bg-[#0077CC]","rounded-full","mix-blend-multiply","filter","blur-3xl","opacity-10","animate-blob","animation-delay-2000"],[1,"absolute","-bottom-32","left-20","w-96","h-96","bg-[#CC9955]","rounded-full","mix-blend-multiply","filter","blur-3xl","opacity-10","animate-blob","animation-delay-4000"],[1,"relative","z-10","w-full","max-w-6xl","flex","flex-col","items-center"],[1,"mb-8","px-4","py-1.5","rounded-full","border","border-red-200","bg-red-50","backdrop-blur-sm","text-xs","font-medium","text-red-600","flex","items-center","gap-2","shadow-sm"],[1,"w-2","h-2","rounded-full","bg-red-500","animate-pulse"],[1,"text-6xl","font-bold","tracking-tight","mb-4","text-center","text-slate-900"],[1,"text-xl","text-slate-500","font-normal","mb-12","text-center","max-w-2xl"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","w-full","text-left"],[1,"bg-white/60","backdrop-blur-xl","rounded-xl","flex","flex-col","shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]","hover:shadow-[0_8px_30px_rgb(0,0,0,0.12)]","transition-all","duration-300","overflow-hidden","border","border-white/50","group"],[1,"p-8","pb-4","flex-1"],[1,"w-14","h-14","rounded-2xl","bg-red-50/80","border","border-red-100","flex","items-center","justify-center","mb-6","group-hover:scale-110","transition-transform","duration-500"],["name","bot",1,"w-7","h-7","text-[#FF3E3E]"],[1,"text-xl","font-bold","mb-3","text-slate-900"],[1,"text-base","text-slate-500","leading-relaxed"],[1,"mt-6"],[1,"border-t","border-slate-100/50","flex","items-center","justify-between","px-8","py-5","cursor-pointer","hover:bg-red-50/30","transition-colors","group/item",3,"routerLink"],[1,"flex","items-center","gap-3"],[1,"w-2","h-2","rounded-full","bg-green-500"],[1,"text-sm","font-semibold","text-slate-700"],["name","arrow-right",1,"w-4","h-4","text-[#FF3E3E]","opacity-0","-translate-x-2","group-hover/item:opacity-100","group-hover/item:translate-x-0","transition-all","duration-300"],[1,"border-t","border-slate-100/50","flex","items-center","justify-between","px-8","py-5","cursor-not-allowed","opacity-40"],[1,"w-2","h-2","rounded-full","bg-slate-300"],[1,"text-[10px]","bg-slate-100","text-slate-500","px-2","py-0.5","rounded-full","font-medium"],[1,"w-14","h-14","rounded-2xl","bg-slate-50/80","border","border-slate-100","flex","items-center","justify-center","mb-6","group-hover:scale-110","transition-transform","duration-500"],["name","layers",1,"w-7","h-7","text-slate-800"],[1,"border-t","border-slate-100/50","flex","items-center","justify-between","px-8","py-5","cursor-pointer","hover:bg-slate-50/50","transition-colors","group/item",3,"routerLink"],["name","arrow-right",1,"w-4","h-4","text-slate-500","opacity-0","-translate-x-2","group-hover/item:opacity-100","group-hover/item:translate-x-0","transition-all","duration-300"],[1,"w-14","h-14","rounded-2xl","bg-orange-50/80","border","border-orange-100","flex","items-center","justify-center","mb-6","group-hover:scale-110","transition-transform","duration-500"],["name","brain-circuit",1,"w-7","h-7","text-orange-600"],[1,"border-t","border-slate-100/50","flex","items-center","justify-between","px-8","py-5","cursor-pointer","hover:bg-orange-50/50","transition-colors","group/item",3,"routerLink"],["name","arrow-right",1,"w-4","h-4","text-orange-500","opacity-0","-translate-x-2","group-hover/item:opacity-100","group-hover/item:translate-x-0","transition-all","duration-300"],[1,"mt-12","w-full","max-w-3xl"],[1,"relative","flex","items-center","group"],[1,"absolute","left-4","text-violet-400","group-focus-within:text-violet-600","transition-colors"],["name","brain-circuit",1,"w-5","h-5"],["type","text","placeholder","Ask the COO Agent \u2014 NPA, Risk, Operations, Desk Support...",1,"w-full","bg-white/80","backdrop-blur-sm","text-slate-900","text-sm","rounded-2xl","pl-12","pr-14","py-4","border","border-slate-200","focus:border-violet-400","focus:ring-2","focus:ring-violet-100","focus:outline-none","transition-all","placeholder:text-slate-400","shadow-lg","hover:shadow-xl","focus:shadow-xl",3,"ngModelChange","keydown.enter","focus","blur","ngModel"],[1,"absolute","right-2","p-2.5","rounded-xl","bg-violet-600","hover:bg-violet-500","text-white","disabled:opacity-30","disabled:cursor-not-allowed","transition-all","shadow-sm",3,"click","disabled"],["name","send",1,"w-4","h-4"],[1,"flex","items-center","justify-center","gap-4","mt-4"],["class","text-[11px] text-slate-400 hover:text-violet-600 font-medium px-3 py-1.5 rounded-full border border-slate-100 hover:border-violet-200 hover:bg-violet-50/50 transition-all cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"mt-10","text-xs","text-slate-400","font-mono"],[1,"text-green-600"],[1,"text-[11px]","text-slate-400","hover:text-violet-600","font-medium","px-3","py-1.5","rounded-full","border","border-slate-100","hover:border-violet-200","hover:bg-violet-50/50","transition-all","cursor-pointer",3,"click"],[1,"h-full","w-full","flex","flex-col","bg-white",3,"ngClass"],[1,"flex-1","overflow-hidden","flex","flex-col"],["class","flex-1 flex flex-col h-full",4,"ngIf"],["class","flex-1 flex flex-col h-full bg-slate-50 relative",4,"ngIf"],[1,"flex-1","flex","flex-col","h-full"],[1,"flex-1","overflow-y-auto","p-6","space-y-6","scrollbar-thin","scroll-smooth","relative"],["class","flex flex-col items-center justify-center h-full text-center px-6 animate-fade-in",4,"ngIf"],["class","flex gap-4 group",3,"ngClass",4,"ngFor","ngForOf"],["class","flex gap-3 items-start",4,"ngIf"],["class","px-4 py-2 bg-slate-50 border-t border-slate-100 flex items-center gap-2 overflow-x-auto flex-none",4,"ngIf"],["class","px-4 py-3 border-t border-indigo-100 bg-indigo-50/50 flex-none",4,"ngIf"],[1,"p-4","bg-slate-50","border-t","border-slate-200","flex-none"],[1,"flex","items-center","justify-between","mb-3","px-1"],[1,"flex","items-center","gap-2"],[1,"w-2","h-2","rounded-full","animate-pulse",3,"ngClass"],[1,"text-xs","font-bold","text-slate-500","uppercase","tracking-wide"],[1,"relative","flex","items-end"],["rows","1",1,"w-full","bg-white","text-slate-900","text-sm","rounded-lg","pl-4","pr-12","py-3","border","border-slate-300","focus:border-violet-500","focus:ring-1","focus:ring-violet-500","focus:outline-none","transition-all","placeholder:text-slate-400","shadow-sm","chat-textarea",3,"ngModelChange","keydown","ngModel","placeholder"],["class","absolute right-2 bottom-2 p-1.5 rounded-md bg-violet-600 hover:bg-violet-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm",3,"disabled","click",4,"ngIf"],["class","absolute right-2 bottom-2 p-1.5 rounded-md bg-red-500 hover:bg-red-600 text-white transition-colors shadow-sm","title","Stop processing",3,"click",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center","px-6","animate-fade-in"],[1,"w-16","h-16","rounded-2xl","bg-violet-50","border","border-violet-100","flex","items-center","justify-center","mb-5"],["name","message-square",1,"w-8","h-8","text-violet-400"],[1,"text-lg","font-bold","text-slate-800","mb-1"],[1,"text-sm","text-slate-400","mb-6","max-w-sm"],[1,"flex","flex-wrap","justify-center","gap-2","max-w-lg"],["class","text-xs text-slate-500 hover:text-violet-700 font-medium px-3 py-2 rounded-lg border border-slate-200 hover:border-violet-300 hover:bg-violet-50/50 transition-all cursor-pointer flex items-center gap-1.5",3,"click",4,"ngFor","ngForOf"],[1,"text-[10px]","text-slate-300","mt-6","font-mono"],[1,"text-xs","text-slate-500","hover:text-violet-700","font-medium","px-3","py-2","rounded-lg","border","border-slate-200","hover:border-violet-300","hover:bg-violet-50/50","transition-all","cursor-pointer","flex","items-center","gap-1.5",3,"click"],[1,"w-3.5","h-3.5","text-slate-400",3,"name"],[1,"flex","gap-4","group",3,"ngClass"],[1,"flex-none","w-8","h-8","rounded-full","flex","items-center","justify-center","text-xs","font-bold","shadow-sm","relative",3,"ngClass"],[4,"ngIf"],["class","w-4 h-4",3,"name",4,"ngIf"],[1,"flex","flex-col","gap-2","max-w-[80%]"],["class","text-[10px] font-bold uppercase tracking-wider",3,"ngClass",4,"ngIf"],[1,"rounded-2xl","px-4","py-3","text-sm","leading-relaxed","shadow-sm","relative","group/msg",3,"ngClass"],["class","agent-markdown",3,"data",4,"ngIf"],["class","inline-block w-2 h-4 bg-violet-500 animate-pulse ml-0.5 rounded-sm align-text-bottom",4,"ngIf"],["class","flex items-center justify-between mt-2 pt-1.5",3,"ngClass",4,"ngIf"],["class","bg-violet-50 border border-violet-100 rounded-xl p-4 shadow-sm animate-fade-in w-full",4,"ngIf"],["class","w-full animate-fade-in",3,"result",4,"ngIf"],["class","bg-red-50 border-2 border-red-300 rounded-xl p-4 shadow-sm animate-fade-in w-full",4,"ngIf"],["class","bg-amber-50 border border-amber-100 rounded-xl p-4 shadow-sm animate-fade-in w-full",4,"ngIf"],["class","bg-emerald-50 border border-emerald-200 rounded-xl p-4 shadow-sm animate-fade-in w-full",4,"ngIf"],["class","bg-gradient-to-br from-emerald-50 to-teal-50 border-2 border-emerald-300 rounded-xl p-5 shadow-md animate-fade-in w-full hover:shadow-lg transition-shadow cursor-pointer group",3,"click",4,"ngIf"],[1,"w-4","h-4",3,"name"],[1,"text-[10px]","font-bold","uppercase","tracking-wider",3,"ngClass"],[1,"agent-markdown",3,"data"],[1,"inline-block","w-2","h-4","bg-violet-500","animate-pulse","ml-0.5","rounded-sm","align-text-bottom"],[1,"flex","items-center","justify-between","mt-2","pt-1.5",3,"ngClass"],[1,"text-[9px]","font-mono",3,"ngClass"],["class","opacity-0 group-hover/msg:opacity-100 text-slate-300 hover:text-violet-600 transition-all p-1 rounded","title","Copy response",3,"click",4,"ngIf"],["title","Copy response",1,"opacity-0","group-hover/msg:opacity-100","text-slate-300","hover:text-violet-600","transition-all","p-1","rounded",3,"click"],[1,"w-3.5","h-3.5",3,"name"],[1,"bg-violet-50","border","border-violet-100","rounded-xl","p-4","shadow-sm","animate-fade-in","w-full"],[1,"flex","items-center","gap-2","mb-3"],["name","navigation",1,"w-4","h-4","text-violet-600"],[1,"text-xs","font-bold","text-violet-900"],[1,"flex","items-center","gap-3","p-3","bg-white","rounded-lg","border","border-violet-200"],[1,"w-10","h-10","rounded-xl","flex","items-center","justify-center",3,"ngClass"],[1,"w-5","h-5",3,"name"],[1,"flex-1"],[1,"text-sm","font-bold","text-slate-900"],[1,"text-[10px]","text-slate-500"],["name","check-circle",1,"w-4","h-4","text-green-500"],[1,"w-full","animate-fade-in",3,"result"],[1,"bg-red-50","border-2","border-red-300","rounded-xl","p-4","shadow-sm","animate-fade-in","w-full"],[1,"flex","items-center","gap-3","mb-3"],[1,"p-2","bg-red-100","text-red-700","rounded-lg"],["name","shield-alert",1,"w-5","h-5"],[1,"text-sm","font-bold","text-red-900"],[1,"text-[10px]","text-red-600","font-mono","uppercase"],[1,"text-xs","text-red-800","p-2","bg-white/50","rounded","border","border-red-200"],[1,"bg-amber-50","border","border-amber-100","rounded-xl","p-4","shadow-sm","animate-fade-in","w-full"],[1,"p-2","bg-amber-100","text-amber-700","rounded-lg"],["name","trending-up",1,"w-5","h-5"],[1,"text-sm","font-bold","text-amber-900"],[1,"grid","grid-cols-3","gap-3","text-center"],[1,"text-2xl","font-bold","text-amber-900"],[1,"text-[10px]","text-amber-600","uppercase","font-bold"],[1,"bg-emerald-50","border","border-emerald-200","rounded-xl","p-4","shadow-sm","animate-fade-in","w-full"],[1,"w-8","h-8","rounded-lg","bg-emerald-100","flex","items-center","justify-center"],["name","check-circle",1,"w-4","h-4","text-emerald-600"],[1,"text-sm","font-semibold","text-emerald-800"],[1,"text-xs","text-emerald-600"],[1,"grid","grid-cols-2","gap-2","text-xs"],[1,"bg-white/60","rounded-lg","px-3","py-2"],[1,"text-slate-500"],[1,"font-medium","text-slate-800","truncate"],[1,"font-medium","text-slate-800"],[1,"font-medium","text-emerald-700"],[1,"text-emerald-600","hover:text-emerald-800","font-medium","underline","underline-offset-2",3,"click"],[1,"bg-gradient-to-br","from-emerald-50","to-teal-50","border-2","border-emerald-300","rounded-xl","p-5","shadow-md","animate-fade-in","w-full","hover:shadow-lg","transition-shadow","cursor-pointer","group",3,"click"],[1,"w-10","h-10","rounded-xl","bg-emerald-500","flex","items-center","justify-center","shadow-sm"],["name","file-check",1,"w-5","h-5","text-white"],[1,"text-sm","font-bold","text-emerald-900"],[1,"text-xs","text-emerald-600","font-mono"],[1,"w-8","h-8","rounded-full","bg-emerald-100","flex","items-center","justify-center","group-hover:bg-emerald-200","transition-colors"],["name","arrow-right",1,"w-4","h-4","text-emerald-600","group-hover:translate-x-0.5","transition-transform"],[1,"grid","grid-cols-3","gap-2","text-xs","mb-4"],[1,"bg-white/70","rounded-lg","px-3","py-2"],[1,"text-slate-500","block"],[1,"flex","items-center","justify-center","gap-2","bg-emerald-600","hover:bg-emerald-700","text-white","rounded-lg","py-2.5","px-4","transition-colors","text-sm","font-semibold","shadow-sm"],["name","external-link",1,"w-4","h-4"],[1,"flex","gap-3","items-start"],[1,"w-8","h-8","rounded-full","bg-violet-50","border","border-violet-200","flex","items-center","justify-center","flex-none","mt-0.5"],["name","loader-2",1,"w-4","h-4","text-violet-600","animate-spin"],[1,"flex-1","bg-gradient-to-r","from-violet-50/80","to-indigo-50/60","border","border-violet-100","rounded-xl","px-4","py-3"],[1,"flex","items-center","justify-between","mb-1.5"],[1,"text-xs","font-semibold","text-violet-700"],[1,"text-[10px]","font-mono","text-violet-400","bg-violet-100/60","px-2","py-0.5","rounded-full"],[1,"flex","gap-0.5"],[1,"w-1.5","h-1.5","rounded-full","bg-violet-400","animate-bounce",2,"animation-delay","0ms"],[1,"w-1.5","h-1.5","rounded-full","bg-violet-400","animate-bounce",2,"animation-delay","150ms"],[1,"w-1.5","h-1.5","rounded-full","bg-violet-400","animate-bounce",2,"animation-delay","300ms"],[1,"text-[11px]","text-violet-500","italic"],[1,"px-4","py-2","bg-slate-50","border-t","border-slate-100","flex","items-center","gap-2","overflow-x-auto","flex-none"],[1,"text-[10px]","font-bold","text-slate-400","uppercase","tracking-wider","flex-none"],["class","flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-medium border flex-none",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-1.5","px-2","py-1","rounded-full","text-[10px]","font-medium","border","flex-none",3,"ngClass"],[1,"w-3","h-3",3,"name"],["name","loader-2","class","w-3 h-3 animate-spin",4,"ngIf"],["name","check","class","w-3 h-3",4,"ngIf"],["name","loader-2",1,"w-3","h-3","animate-spin"],["name","check",1,"w-3","h-3"],[1,"px-4","py-3","border-t","border-indigo-100","bg-indigo-50/50","flex-none"],[1,"w-full","py-3","bg-dbs-primary","hover:bg-dbs-primary-hover","text-white","text-sm","font-bold","rounded-xl","shadow-lg","shadow-blue-200","transition-all","flex","items-center","justify-center","gap-2","transform","active:scale-95",3,"click"],["name","file-plus-2",1,"w-4","h-4"],[1,"absolute","right-2","bottom-2","p-1.5","rounded-md","bg-violet-600","hover:bg-violet-500","text-white","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","shadow-sm",3,"click","disabled"],["title","Stop processing",1,"absolute","right-2","bottom-2","p-1.5","rounded-md","bg-red-500","hover:bg-red-600","text-white","transition-colors","shadow-sm",3,"click"],["name","square",1,"w-3.5","h-3.5"],[1,"flex-1","flex","flex-col","h-full","bg-slate-50","relative"],[1,"w-full","bg-white","border-b","border-slate-200","px-6","py-3","flex","items-center","gap-3","overflow-x-auto","scrollbar-hide","flex-none","relative","category-bar"],[1,"flex","items-center","gap-2","text-slate-400","text-xs","font-bold","uppercase","tracking-wider","mr-2","flex-none"],["name","filter",1,"w-3.5","h-3.5"],["class","px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border flex-none",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"flex-1","overflow-y-auto","p-6","md:p-8"],[1,"max-w-5xl","mx-auto","space-y-6"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-lg","font-bold","text-slate-900","flex","items-center","gap-2"],[1,"text-slate-400","font-normal","text-sm"],[1,"relative","w-64"],["name","search",1,"absolute","left-3","top-1/2","-translate-y-1/2","w-4","h-4","text-slate-400"],["type","text","placeholder","Filter templates...",1,"w-full","text-sm","pl-9","pr-3","py-2","rounded-lg","border","border-slate-200","bg-white","focus:border-indigo-500","focus:ring-1","focus:ring-indigo-500","outline-none","shadow-sm",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["class","bg-white border border-slate-200 rounded-xl p-5 hover:shadow-md hover:border-violet-300 transition-all cursor-pointer group flex flex-col h-full",3,"click",4,"ngFor","ngForOf"],["class","w-96 border-l border-slate-200 bg-white flex-none flex flex-col shadow-2xl absolute right-0 top-0 bottom-0 z-30 animate-slide-in",4,"ngIf"],[1,"px-3","py-1.5","rounded-full","text-xs","font-bold","whitespace-nowrap","transition-all","border","flex-none",3,"click","ngClass"],[1,"bg-white","border","border-slate-200","rounded-xl","p-5","hover:shadow-md","hover:border-violet-300","transition-all","cursor-pointer","group","flex","flex-col","h-full",3,"click"],[1,"flex","items-start","justify-between","mb-3"],[1,"p-2","rounded-lg",3,"ngClass"],["name","arrow-right",1,"w-4","h-4","text-slate-300","group-hover:text-violet-500","transition-colors"],[1,"text-sm","font-bold","text-slate-900","mb-1","group-hover:text-violet-700","transition-colors"],[1,"text-xs","text-slate-500","mb-4","line-clamp-2","flex-1"],["class","flex items-center gap-3 text-[10px] font-medium pt-3 border-t border-slate-100",4,"ngIf"],[1,"flex","items-center","gap-3","text-[10px]","font-medium","pt-3","border-t","border-slate-100"],["class","text-slate-600 flex items-center gap-1",4,"ngIf"],[1,"text-slate-600","flex","items-center","gap-1"],["name","clock",1,"w-3","h-3","text-slate-400"],["name","check-circle",1,"w-3","h-3","text-green-500"],[1,"w-96","border-l","border-slate-200","bg-white","flex-none","flex","flex-col","shadow-2xl","absolute","right-0","top-0","bottom-0","z-30","animate-slide-in"],[1,"p-4","border-b","border-slate-200","flex","items-center","justify-between","bg-slate-50"],[1,"text-sm","font-bold","text-slate-900","truncate","pr-4"],[1,"text-slate-400","hover:text-slate-600","hover:bg-slate-200","rounded-full","p-1","transition-colors",3,"click"],["name","x",1,"w-5","h-5"],[1,"p-6","flex-1","overflow-y-auto"],[1,"space-y-6"],[1,"flex","items-start","gap-3"],[1,"p-2","rounded-lg","flex-none",3,"ngClass"],[1,"text-[10px]","font-bold","text-slate-500","uppercase","tracking-widest","block","mb-1"],[1,"text-sm","font-bold","text-slate-900","leading-tight"],[1,"p-3","bg-indigo-50","border","border-indigo-100","rounded-lg","text-xs","text-indigo-800"],[1,"space-y-4","pt-2"],[4,"ngFor","ngForOf"],[1,"p-4","border-t","border-slate-200","bg-slate-50"],["name","sparkles",1,"w-4","h-4"],[1,"block","text-xs","font-semibold","text-slate-700","mb-1.5"],["class","text-red-500",4,"ngIf"],["class","w-full text-sm px-3 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-shadow bg-white hover:bg-slate-50 focus:bg-white",3,"type","placeholder","ngModel","ngModelChange",4,"ngIf"],["rows","3","class","w-full text-sm px-3 py-2 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-shadow bg-white hover:bg-slate-50 focus:bg-white",3,"placeholder","ngModel","ngModelChange",4,"ngIf"],[1,"text-red-500"],[1,"w-full","text-sm","px-3","py-2","rounded-lg","border","border-slate-300","focus:border-indigo-500","focus:ring-1","focus:ring-indigo-500","outline-none","transition-shadow","bg-white","hover:bg-slate-50","focus:bg-white",3,"ngModelChange","type","placeholder","ngModel"],["rows","3",1,"w-full","text-sm","px-3","py-2","rounded-lg","border","border-slate-300","focus:border-indigo-500","focus:ring-1","focus:ring-indigo-500","outline-none","transition-shadow","bg-white","hover:bg-slate-50","focus:bg-white",3,"ngModelChange","placeholder","ngModel"]],template:function(e,l){e&1&&g(0,Vi,89,14,"div",1)(1,Tn,4,5,"div",2),e&2&&(o("ngIf",l.config.showLanding&&l.viewMode==="LANDING"),a(),o("ngIf",l.viewMode==="CHAT"))},dependencies:[P,M,N,F,Ne,L,Me,We,Pe,Le,Ge,Ve,Be,de,ce,pe,me,ue,Te],styles:['[_nghost-%COMP%]{display:block;height:100%}.scrollbar-thin[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.scrollbar-thin[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#e5e7eb;border-radius:3px}.scrollbar-hide[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.scrollbar-hide[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}@keyframes _ngcontent-%COMP%_fade-in{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in .4s cubic-bezier(.16,1,.3,1)}.chat-textarea[_ngcontent-%COMP%]{resize:none;overflow-y:auto;min-height:44px;max-height:120px}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}.category-bar[_ngcontent-%COMP%]:after{content:"";position:absolute;right:0;top:0;bottom:0;width:48px;background:linear-gradient(to right,transparent,white);pointer-events:none;z-index:1}[_nghost-%COMP%]     .agent-markdown p{margin-bottom:.5rem}[_nghost-%COMP%]     .agent-markdown p:last-child{margin-bottom:0}[_nghost-%COMP%]     .agent-markdown strong{font-weight:700}[_nghost-%COMP%]     .agent-markdown ul, [_nghost-%COMP%]     .agent-markdown ol{margin:.5rem 0;padding-left:1.25rem}[_nghost-%COMP%]     .agent-markdown li{margin-bottom:.25rem}']})};export{le as a,ge as b,de as c,ce as d,pe as e,me as f,ue as g,He as h};
