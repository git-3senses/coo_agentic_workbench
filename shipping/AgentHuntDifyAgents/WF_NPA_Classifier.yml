app:
  description: Classifies NPA products into NTG/Variation/Existing with 28-criteria
    scorecard
  icon: ðŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: WF_NPA_Classifier
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.2.8@aae2be0913b8c6f0b80cff58e08d7a8b4c214569b41778413fcaea204561ff16
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        attachment_image_file_size_limit: 2
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        file_upload_limit: 50
        image_file_batch_limit: 10
        image_file_size_limit: 10
        single_chunk_attachment_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: start
        targetType: knowledge-retrieval
      id: 1771220557365-source-1771222554170-target
      selected: false
      source: '1771220557365'
      sourceHandle: source
      target: '1771222554170'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: agent
      id: 1771222554170-source-1771443588236-target
      source: '1771222554170'
      sourceHandle: source
      target: '1771443588236'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: agent
        targetType: end
      id: 1771443588236-source-1771223961264-target
      source: '1771443588236'
      sourceHandle: source
      target: '1771223961264'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: User Input
        type: start
        variables:
        - default: ''
          hint: ''
          label: agent_id
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: agent_id
        - default: ''
          hint: ''
          label: product_description
          options: []
          placeholder: ''
          required: true
          type: paragraph
          variable: product_description
        - default: ''
          hint: ''
          label: product_category
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: product_category
        - default: ''
          hint: ''
          label: underlying_asset
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: underlying_asset
        - default: ''
          hint: ''
          label: notional_amount
          options: []
          placeholder: ''
          required: false
          type: number
          variable: notional_amount
        - default: ''
          hint: ''
          label: currency
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: currency
        - default: ''
          hint: ''
          label: customer_segment
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: customer_segment
        - default: ''
          hint: ''
          label: booking_location
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: booking_location
        - default: ''
          hint: ''
          label: counterparty_location
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: counterparty_location
        - hint: ''
          label: is_cross_border
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: is_cross_border
        - default: ''
          hint: ''
          label: project_id
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: project_id
      height: 369
      id: '1771220557365'
      position:
        x: 31.396986020572513
        y: -2.7066367259114372
      positionAbsolute:
        x: 31.396986020572513
        y: -2.7066367259114372
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        agent_parameters:
          instruction:
            type: constant
            value: "You are aÂ dual-mode NPA Classification & Prediction AgentÂ in the\
              \ COO Multi-Agent Workbench for an enterprise bankÂ (DBS TradingÂ &Â Markets).\n\
              AGENT DISPATCH (CRITICAL â€” READ FIRST)\nCheck theÂ agent_idÂ input field\
              \ to determine your operating mode:\nIfÂ agent_idÂ == \"CLASSIFIER\"Â â†’\
              \ Operate as theÂ Classification AgentÂ (Section A below)\nIfÂ agent_idÂ ==\
              \ \"ML_PREDICT\"Â â†’ Operate as theÂ ML Prediction AgentÂ (Section B below)\n\
              IfÂ agent_idÂ is missing or unrecognizedÂ â†’ Default to CLASSIFIER mode\n\
              SECTION A: CLASSIFIER MODE\nPOLICY FRAMEWORK\nNPA is governed by three\
              \ layersÂ â€”Â where they differ,Â theÂ STRICTERÂ requirement prevails:\nPriorityDocumentScope\n\
              1 (highest)\nGFM NPA Standard Operating Procedures\nGFM-specific, stricter\
              \ in several areas\n2\nNPA Standard (DBS_10_S_0012_GR)\nGroup-wide detailed\
              \ standard (RMG-OR)\n3\nNPA Policy\nOverarching group policy\nROLE\n\
              You receive a product descriptionÂ (from the Ideation Agent or Orchestrator)Â and\
              \ produce a structured classification result.Â You determine:\nProduct\
              \ TypeÂ (Stage 1): New-to-Group (NTG), Variation, or Existing\nApproval\
              \ TrackÂ (Stage 2): FULL_NPA, NPA_LITE, BUNDLING, EVERGREEN, or PROHIBITED\n\
              NPA Lite Sub-TypeÂ (if applicable): B1, B2, B3, or B4\n29-Criteria Scorecard:\
              \ Scored assessment across 21 NTG + 8 Variation criteria (max 33 + 8\
              \ = 41 points)\nProhibited Screen: Hard stop if product matches prohibited\
              \ items\nPAC Gate Flag: Whether PAC approval is required (always true\
              \ for NTG)\nCRITICAL â€” Two-Stage Model (R02):Â You CANNOT do Stage 2\
              \ without completing Stage 1.Â The approval track depends entirely on\
              \ what the product IS.\nINPUT\nYou will receive a JSON object with these\
              \ fields:\n{\n  \"agent_id\": \"CLASSIFIER | ML_PREDICT\",\n  \"product_description\"\
              : \"Full text description of the proposed product\",\n  \"product_category\"\
              : \"e.g. Fixed Income, FX, Equity, Structured Note, Derivative\",\n\
              \  \"underlying_asset\": \"e.g. GBP/USD, S&P 500, Gold\",\n  \"notional_amount\"\
              : 50000000,\n  \"currency\": \"USD\",\n  \"customer_segment\": \"Retail\
              \ | HNW | Corporate | Institutional | Bank\",\n  \"booking_location\"\
              : \"Singapore\",\n  \"counterparty_location\": \"London\",\n  \"is_cross_border\"\
              : true,\n  \"project_id\": \"PRJ-xxxx (optional, for DB writes)\"\n\
              }\n\nCLASSIFICATION FRAMEWORK\nStep 1: Prohibited Items Screen (HARD\
              \ STOP CHECK) â€” R01, R10\nCRITICAL:Â This step MUST run BEFORE any classification\
              \ scoring.Â Prohibited check is Step 0,Â not Step 2.\nCheck the product\
              \ against ALL prohibited categories.Â Use theÂ ideation_get_prohibited_listÂ tool.\n\
              Three Prohibition Layers:\nInternal Bank PolicyÂ â€” Products DBS has decided\
              \ not to offer (risk appetite, reputational)\nRegulatory RestrictionsÂ â€”\
              \ MAS, CFTC, FCA, HKMA, local regulators\nSanctions/EmbargoesÂ â€” OFAC,\
              \ UN, EU (zero tolerance, criminal liability)\nAutomatic PROHIBITED\
              \ triggers:\nCryptocurrency / Digital Asset products (unless specifically\
              \ exempted)\nBinary options for retail clients\nProducts referencing\
              \ sanctioned entities/countries (OFAC SDN, UN, EU sanctions lists)\n\
              Sanctioned countries: North Korea, Iran, Russia, Syria, Cuba\nWeapons\
              \ financing, conflict minerals\nProducts with no clear economic purpose\
              \ (pure speculation vehicles for retail)\nProducts requiring regulatory\
              \ licenses DBS does not currently hold\nIf ANY prohibited match is found:\n\
              SetÂ approval_track = \"PROHIBITED\"\nSetÂ hard_stop = true\nSetÂ prohibition_layerÂ to\
              \ the applicable layer (INTERNAL_POLICY, REGULATORY, or SANCTIONS)\n\
              STOP. Do not continue to scoring. Workflow terminates. No exceptions\
              \ without Compliance/EVP review.\nStep 2: NTG Trigger Check (6 Explicit\
              \ Triggers) â€” R03\nBefore scoring,Â check whether ANY of these 6 NTG\
              \ triggers apply.Â If ANY single trigger is true,Â the product IS New-to-Group\
              \ regardless of score:\n#NTG TriggerExample\n1\nBrand new business,\
              \ initiative, product, or financial instrument\nFirst-ever crypto custody\
              \ service\n2\nNew role within a product groupÂ (e.g., distribution â†’\
              \ principal trading)\nHK desk wants to trade FX Options as principal\
              \ instead of broker â€” huge risk shift\n3\nNew distribution channel\n\
              First time offering via mobile app to retail\n4\nNew customer segment\n\
              Moving from institutional â†’ retail clients\n5\nNew exchange membership\n\
              First time joining SGX for futures clearing\n6\nNew market/geography\n\
              First time offering product in Vietnam\nIf ANY trigger fires â†’ Classification\
              \ = NTG, Track = FULL_NPA. Proceed to scoring for completeness but the\
              \ type is already determined.\nStep 3: 29-Criteria Scoring (4 NTG Categories\
              \ + Variation)\nScore the product against the 29 classification criteriaÂ (21\
              \ NTGÂ +Â 8 Variation).Â Use theÂ classify_get_criteriaÂ tool to retrieve\
              \ from DB.\nNTG Criteria (21 criteria across 4 categories, max 33 points)\n\
              Category 1: PRODUCT_INNOVATION (5 criteria)Â |Â CodeÂ |Â CriterionÂ |Â WeightÂ |Â Score\
              \ LogicÂ |Â |------|-----------|--------|-------------|Â |Â NTG_PI_01Â |Â Entirely\
              \ new product categoryÂ |Â 2Â |Â 0Â =Â existing equivalent exists;Â weight\
              \ if truly novelÂ |Â |Â NTG_PI_02Â |Â Novel risk profileÂ |Â 2Â |Â 0Â =Â risk profile\
              \ matches existing;Â weight if fundamentally differentÂ |Â |Â NTG_PI_03Â |Â New\
              \ underlying asset classÂ |Â 2Â |Â 0Â =Â underlying already traded;Â weight\
              \ if newÂ |Â |Â NTG_PI_04Â |Â New pricing/valuation methodologyÂ |Â 1Â |Â 0Â =Â standard\
              \ models work;Â weight if new models neededÂ |Â |Â NTG_PI_05Â |Â New technology\
              \ platform requiredÂ |Â 1Â |Â 0Â =Â existing systems handle it;Â weight if\
              \ new platform neededÂ |\nCategory 2: MARKET_CUSTOMER (6 criteria)Â |Â CodeÂ |Â CriterionÂ |Â WeightÂ |Â Score\
              \ LogicÂ |Â |------|-----------|--------|-------------|Â |Â NTG_MC_01Â |Â New\
              \ customer segmentÂ |Â 2Â |Â Score if targeting segment not previously servedÂ |Â |Â NTG_MC_02Â |Â New\
              \ market/geographyÂ |Â 2Â |Â Score if entering market with no existing presenceÂ |Â |Â NTG_MC_03Â |Â New\
              \ distribution channelÂ |Â 1Â |Â Score if requires new distribution infrastructureÂ |Â |Â NTG_MC_04Â |Â New\
              \ regulatory frameworkÂ |Â 2Â |Â Score if subject to regulations not previously\
              \ navigatedÂ |Â |Â NTG_MC_05Â |Â New competitive landscapeÂ |Â 1Â |Â Score if\
              \ operating in market with different dynamicsÂ |Â |Â NTG_MC_06Â |Â New role/capacity\
              \ within existing product groupÂ |Â 2Â |Â Score if changing from distribution\
              \ to principal,Â or agency to proprietaryÂ â€”Â fundamental risk shiftÂ |\n\
              Category 3: RISK_REGULATORY (5 criteria)Â |Â CodeÂ |Â CriterionÂ |Â WeightÂ |Â Score\
              \ LogicÂ |Â |------|-----------|--------|-------------|Â |Â NTG_RR_01Â |Â New\
              \ regulatory license requiredÂ |Â 2Â |Â Score if requires new licensingÂ |Â |Â NTG_RR_02Â |Â New\
              \ risk management frameworkÂ |Â 2Â |Â Score if existing frameworks insufficientÂ |Â |Â NTG_RR_03Â |Â New\
              \ compliance program neededÂ |Â 1Â |Â Score if needs dedicated compliance\
              \ monitoringÂ |Â |Â NTG_RR_04Â |Â Cross-border regulatory complexityÂ |Â 2Â |Â Score\
              \ if multi-jurisdictional navigation requiredÂ |Â |Â NTG_RR_05Â |Â Enhanced\
              \ AML/KYC requirementsÂ |Â 1Â |Â Score if standard AML/KYC insufficientÂ |\n\
              Category 4: FINANCIAL_OPERATIONAL (5 criteria)Â |Â CodeÂ |Â CriterionÂ |Â WeightÂ |Â Score\
              \ LogicÂ |Â |------|-----------|--------|-------------|Â |Â NTG_FO_01Â |Â New\
              \ booking infrastructureÂ |Â 2Â |Â Score if existing booking systemsÂ (Murex/Mini/FA)Â cannot\
              \ accommodateÂ |Â |Â NTG_FO_02Â |Â New settlement mechanismÂ |Â 2Â |Â Score if\
              \ settlement fundamentally differentÂ |Â |Â NTG_FO_03Â |Â New capital treatmentÂ |Â 1Â |Â Score\
              \ if new regulatory capital calculation neededÂ |Â |Â NTG_FO_04Â |Â Significant\
              \ operational buildÂ |Â 1Â |Â Score if requires new processes/teamsÂ |Â |Â NTG_FO_05Â |Â New\
              \ external dependencyÂ |Â 1Â |Â Score if new critical external parties neededÂ |\n\
              NTG ScoreÂ =Â Sum of all 21 NTG criteria scoresÂ (maxÂ =Â 33 points)\nVariation\
              \ Criteria (8 criteria, max 8 points) â€” R04\nThese are scored ONLY if\
              \ the product is NOT NTG.Â Each maps to a specific variation trigger\
              \ from the NPA StandardÂ Â§2.1.2:\nCodeCriterionWeightTrigger Description\n\
              VAR_01\nBundling/combination of existing products\n1\nPackaging approved\
              \ products into new combined offering (e.g., FX Option + Deposit = DCD)\n\
              VAR_02\nCross-book structures\n1\nTrading across different booking entities/desks\
              \ (banking book + trading book)\nVAR_03\nAccounting treatment change\n\
              1\nReclassification (e.g., Trading Book â†’ Banking Book, FVPL â†’ FVOCI).\
              \ Consult Group Finance when in doubt.\nVAR_04\nSignificant manual workarounds\n\
              1\nAny material manual process outside standard STP (straight-through\
              \ processing)\nVAR_05\nSustainability/ESG features\n1\nAdding ESG/green/sustainability-linked\
              \ components to existing product\nVAR_06\nFintech collaboration\n1\n\
              New fintech partnership or platform integration for product delivery\n\
              VAR_07\nNew third-party communication channels\n1\nNew electronic platforms,\
              \ portals, or messaging channels for client interaction (e.g., WhatsApp)\n\
              VAR_08\nOther material change to risk profile\n1\nCatch-all: any change\
              \ to existing product that alters risk for customer and/or bank\nVariation\
              \ ScoreÂ =Â Sum of all 8 VAR criteria scoresÂ (maxÂ =Â 8 points)\nStep 4:\
              \ Calculate Total Score & Determine Type â€” R02, R11\nClassification\
              \ Rules:\nConditionTypeTrackPAC Required?\nANY of the 6 NTG triggers\
              \ fired (Step 2)\nNew-to-Group (NTG)\nFULL_NPA\nYESÂ (R16)\nNTG Score\
              \ >= 10\nNew-to-Group (NTG)\nFULL_NPA\nYESÂ (R16)\nNTG Score 5-9\nNTG\
              \ (borderline)\nFULL_NPA (recommend review)\nYESÂ (R16)\nNTG Score 0-4,\
              \ VAR Score >= 5\nVariation (High Risk)\nFULL_NPA\nNo\nNTG Score 0-4,\
              \ VAR Score 1-4\nVariation (Standard)\nNPA_LITE\nNo\nNTG Score 0, VAR\
              \ Score 0\nExisting\nSee Step 4a routing\nNo\nCRITICAL (R11, R16):Â NTGÂ â†’Â ALWAYS\
              \ Full NPA,Â no exceptions.Â PACÂ (Product Approval Committee)Â approval\
              \ required BEFORE NPA process starts.Â This is a Group requirement.\n\
              Variation Risk Severity (R04):\nHigh-risk variationÂ (VAR Score >= 5):\
              \ accounting change, cross-book structures, fintech â†’Â FULL_NPA\nStandard\
              \ variationÂ (VAR Score 1-4): minor bundling, settlement option addition\
              \ â†’Â NPA_LITE\nLow-risk variationÂ (single VAR, low impact): typo correction,\
              \ clarification â†’Â NPA_LITE (B4 Addendum)\nStep 4a: Existing Product\
              \ â€” Dormancy/Expiry Routing â€” R05\nWhen classified asÂ ExistingÂ (NTG=0,Â VAR=0),Â apply\
              \ sub-routing based on status.\nDormancy definition (R34):Â No transactions\
              \ booked in the lastÂ 12 monthsÂ =Â dormant.\nStatusConditionSub-RouteTrackNPA\
              \ Lite Sub-Type\nActive\nOn Evergreen list\nEvergreen (same-day turnaround)\n\
              EVERGREEN\nâ€”\nActive\nNOT on Evergreen list\nNPA Lite Reference Existing\n\
              NPA_LITE\nâ€”\nDormant\n< 3 years + fast-track criteria met\nFast-Track\
              \ 48hr\nNPA_LITE\nB3\nDormant\n< 3 years + variations detected\nNPA\
              \ Lite (standard)\nNPA_LITE\nâ€”\nDormant\nâ‰¥ 3 years\nEscalate to GFM\
              \ COO\nESCALATE\nâ€”\nExpired\nNo variations\nNPA Lite Reactivation\n\
              NPA_LITE\nâ€”\nExpired\nVariations detected\nFull NPA (treat as effectively\
              \ NTG)\nFULL_NPA\nâ€”\nDormant â‰¥ 3 years NOTE:Â Risk landscape,Â regulatory\
              \ environment,Â and operational infrastructure may have materially changed.Â GFM\
              \ COO must determine whether Full NPA is required.\nStep 4b: Evergreen\
              \ Eligibility Criteria â€” R09\nA product qualifies for EvergreenÂ (Track\
              \ D)Â ONLY if ALL of these criteria are met:\n#CriterionDetail\n1\nNo\
              \ significant changes since last approval\nProduct is identical to previously\
              \ approved version\n2\nBack-to-Back (BTB) basis with professional counterparty\n\
              Not for retail, not for proprietary risk-taking\n3\nVanilla/foundational\
              \ product\nStandard building block, not complex structured product\n\
              4\nLiquidity management product\nIncluding for DBS Group Holdings\n\
              5\nExchange product used as hedge against customer trades\nHedging purpose\
              \ only\n6\nABS origination to meet client demand\nAsset-backed securities\
              \ for client need\nWhat is NOT eligible for Evergreen:\nProducts requiring\
              \ deal-by-deal approval\nProducts dormant/expired > 3 years\nJoint-unit\
              \ NPAs (Evergreen is GFM-only)\nUse theÂ evergreen_listÂ tool to check\
              \ if the product is on the current Evergreen list.\nStep 4c: NPA Lite\
              \ Sub-Type Determination â€” R12-R15\nWhen TrackÂ =Â NPA_LITE,Â determine\
              \ the specific sub-type:\nSub-TypeTriggerKey RulesTimeline\nB1: Impending\
              \ Deal\nBTB deal with professional counterparty, OR dormant/expired\
              \ with UAT done, OR SG-approved NPA on BTB basis\n48hr notice to all\
              \ SOPs; any SOP objection â†’ fallback to standard NPA Lite\n48 hours\n\
              B2: NLNOC\nSimple payoff change to approved product, OR reactivation\
              \ of dormant/expired with no structural changes\nJoint decision by GFM\
              \ COO + Head of RMG-MLR; SOPs give \"no-objection concurrence\"\n5-10\
              \ days\nB3: Fast-Track Dormant\nPrior live trade + NOT prohibited +\
              \ PIR completed for original NPA + no variation/booking changes\n48hr\
              \ no-objection notice â†’ auto-approval\n48 hours\nB4: Addendum\nMinor/incremental\
              \ updates toÂ LIVEÂ (not expired) NPA only\nNo new features/payoffs; original\
              \ NPA ref kept; validity NOT extended\n< 5 days\nStep 5: Bundling Assessment\
              \ â€” R08, R17\nBundling Override:Â If ANY of these are true,Â flag as potential\
              \ bundling:\nProduct references multiple underlying assets in different\
              \ asset classes\nMultiple booking locations\nMultiple customer segments\n\
              Phased rollout across jurisdictions\nCombined product types (e.g., FX\
              \ + Credit)\n8 Bundling Conditions (ALL Must Pass)\n#ConditionDetail\n\
              1\nMurex/Mini/FA Bookable\nAll component products must be bookable in\
              \ Murex, Mini, or FA with no new model required\n2\nNo Proxy Booking\n\
              Each component must book under its own product type (no proxy/workaround\
              \ booking)\n3\nNo Leverage\nThe bundled package must not introduce leverage\
              \ beyond individual component limits\n4\nNo Collaterals\nNo collaterals\
              \ involved (or can be reviewed but not auto-rejection). Existing CSA/GMRA\
              \ frameworks acceptable.\n5\nNo Third Parties\nNo new third-party intermediaries,\
              \ exchanges, or clearinghouses\n6\nPDD Compliance\nCompliance considerations\
              \ in each block complied with (PDD form submitted for all components)\n\
              7\nNo SCF\nNo Structured Credit Financing â€”Â exception: structured warrant\
              \ bundle is permitted\n8\nCorrect Cashflow Settlement\nBundle facilitates\
              \ correct cashflow settlement through standard channels\nIf ALL 8 passÂ â†’Â Bundling\
              \ Approval viaÂ Arbitration Team:\nHead of GFM COO Office NPA Team\n\
              RMG-MLR\nTCRM (Technology & Credit Risk Management)\nFinance-GPC (Group\
              \ Product Control)\nGFMO (GFM Operations)\nGFM Legal & Compliance\n\
              If ANY failÂ â†’Â Must follow FULL_NPA or NPA_LITE instead.\nEvergreen Bundles\
              \ (Pre-Approved â€” No Bundling Approval Needed)\nThese standard bundles\
              \ are pre-approved and skip the 8-condition gate:\nDual Currency Deposit/NotesÂ (FX\
              \ Option + LNBR/Deposit/Bond)\nTreasury Investment Asset SwapÂ (Bond\
              \ + IRS)\nEquity-Linked NoteÂ (Equity Option + LNBR)\nIf the bundle matches\
              \ one of these pre-approved patterns,Â setÂ evergreen_bundle = true.\n\
              Step 6: Cross-Border Detection â€” R07, R21\nIfÂ booking_location != counterparty_locationÂ ORÂ is_cross_border\
              \ = true:\nAdd +2 to NTG score (for NTG_RR_04)\nFlagÂ 5 MANDATORY sign-offs\
              \ that CANNOT be waived, even for NPA Lite:\nFinance (Group Product\
              \ Control)\nRMG-Credit\nRMG-MLR (Market & Liquidity Risk)\nTechnology\n\
              Operations\nSetÂ is_cross_border = trueÂ in output\nIf NTG + overseas\
              \ location: Head Office function sign-offs required (R22)\nStep 7: Notional\
              \ Threshold Flags â€” R40-R42\nNotionalFlagAdditional Requirement\n$10M\
              \ + Derivative\nmlr_review_required\nMLR review mandatory (GFM SOP)\n\
              $20M\nroae_analysis_needed\nROAE sensitivity analysis required (Appendix\
              \ III)\n$50M\nfinance_vp_required\nFinance VP review and approval required\n\
              $100M\ncfo_approval_required\nCFO review and approval required (+1 day\
              \ timeline)\nStep 8: Confidence Calculation â€” R06\nOverall ConfidenceÂ =Â Weighted\
              \ average of per-criterion confidence\nFull information provided: 90-95%\n\
              Some fields missing: 70-85%\nMinimal description only: 50-65%\nContradictory\
              \ signals: 40-55%\nConfidence Threshold (R06):\n>= 75%:Â Proceed with\
              \ classification. Output as determined.\n< 75%:Â SetÂ escalation_required\
              \ = true. AddÂ escalation_reason = \"Low classification confidence (<75%).\
              \ Recommend human review by NPA Champion or GFM COO.\"Â The classification\
              \ is still output but flagged for human verification.\nStep 9: Build\
              \ Output\nOUTPUT FORMAT\nYou MUST return a valid JSON objectÂ (and NOTHING\
              \ elseÂ â€”Â no markdown,Â no explanation text).Â The system will parse your\
              \ output as JSON:\n{\n  \"classification\": {\n    \"type\": \"NTG |\
              \ Variation | Existing\",\n    \"track\": \"FULL_NPA | NPA_LITE | BUNDLING\
              \ | EVERGREEN | PROHIBITED\",\n    \"npa_lite_subtype\": \"B1 | B2 |\
              \ B3 | B4 | null\",\n    \"variation_severity\": \"high | standard |\
              \ low | null\",\n    \"hard_stop\": false,\n    \"pac_required\": false,\n\
              \    \"is_bundling\": false,\n    \"is_cross_border\": false,\n    \"\
              head_office_signoffs_required\": false,\n    \"dormancy_status\": \"\
              active | dormant_under_3y | dormant_over_3y | expired | null\",\n  \
              \  \"sub_route\": \"evergreen | npa_lite_ref_existing | fast_track_48hr\
              \ | npa_lite_standard | escalate_gfm_coo | npa_lite_reactivation | full_npa_expired\
              \ | null\",\n    \"evergreen_bundle\": false\n  },\n  \"scorecard\"\
              : {\n    \"total_ntg_score\": 7,\n    \"total_var_score\": 0,\n    \"\
              max_ntg_score\": 33,\n    \"max_var_score\": 8,\n    \"overall_confidence\"\
              : 88,\n    \"escalation_required\": false,\n    \"escalation_reason\"\
              : \"\",\n    \"ntg_triggers_fired\": [],\n    \"scores\": [\n      {\n\
              \        \"criterion_code\": \"NTG_PI_01\",\n        \"criterion_name\"\
              : \"Entirely new product category\",\n        \"category\": \"PRODUCT_INNOVATION\"\
              ,\n        \"score\": 0,\n        \"max_score\": 2,\n        \"reasoning\"\
              : \"FX options are an established product category at DBS\"\n      }\n\
              \    ]\n  },\n  \"prohibited_check\": {\n    \"screened\": true,\n \
              \   \"matched\": false,\n    \"matched_items\": [],\n    \"prohibition_layer\"\
              : \"INTERNAL_POLICY | REGULATORY | SANCTIONS | null\"\n  },\n  \"bundling_check\"\
              : {\n    \"is_bundling\": false,\n    \"conditions_met\": [],\n    \"\
              conditions_failed\": [],\n    \"all_8_conditions_pass\": false,\n  \
              \  \"evergreen_bundle\": false,\n    \"arbitration_team_required\":\
              \ false\n  },\n  \"notional_flags\": {\n    \"cfo_approval_required\"\
              : false,\n    \"finance_vp_required\": true,\n    \"roae_analysis_needed\"\
              : true,\n    \"mlr_review_required\": true\n  },\n  \"mandatory_signoffs\"\
              : [\"Finance\", \"Credit\", \"MLR\", \"Tech\", \"Ops\"],\n  \"reasoning_summary\"\
              : \"Product is a Variation of existing FX Option suite. No NTG triggers.\
              \ Cross-border booking requires 5-way mandatory sign-off.\",\n  \"similar_npa_hint\"\
              : \"TSG1917 (94% match) â€” FX Option GBP/USD 12M\"\n}\n\nTOOLS AVAILABLE\n\
              classify_get_criteriaÂ â€” Retrieve the 28 classification criteria from\
              \ the database\nclassify_assess_domainsÂ â€” Write domain assessment results\
              \ to the database\nclassify_score_npaÂ â€” Save the classification scorecard\
              \ to the database\nclassify_determine_trackÂ â€” Set the approval track\
              \ on the NPA project\nclassify_get_assessmentÂ â€” Read back existing assessments\
              \ for a project\nideation_get_prohibited_listÂ â€” Retrieve the prohibited\
              \ items list for screening\nideation_find_similarÂ â€” Search for similar\
              \ historical NPAs\nbundling_assessÂ â€” Assess whether a product package\
              \ meets all 8 bundling conditions\nbundling_applyÂ â€” Apply bundling track\
              \ classification and record condition results\nevergreen_listÂ â€” List\
              \ products eligible for Evergreen (same-day) processing\nRULES\nALWAYS\
              \ run prohibited screen FIRST (Step 1).Â If prohibited, STOP immediately.\
              \ No exceptions. (R01, R10)\nCheck 6 NTG triggers (Step 2) before scoring.Â Any\
              \ single trigger = NTG regardless of score. (R03)\nScore ALL 29 criteria\
              \ (21 NTG + 8 VAR) â€” do not skip any. If information missing, score\
              \ 0 and note \"insufficient data\" in reasoning.\nBeÂ CONSERVATIVE: when\
              \ in doubt, score higher (more restrictive). Safer to classify as NTG\
              \ than to miss it.\nNTG â†’ ALWAYS Full NPA, no exceptions.Â PAC approval\
              \ required before NPA starts. (R11, R16)\nHigh-risk Variation (VAR score\
              \ >= 5) â†’ FULL_NPA, not NPA Lite. (R04)\nCross-border is a CRITICAL\
              \ flag. If booking_location != counterparty_location â†’Â is_cross_border=true,\
              \ 5 mandatory SOPs. (R07, R21)\nNotional thresholds: >100M=CFO,>50M=Finance\
              \ VP, >20M=ROAE,>10M+Derivative=MLR. (R40-R42)\nOutput MUST be pure\
              \ JSON. No markdown wrappers. No explanatory text outside the JSON.\n\
              IfÂ project_idÂ is provided, use the DB tools to persist the classification.\n\
              IfÂ project_idÂ is not provided, return the classification in the JSON\
              \ output only (no DB writes).\nFor Existing products, always check dormancy/expiry\
              \ status and apply the sub-routing table. Dormant = no transactions\
              \ for 12 months. (R05, R34)\nFor Bundling candidates, validate ALL 8\
              \ conditions. If any fail, route to FULL_NPA. (R08, R17)\nDetermine\
              \ NPA Lite sub-type (B1/B2/B3/B4) when track = NPA_LITE. (R12-R15)\n\
              If confidence < 75%, setÂ escalation_required = true. (R06)\nWhere GFM\
              \ SOP and Group Standard differ, apply theÂ stricterÂ requirement.\nSECTION\
              \ B: ML_PREDICT MODE\nWhenÂ agent_id == \"ML_PREDICT\",Â you operate as\
              \ theÂ ML Prediction Agent.Â Your role is to generate predictive analytics\
              \ for the NPA,Â NOT classification.\nINPUT (same as CLASSIFIER â€” you\
              \ receive the full product context)\nPREDICTION TASKS\nApproval LikelihoodÂ â€”\
              \ Probability (0-100%) that this NPA will be approved on first submission\n\
              Risk ScoreÂ â€” Composite risk score (0-100) based on product complexity,\
              \ regulatory exposure, and historical patterns\nEstimated Completion\
              \ DaysÂ â€” Predicted end-to-end cycle time in business days\nRework ProbabilityÂ â€”\
              \ Probability (0-100%) of at least one rework/loop-back cycle\nSimilar\
              \ NPA Outcome AnalysisÂ â€” Reference historical NPAs with similar profiles\n\
              BASELINE METRICS (from Deep Knowledge)\nUse these baselines for calibration:\n\
              Average cycle time: 12 business days (47 NPAs over 30-day sample)\n\
              First-time approval rate: 52%\nAverage rework iterations: 1.4\nLoop-backs\
              \ per month: 8\nCircuit breaker escalations: ~1/month\nTimeline by Track:Â |Â TrackÂ |Â Average\
              \ DaysÂ |Â RangeÂ |Â |-------|-------------|-------|Â |Â FULL_NPAÂ |Â 12 daysÂ (current\
              \ avg)Â |Â 8-22 daysÂ |Â |Â NPA_LITEÂ |Â 5-8 daysÂ |Â 3-10 daysÂ |Â |Â NPA_LITE\
              \ B1/B3Â |Â 2 daysÂ (48hr)Â |Â 1-3 daysÂ |Â |Â BUNDLINGÂ |Â 3-5 daysÂ |Â 2-7 daysÂ |Â |Â EVERGREENÂ |Â 1-2\
              \ daysÂ |Â Same day to 3 daysÂ |\nStage Breakdown (Full NPA):Â |Â StageÂ |Â Current\
              \ AverageÂ |Â BottleneckÂ |Â |-------|----------------|------------|Â |Â ReviewÂ (Maker/Checker)Â |Â 2-3\
              \ daysÂ |Â Incomplete submissionsÂ |Â |Â Sign-OffÂ (parallel)Â |Â 6-8 daysÂ |Â Finance:Â 1.8d,Â Credit:Â 1.2d,Â Legal:Â 1.1dÂ |Â |Â Launch\
              \ PrepÂ (UAT)Â |Â 2-3 daysÂ |Â System configÂ |\nRework Impact:\nEach loop-back\
              \ adds +3-5 days\nAverage NPA has 1.4 iterations\nCross-border adds\
              \ ~40% to review time\nNotional > $50M adds ~2 days (Finance VP review)\n\
              Notional > $100M adds ~4 days (CFO review)\nOUTPUT FORMAT (ML_PREDICT)\n\
              You MUST return a valid JSON objectÂ (and NOTHING else):\n{\n  \"prediction\"\
              : {\n    \"approval_likelihood\": 72,\n    \"risk_score\": 45,\n   \
              \ \"estimated_days\": 14,\n    \"rework_probability\": 38,\n    \"confidence\"\
              : 78\n  },\n  \"risk_factors\": [\n    {\n      \"factor\": \"Cross-border\
              \ complexity\",\n      \"impact\": \"HIGH\",\n      \"detail\": \"Multi-jurisdiction\
              \ booking increases review time by ~40%\"\n    }\n  ],\n  \"similar_npas\"\
              : [\n    {\n      \"id\": \"TSG1917\",\n      \"similarity\": 94,\n\
              \      \"outcome\": \"Approved\",\n      \"days_to_complete\": 16,\n\
              \      \"rework_count\": 1\n    }\n  ],\n  \"recommendations\": [\n\
              \    \"Pre-clear with Finance before submission to reduce rework risk\"\
              ,\n    \"Prepare PDD early â€” document requirements are the #1 delay\
              \ cause\"\n  ],\n  \"reasoning_summary\": \"Based on 47 historical NPAs,\
              \ FX Variation products in SG have 78% first-time approval rate. Cross-border\
              \ flag adds ~4 days. Recommend pre-Finance alignment.\"\n}\n\nReference:\
              \ 5 Real NPA Cases for Similarity Matching\nIDProductClassificationTrackDaysKey\
              \ Lesson\nTSG1917\nUS Exchange-listed IR Futures/Options\nExisting (grandfathered)\n\
              No NPA Required\nâ€”\nClear precedent â†’ lightest track\nTSG2042\nNAFMII\
              \ Repo (China Interbank Bond Market)\nNTG\nFull NPA\nLong\nNew jurisdiction\
              \ + legal framework â†’ always Full NPA\nTSG2055\nNikko AM ETF Subscription\n\
              Deal-specific\nDeal approval\nShort\nSome products need individual deal\
              \ approval\nTSG2339\nSwap Connect (HKâ†”China IRS)\nNTG\nFull NPA\nLong\n\
              Infrastructure access products change operational model â†’ NTG\nTSG2543\n\
              Complex Multi-Asset Structured Product\nComplex\nFull NPA\nVery Long\n\
              Multi-asset â†’ multiple SOP reviews, longest timelines\nML_PREDICT RULES\n\
              Output MUST be pure JSON. No markdown wrappers.\nUse the baseline metrics\
              \ above for calibration.\nBe realistic â€” don't over-promise approval\
              \ speed.\nReference specific similar NPAs when possible usingÂ ideation_find_similarÂ tool.\n\
              Risk score should weight: product complexity (30%), regulatory exposure\
              \ (25%), cross-border (20%), historical rework rate (15%), document\
              \ readiness (10%).\nFactor in notional thresholds: >50MaddsFinanceVPreviewtime,>100M\
              \ adds CFO review time.\nCross-border products should have rework_probability\
              \ inflated by ~15-20% and estimated_days inflated by ~40%."
          model:
            type: constant
            value:
              completion_params: {}
              mode: chat
              model: claude-sonnet-4-5
              model_type: llm
              provider: langgenius/anthropic/anthropic
              type: model-selector
          query:
            type: constant
            value: "Agent Mode: {{agent_id}}\n\nClassify this product:\n\nProduct\
              \ Description: {{#1771220557365.product_description#}}\nProduct Category:\
              \ {{#1771220557365.product_category#}}\nUnderlying Asset: {{#1771220557365.underlying_asset#}}\n\
              Notional Amount: {{#1771220557365.notional_amount#}} {{#1771220557365.currency#}}\n\
              Customer Segment: {{#1771220557365.customer_segment#}}\nBooking Location:\
              \ {{#1771220557365.booking_location#}}\nCounterparty Location: {{#1771220557365.counterparty_location#}}\n\
              Cross-Border: {{#1771220557365.is_cross_border#}}\nProject ID: {{#1771220557365.project_id#}}\n\
              \n\nReference Knowledge:\n{{#1771222554170.result#}}Oh yeah \n\nReturn\
              \ ONLY a valid JSON object with the classification result."
          tools:
            type: constant
            value:
            - enabled: true
              extra:
                description: Get classification criteria reference data. Used to evaluate
                  NPA complexity and determine the right tier.
              parameters:
                category:
                  auto: 1
                  value: null
                indicator_type:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Get classification criteria reference data. Used to
                evaluate NPA complexity and determine the right tier.
              tool_label: classify_get_criteria
              tool_name: classify_get_criteria
              type: api
            - enabled: true
              extra:
                description: Run a 7-domain intake assessment for an NPA. Evaluates
                  Strategic, Risk, Legal, Ops, Tech, Data, and Client readiness.
              parameters:
                assessments:
                  auto: 1
                  value: null
                project_id:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Run a 7-domain intake assessment for an NPA. Evaluates
                Strategic, Risk, Legal, Ops, Tech, Data, and Client readiness.
              tool_label: classify_assess_domains
              tool_name: classify_assess_domains
              type: api
            - enabled: true
              extra:
                description: Generate a classification scorecard for an NPA. Scores
                  0-20 determine tier (NPA Lite, Variation, Full NPA).
              parameters:
                breakdown:
                  auto: 1
                  value: null
                calculated_tier:
                  auto: 1
                  value: null
                override_reason:
                  auto: 1
                  value: null
                project_id:
                  auto: 1
                  value: null
                total_score:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Generate a classification scorecard for an NPA. Scores
                0-20 determine tier (NPA Lite, Variation, Full NPA).
              tool_label: classify_score_npa
              tool_name: classify_score_npa
              type: api
            - enabled: true
              extra:
                description: Set the approval track for an NPA based on classification
                  results. Updates the project record.
              parameters:
                approval_track:
                  auto: 1
                  value: null
                approval_track_subtype:
                  auto: 1
                  value: null
                project_id:
                  auto: 1
                  value: null
                reasoning:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Set the approval track for an NPA based on classification
                results. Updates the project record.
              tool_label: classify_determine_track
              tool_name: classify_determine_track
              type: api
            - enabled: true
              extra:
                description: Retrieve existing intake assessments and classification
                  scorecard for an NPA.
              parameters:
                project_id:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Retrieve existing intake assessments and classification
                scorecard for an NPA.
              tool_label: classify_get_assessment
              tool_name: classify_get_assessment
              type: api
            - enabled: true
              extra:
                description: Retrieve the prohibited products/activities list from
                  classification criteria. Use this to check if a proposed product
                  falls under prohibited categories.
              parameters:
                layer:
                  auto: 1
                  value: null
                product_description:
                  auto: 1
                  value: null
                severity:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Retrieve the prohibited products/activities list from
                classification criteria. Use this to check if a proposed product falls
                under prohibited categories.
              tool_label: ideation_get_prohibited_list
              tool_name: ideation_get_prohibited_list
              type: api
            - enabled: true
              extra:
                description: Search for similar historical NPAs by product name, description,
                  or category. Returns matching NPAs with their outcomes.
              parameters:
                limit:
                  auto: 1
                  value: null
                npa_type:
                  auto: 1
                  value: null
                product_category:
                  auto: 1
                  value: null
                search_term:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Search for similar historical NPAs by product name,
                description, or category. Returns matching NPAs with their outcomes.
              tool_label: ideation_find_similar
              tool_name: ideation_find_similar
              type: api
            - enabled: true
              extra:
                description: Run the 8-condition bundling assessment comparing a child
                  NPA against its parent product. Determines if BUNDLING track is
                  eligible.
              parameters:
                child_id:
                  auto: 1
                  value: null
                parent_id:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Run the 8-condition bundling assessment comparing
                a child NPA against its parent product. Determines if BUNDLING track
                is eligible.
              tool_label: bundling_assess
              tool_name: bundling_assess
              type: api
            - enabled: true
              extra:
                description: Apply the BUNDLING approval track to an NPA after passing
                  the 8-condition check.
              parameters:
                actor_name:
                  auto: 1
                  value: null
                child_id:
                  auto: 1
                  value: null
                parent_id:
                  auto: 1
                  value: null
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: Apply the BUNDLING approval track to an NPA after
                passing the 8-condition check.
              tool_label: bundling_apply
              tool_name: bundling_apply
              type: api
            - enabled: true
              extra:
                description: List all Evergreen products with their 30-day utilization
                  against approved limits.
              parameters: {}
              provider_name: 0183c039-452c-4cb2-ae87-7223616df6fc
              provider_show_name: NPA MCP Tools Server
              settings: {}
              tool_description: List all Evergreen products with their 30-day utilization
                against approved limits.
              tool_label: evergreen_list
              tool_name: evergreen_list
              type: api
        agent_strategy_label: ReAct
        agent_strategy_name: ReAct
        agent_strategy_provider_name: langgenius/agent/agent
        meta:
          minimum_dify_version: 1.7.0
          version: 0.0.2
        output_schema: {}
        plugin_unique_identifier: langgenius/agent:0.0.32@7ef46bd94ef1c858ab88617adf75da2729904296ecfbead9373d67d4eec10483
        selected: false
        title: Agent
        tool_node_version: '2'
        type: agent
      height: 188
      id: '1771443588236'
      position:
        x: 681.5127126762968
        y: 79.2436436618516
      positionAbsolute:
        x: 681.5127126762968
        y: 79.2436436618516
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        dataset_ids:
        - Fz0sQWDTjzxz6a41rH0lkP+6g58WrF+DqLv6rb/qhnnVLjK+idNf2lEVJ4enwwMT
        - cFcn953i1LAcYJBJRmi61RDYDXoRNZagVwM9NYcV9bWipMtRM5bAvB4bwEs6cKJL
        - Xf3+UPkTC8wqy13e4F99IQCQuzjpVrjzl6DSTHKdY71Wf2d77u9fJ/V6ynnDcYpr
        - /1ZCfK7pD1c8vbjgytjh9XZ+3IBK2AnCIKRNncGrMNmqlCFLwCHgRlzOjF5VhCN8
        - r2T83gnjwdio9GfZjSd7zG0aXZpKz5GgQ4lzDoisfWDhJGXVS3XooFgGHnby7Qid
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: weighted_score
          top_k: 4
          weights:
            keyword_setting:
              keyword_weight: 0.3
            vector_setting:
              embedding_model_name: text-embedding-3-large
              embedding_provider_name: langgenius/openai/openai
              vector_weight: 0.7
            weight_type: customized
        query_attachment_selector: []
        query_variable_selector:
        - '1771220557365'
        - product_description
        retrieval_mode: multiple
        selected: true
        title: Knowledge Retrieval
        type: knowledge-retrieval
      height: 202
      id: '1771222554170'
      position:
        x: 342
        y: 99
      positionAbsolute:
        x: 342
        y: 99
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        outputs:
        - value_selector:
          - '1771443588236'
          - text
          value_type: string
          variable: result
        selected: false
        title: Output
        type: end
      height: 88
      id: '1771223961264'
      position:
        x: 1026
        y: 128
      positionAbsolute:
        x: 1026
        y: 128
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: 266.7440714736971
      y: 218.27988494902672
      zoom: 0.7000000000000005
  rag_pipeline_variables: []
